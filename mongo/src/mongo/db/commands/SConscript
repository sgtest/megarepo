# -*- mode: python -*-

Import("env")
Import("has_option")
Import("get_option")

env = env.Clone()

env.Library(
    target='test_commands_enabled',
    source=[
        'test_commands_enabled.cpp',
        'test_commands_enabled.idl',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/server_base',
    ],
)

env.Library(
    target='server_status_core',
    source=[
        'server_status.cpp',
        'server_status_metric.cpp',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/base',
        '$BUILD_DIR/mongo/db/server_base',
    ],
)

env.Library(
    target='server_status_servers',
    source=[
        'server_status_servers.cpp',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/stats/counters',
        '$BUILD_DIR/mongo/transport/message_compressor',
        '$BUILD_DIR/mongo/transport/service_executor',
        '$BUILD_DIR/mongo/util/net/ssl_manager',
        'server_status_core',
    ],
)

env.Library(
    target='update_metrics',
    source=[
        'update_metrics.cpp',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/ops/write_ops_parsers',
        'server_status_core',
    ],
)

env.Library(
    target='write_commands_common',
    source=[
        'write_commands_common.cpp',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/auth/auth',
        '$BUILD_DIR/mongo/db/auth/authprivilege',
        '$BUILD_DIR/mongo/db/ops/write_ops_parsers',
        '$BUILD_DIR/mongo/db/pipeline/lite_parsed_document_source',
        'update_metrics',
    ],
)

# Commands available in every process that executes commands
env.Library(
    target='core',
    source=[
        'end_sessions_command.cpp',
        'fail_point_cmd.cpp',
        'fle2_cleanup.idl',
        'fle2_compact.cpp',
        'fle2_compact.idl',
        'generic.cpp',
        'generic.idl',
        'hashcmd.cpp',
        'kill_all_sessions_by_pattern_command.cpp',
        'kill_all_sessions_command.cpp',
        'kill_sessions_command.cpp',
        'parameters.cpp',
        'parameters.idl',
        'parse_log_component_settings.cpp',
        'refresh_logical_session_cache_now.cpp',
        'refresh_sessions_command.cpp',
        'rename_collection_common.cpp',
        'server_status_command.cpp',
        'sessions_commands.idl',
        'start_session_command.cpp',
    ],
    LIBDEPS=['update_metrics', 'write_commands_common'],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/bson/mutable/mutable_bson',
        '$BUILD_DIR/mongo/crypto/encrypted_field_config',
        '$BUILD_DIR/mongo/crypto/fle_crypto',
        '$BUILD_DIR/mongo/db/auth/auth',
        '$BUILD_DIR/mongo/db/auth/authprivilege',
        '$BUILD_DIR/mongo/db/commands',
        '$BUILD_DIR/mongo/db/common',
        '$BUILD_DIR/mongo/db/dbdirectclient',
        '$BUILD_DIR/mongo/db/fle_crud',
        '$BUILD_DIR/mongo/db/mongohasher',
        '$BUILD_DIR/mongo/db/ops/write_ops_parsers',
        '$BUILD_DIR/mongo/db/pipeline/lite_parsed_document_source',
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/db/session/kill_sessions',
        '$BUILD_DIR/mongo/db/session/logical_session_cache',
        '$BUILD_DIR/mongo/db/session/logical_session_id_helpers',
        '$BUILD_DIR/mongo/db/stats/counters',
        '$BUILD_DIR/mongo/db/transaction/transaction_api',
        '$BUILD_DIR/mongo/logv2/logv2_options',
        '$BUILD_DIR/mongo/rpc/message',
        '$BUILD_DIR/mongo/util/net/http_client',
        'server_status_core',
        'test_commands_enabled',
    ],
)

env.Library(
    target='query_settings_cmds',
    source=[
        # This document source has been re-located here from 'pipeline' to avoid the
        # 'pipeline' -> 'query_settings_utils' -> 'pipeline' cyclic dependency.
        # Generating the Debug Query Shape requires re-parsing the query instance via
        # `query_settings::utils::createRepresentativeInfo()`, which internally uses
        # `Pipeline::parse()`.
        '$BUILD_DIR/mongo/db/pipeline/document_source_query_settings.cpp',
        "query_settings_cmds.idl",
        "query_settings_cmds.cpp",
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/client/clientdriver_minimal',
        '$BUILD_DIR/mongo/db/commands',
        '$BUILD_DIR/mongo/db/dbdirectclient',
        '$BUILD_DIR/mongo/db/query/canonical_query',
        '$BUILD_DIR/mongo/db/query/query_plan_cache',
        '$BUILD_DIR/mongo/db/query/query_settings_manager',
        '$BUILD_DIR/mongo/db/query/query_settings_utils',
        '$BUILD_DIR/mongo/db/query/query_shape/query_shape',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
        'set_cluster_parameter_impl',
    ])

env.Library(
    target='set_cluster_parameter_impl', source=[
        'set_cluster_parameter_command_impl.cpp',
    ], LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/dbdirectclient',
        '$BUILD_DIR/mongo/s/grid',
        'cluster_server_parameter_commands_invocation',
        'mongod_fcv',
    ])

# Commands available in all mongodb server processes (mongod, mongos, etc.)
env.Library(
    target='servers',
    source=[
        'conn_pool_stats.cpp',
        'conn_pool_sync.cpp',
        'connection_status.cpp',
        'connection_status.idl',
        'drop_connections_command.cpp',
        'drop_connections.idl',
        'generic_servers.cpp',
        'generic_servers.idl',
        'internal_transactions_test_command.idl',
        'isself.cpp',
        'logical_session_server_status_section.cpp',
        'mr_common.cpp',
        'cpuload.cpp',
        'reap_logical_session_cache_now.cpp',
        'rotate_certificates_command.cpp',
        'rotate_certificates.idl',
        'test_api_version_2_commands.cpp',
        'test_deprecation_command.cpp',
        'traffic_recording_cmds.cpp',
        'user_management_commands_common.cpp',
        'user_management_commands.idl',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/client/clientdriver_minimal',
        '$BUILD_DIR/mongo/db/auth/address_restriction',
        '$BUILD_DIR/mongo/db/commands',
        '$BUILD_DIR/mongo/db/common',
        '$BUILD_DIR/mongo/db/log_process_details',
        '$BUILD_DIR/mongo/db/multitenancy',
        '$BUILD_DIR/mongo/db/pipeline/change_stream_pipeline',
        '$BUILD_DIR/mongo/db/pipeline/document_source_internal_apply_oplog_update',
        '$BUILD_DIR/mongo/db/pipeline/pipeline',
        '$BUILD_DIR/mongo/db/read_write_concern_defaults',
        '$BUILD_DIR/mongo/db/repl/isself',
        '$BUILD_DIR/mongo/db/repl/repl_coordinator_interface',
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/db/session/logical_session_cache',
        '$BUILD_DIR/mongo/db/session/logical_session_id_helpers',
        '$BUILD_DIR/mongo/db/session/session_catalog',
        '$BUILD_DIR/mongo/db/shared_request_handling',
        '$BUILD_DIR/mongo/db/traffic_recorder',
        '$BUILD_DIR/mongo/executor/egress_connection_closer_manager',
        '$BUILD_DIR/mongo/executor/task_executor_pool',
        '$BUILD_DIR/mongo/rpc/client_metadata',
        '$BUILD_DIR/mongo/s/coreshard',
        '$BUILD_DIR/mongo/scripting/scripting_common',
        '$BUILD_DIR/mongo/util/net/ssl_manager',
        '$BUILD_DIR/mongo/util/ntservice',
        'authentication_commands',
        'core',
        'query_settings_cmds',
        'test_commands_enabled',
    ],
)

env.Library(
    target='rwc_defaults_commands',
    source=[
        'rwc_defaults_commands.idl',
    ],
    LIBDEPS=[
        '$BUILD_DIR/mongo/db/read_write_concern_defaults',
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
    ],
)

env.Library(
    target='authentication_commands',
    source=[
        'authentication_commands.cpp',
        'authentication_commands.idl',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/bson/mutable/mutable_bson',
        '$BUILD_DIR/mongo/db/auth/auth',
        '$BUILD_DIR/mongo/db/auth/auth_options',
        '$BUILD_DIR/mongo/db/auth/authentication_session',
        '$BUILD_DIR/mongo/db/auth/authorization_manager_global',
        '$BUILD_DIR/mongo/db/auth/cluster_auth_mode',
        '$BUILD_DIR/mongo/db/commands',
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/rpc/client_metadata',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
        '$BUILD_DIR/mongo/util/net/ssl_manager',
        'test_commands_enabled',
    ],
)

env.Library(
    target='mongod_fsync',
    source=[
        'fsync.cpp',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/auth/auth',
        '$BUILD_DIR/mongo/db/auth/authprivilege',
        '$BUILD_DIR/mongo/db/commands',
        '$BUILD_DIR/mongo/db/concurrency/exception_util',
        '$BUILD_DIR/mongo/db/concurrency/lock_manager',
        '$BUILD_DIR/mongo/db/dbdirectclient',
        '$BUILD_DIR/mongo/db/query/query_stats/query_stats',
        '$BUILD_DIR/mongo/db/storage/backup_cursor_hooks',
        '$BUILD_DIR/mongo/util/background_job',
        'fsync_locked',
    ],
)

env.Library(
    target='mongod_fcv',
    source=[
        'feature_compatibility_version.cpp',
        'feature_compatibility_version.idl',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/commands',
        '$BUILD_DIR/mongo/db/dbdirectclient',
        '$BUILD_DIR/mongo/db/repl/repl_coordinator_interface',
        '$BUILD_DIR/mongo/db/repl/repl_server_parameters',
        '$BUILD_DIR/mongo/db/repl/repl_settings',
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/db/shard_role',
    ],
)

env.BazelLibrary(
    target='fsync_locked',
    source=[
        'fsync_locked.cpp',
    ],
    LIBDEPS=[],
)

env.Library(
    target='list_databases_command',
    source=[
        'list_databases.idl',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/auth/authprivilege',
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
    ],
)

env.Library(
    target='list_databases_for_all_tenants_command',
    source=[
        'list_databases_for_all_tenants.idl',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/auth/authprivilege',
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
    ],
)

env.Library(
    target='lock_info_command',
    source=[
        'lock_info.idl',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/auth/authprivilege',
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
    ],
)

env.Library(
    target='create_command',
    source=[
        'create.idl',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/crypto/encrypted_field_config',
        '$BUILD_DIR/mongo/db/auth/authprivilege',
        '$BUILD_DIR/mongo/db/catalog/clustered_collection_options',
        '$BUILD_DIR/mongo/db/catalog/collection_options',
        '$BUILD_DIR/mongo/db/pipeline/change_stream_pre_and_post_images_options',
        '$BUILD_DIR/mongo/db/query/query_knobs',
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/db/server_options',
        '$BUILD_DIR/mongo/db/timeseries/timeseries_options',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
    ],
)

env.Library(
    target='bulk_write_parser',
    source=['bulk_write.idl', 'bulk_write_parser.cpp', 'bulk_write_crud_op.cpp'],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/crypto/fle_fields',
        '$BUILD_DIR/mongo/db/commands',
        '$BUILD_DIR/mongo/db/ops/write_ops_parsers',
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/db/service_context',
        '$BUILD_DIR/mongo/s/common_s',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
    ],
)

env.Library(
    target='bulk_write_common',
    source=[
        'bulk_write_common.cpp',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/auth/authprivilege',
        '$BUILD_DIR/mongo/db/ops/delete_request_idl',
        '$BUILD_DIR/mongo/db/ops/write_ops_parsers',
        '$BUILD_DIR/mongo/db/query_expressions',
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/db/service_context',
        '$BUILD_DIR/mongo/logv2/logv2_options',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
        'bulk_write_parser',
    ],
)

env.Library(
    target='bulk_write_command',
    source=[
        'bulk_write.cpp',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/crypto/fle_fields',
        '$BUILD_DIR/mongo/db/auth/auth',
        '$BUILD_DIR/mongo/db/auth/authprivilege',
        '$BUILD_DIR/mongo/db/catalog/document_validation',
        '$BUILD_DIR/mongo/db/commands',
        '$BUILD_DIR/mongo/db/concurrency/exception_util',
        '$BUILD_DIR/mongo/db/curop_metrics',
        '$BUILD_DIR/mongo/db/fle_crud_mongod',
        '$BUILD_DIR/mongo/db/introspect',
        '$BUILD_DIR/mongo/db/not_primary_error_tracker',
        '$BUILD_DIR/mongo/db/ops/write_ops',
        '$BUILD_DIR/mongo/db/ops/write_ops_exec',
        '$BUILD_DIR/mongo/db/ops/write_ops_parsers',
        '$BUILD_DIR/mongo/db/pipeline/process_interface/mongod_process_interfaces',
        '$BUILD_DIR/mongo/db/query_exec',
        '$BUILD_DIR/mongo/db/s/query_analysis_writer',
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/db/server_feature_flags',
        '$BUILD_DIR/mongo/db/service_context',
        '$BUILD_DIR/mongo/db/session/logical_session_id_helpers',
        '$BUILD_DIR/mongo/db/stats/server_read_concern_write_concern_metrics',
        '$BUILD_DIR/mongo/db/transaction/transaction',
        '$BUILD_DIR/mongo/logv2/logv2_options',
        '$BUILD_DIR/mongo/s/analyze_shard_key_util',
        '$BUILD_DIR/mongo/s/grid',
        '$BUILD_DIR/mongo/s/query_analysis_sampler',
        '$BUILD_DIR/mongo/util/log_and_backoff',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
        'bulk_write_common',
        'bulk_write_parser',
        'update_metrics',
        'write_commands_common',
    ],
)

env.Library(
    target='validate_db_metadata_command',
    source=[
        'validate_db_metadata.idl',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
    ],
)

env.Library(
    target='cluster_server_parameter_cmds_idl',
    source=[
        'cluster_server_parameter_cmds.idl',
    ],
    LIBDEPS=[
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/idl/cluster_server_parameter',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
    ],
)

# Commands that are present in both mongod and embedded
env.Library(
    target='standalone',
    source=[
        'analyze_cmd.cpp',
        'count_cmd.cpp',
        'create_command.cpp',
        'create_indexes_cmd.cpp',
        'current_op.cpp',
        'dbcommands.cpp',
        'distinct.cpp',
        'drop_indexes_cmd.cpp',
        'explain_cmd.cpp',
        'find_and_modify.cpp',
        'find_cmd.cpp',
        'fle2_get_count_info_command.cpp',
        'getmore_cmd.cpp',
        'http_client.cpp',
        'http_client.idl',
        'index_filter_commands.cpp',
        'kill_op.cpp',
        'killcursors_cmd.cpp',
        'killoperations_cmd.cpp',
        'list_collections.cpp',
        'list_databases.cpp',
        'list_databases_for_all_tenants.cpp',
        'list_indexes.cpp',
        'lock_info.cpp',
        'pipeline_command.cpp',
        'plan_cache_clear_command.cpp',
        'plan_cache_commands.cpp',
        'rename_collection_cmd.cpp',
        'run_aggregate.cpp',
        'sleep_command.cpp',
        'validate.cpp',
        'validate_db_metadata_cmd.cpp',
        'whats_my_sni_command.cpp',
        'write_commands.cpp',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/base',
        '$BUILD_DIR/mongo/crypto/encrypted_field_config',
        '$BUILD_DIR/mongo/crypto/fle_crypto',
        '$BUILD_DIR/mongo/db/api_parameters',
        '$BUILD_DIR/mongo/db/catalog/catalog_helpers',
        '$BUILD_DIR/mongo/db/catalog/collection_query_info',
        '$BUILD_DIR/mongo/db/catalog/collection_validation',
        '$BUILD_DIR/mongo/db/catalog/database_holder',
        '$BUILD_DIR/mongo/db/catalog/index_key_validate',
        '$BUILD_DIR/mongo/db/catalog/multi_index_block',
        '$BUILD_DIR/mongo/db/change_stream_change_collection_manager',
        '$BUILD_DIR/mongo/db/change_stream_pre_images_collection_manager',
        '$BUILD_DIR/mongo/db/change_stream_serverless_helpers',
        '$BUILD_DIR/mongo/db/command_can_run_here',
        '$BUILD_DIR/mongo/db/commands',
        '$BUILD_DIR/mongo/db/concurrency/exception_util',
        '$BUILD_DIR/mongo/db/concurrency/lock_manager',
        '$BUILD_DIR/mongo/db/curop_failpoint_helpers',
        '$BUILD_DIR/mongo/db/dbcommands_idl',
        '$BUILD_DIR/mongo/db/exec/sbe/query_sbe_abt',
        '$BUILD_DIR/mongo/db/fle_crud',
        '$BUILD_DIR/mongo/db/fle_crud_mongod',
        '$BUILD_DIR/mongo/db/index_builds_coordinator_interface',
        '$BUILD_DIR/mongo/db/index_commands_idl',
        '$BUILD_DIR/mongo/db/multitenancy',
        '$BUILD_DIR/mongo/db/ops/write_ops',
        '$BUILD_DIR/mongo/db/ops/write_ops_exec',
        '$BUILD_DIR/mongo/db/pipeline/aggregation_request_helper',
        '$BUILD_DIR/mongo/db/pipeline/process_interface/mongo_process_interface',
        '$BUILD_DIR/mongo/db/pipeline/process_interface/mongod_process_interfaces',
        '$BUILD_DIR/mongo/db/query/command_request_response',
        '$BUILD_DIR/mongo/db/query/cursor_response_idl',
        '$BUILD_DIR/mongo/db/query/query_settings_manager',
        '$BUILD_DIR/mongo/db/query/query_shape/query_shape',
        '$BUILD_DIR/mongo/db/query/query_stats/query_stats',
        '$BUILD_DIR/mongo/db/query/stats/stats',
        '$BUILD_DIR/mongo/db/query/stats/stats_histograms',
        '$BUILD_DIR/mongo/db/query_exec',
        '$BUILD_DIR/mongo/db/repl/replica_set_messages',
        '$BUILD_DIR/mongo/db/repl/tenant_migration_access_blocker',
        '$BUILD_DIR/mongo/db/rw_concern_d',
        '$BUILD_DIR/mongo/db/s/query_analysis_writer',
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/db/server_feature_flags',
        '$BUILD_DIR/mongo/db/session/session_catalog_mongod',
        '$BUILD_DIR/mongo/db/stats/counters',
        '$BUILD_DIR/mongo/db/stats/server_read_concern_write_concern_metrics',
        '$BUILD_DIR/mongo/db/storage/storage_engine_common',
        '$BUILD_DIR/mongo/db/storage/two_phase_index_build_knobs_idl',
        '$BUILD_DIR/mongo/db/timeseries/catalog_helper',
        '$BUILD_DIR/mongo/db/timeseries/timeseries_collmod',
        '$BUILD_DIR/mongo/db/timeseries/timeseries_conversion_util',
        '$BUILD_DIR/mongo/db/timeseries/timeseries_options',
        '$BUILD_DIR/mongo/db/timeseries/timeseries_write_util',
        '$BUILD_DIR/mongo/db/transaction/transaction',
        '$BUILD_DIR/mongo/db/views/view_catalog_helpers',
        '$BUILD_DIR/mongo/executor/async_request_executor',
        '$BUILD_DIR/mongo/rpc/rewrite_state_change_errors',
        '$BUILD_DIR/mongo/s/grid',
        '$BUILD_DIR/mongo/s/query_analysis_sampler',
        '$BUILD_DIR/mongo/util/log_and_backoff',
        '$BUILD_DIR/mongo/util/net/http_client',
        'bulk_write_command',
        'core',
        'create_command',
        'current_op_common',
        'fsync_locked',
        'kill_common',
        'list_collections_filter',
        'list_databases_command',
        'list_databases_for_all_tenants_command',
        'lock_info_command',
        'rename_collection_idl',
        'test_commands_enabled',
        'validate_db_metadata_command',
    ],
)

env.Library(
    target='test_commands',
    source=[
        'test_commands.cpp',
        'whats_my_uri_cmd.cpp',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/catalog/catalog_helpers',
        '$BUILD_DIR/mongo/db/catalog/collection_crud',
        '$BUILD_DIR/mongo/db/commands',
        '$BUILD_DIR/mongo/db/dbhelpers',
        '$BUILD_DIR/mongo/db/index_builds_coordinator_interface',
        '$BUILD_DIR/mongo/db/ops/write_ops',
        '$BUILD_DIR/mongo/db/ops/write_ops_exec',
        '$BUILD_DIR/mongo/db/query_exec',
        '$BUILD_DIR/mongo/db/shard_role',
        'test_commands_enabled',
    ],
)

env.Library(
    target='notify_sharding_event_idl',
    source=[
        'notify_sharding_event.idl',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
    ],
)

env.Library(
    target='set_index_commit_quorum_idl',
    source=[
        'set_index_commit_quorum.idl',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/catalog/commit_quorum_options',
        '$BUILD_DIR/mongo/db/rw_concern_d',
        '$BUILD_DIR/mongo/idl/idl_parser',
    ],
)

env.Library(
    target='set_user_write_block_mode_idl',
    source=[
        'set_user_write_block_mode.idl',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
    ],
)

env.Library(
    target='rename_collection_idl',
    source=[
        'rename_collection.idl',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
    ],
)

env.Library(
    target='set_feature_compatibility_version_idl',
    source=[
        'set_feature_compatibility_version.idl',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
    ],
)

env.Library(
    target='shutdown_idl',
    source=[
        'shutdown.cpp',
        'shutdown.idl',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/bson/bson_validate',
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/db/service_context',
        '$BUILD_DIR/mongo/util/fail_point',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
    ],
)

# Commands that should only be present in mongod
env.Library(
    target="mongod",
    source=[
        "apply_ops_cmd.cpp",
        "change_stream_state_command.cpp",
        "collection_to_capped.cpp",
        "compact.cpp",
        "compact.idl",
        "dbcommands_d.cpp",
        "dbhash.cpp",
        'get_cluster_parameter_command.cpp',
        "internal_rename_if_options_and_indexes_match_cmd.cpp",
        "internal_transactions_test_command_d.cpp",
        "fle2_cleanup_cmd.cpp",
        "fle2_compact_cmd.cpp",
        "map_reduce_command.cpp",
        "oplog_application_checks.cpp",
        "oplog_note.cpp",
        'read_write_concern_defaults_server_status.cpp',
        "resize_oplog.cpp",
        "resize_oplog.idl",
        'rwc_defaults_commands.cpp',
        'set_cluster_parameter_command.cpp',
        "set_feature_compatibility_version_command.cpp",
        "set_index_commit_quorum_command.cpp",
        'set_user_write_block_mode_command.cpp',
        "shutdown_d.cpp",
        "snapshot_management.cpp",
        "tenant_migration_donor_cmds.cpp",
        "tenant_migration_recipient_cmds.cpp",
        "top_command.cpp",
        "txn_cmds.cpp",
        "user_management_commands.cpp",
        "vote_abort_index_build_command.cpp",
        "vote_commit_index_build_command.cpp",
        'internal_rename_if_options_and_indexes_match.idl',
        'vote_index_build.idl',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/client/clientdriver_minimal',
        '$BUILD_DIR/mongo/crypto/fle_crypto',
        '$BUILD_DIR/mongo/db/auth/address_restriction',
        '$BUILD_DIR/mongo/db/auth/auth',
        '$BUILD_DIR/mongo/db/auth/auth_options',
        '$BUILD_DIR/mongo/db/auth/auth_umc',
        '$BUILD_DIR/mongo/db/auth/authprivilege',
        '$BUILD_DIR/mongo/db/auth/builtin_roles',
        '$BUILD_DIR/mongo/db/auth/sasl_options',
        '$BUILD_DIR/mongo/db/auth/user',
        '$BUILD_DIR/mongo/db/auth/user_document_parser',
        '$BUILD_DIR/mongo/db/catalog/catalog_control',
        '$BUILD_DIR/mongo/db/catalog/catalog_helpers',
        '$BUILD_DIR/mongo/db/catalog/catalog_impl',
        '$BUILD_DIR/mongo/db/catalog/database_holder',
        '$BUILD_DIR/mongo/db/catalog/index_key_validate',
        '$BUILD_DIR/mongo/db/change_stream_change_collection_manager',
        '$BUILD_DIR/mongo/db/change_stream_options_manager',
        '$BUILD_DIR/mongo/db/change_stream_pre_images_collection_manager',
        '$BUILD_DIR/mongo/db/change_stream_state',
        '$BUILD_DIR/mongo/db/cluster_transaction_api',
        '$BUILD_DIR/mongo/db/commands',
        '$BUILD_DIR/mongo/db/curop_failpoint_helpers',
        '$BUILD_DIR/mongo/db/dbhelpers',
        '$BUILD_DIR/mongo/db/exec/stagedebug_cmd',
        '$BUILD_DIR/mongo/db/fle_crud_mongod',
        '$BUILD_DIR/mongo/db/index_builds_coordinator_interface',
        '$BUILD_DIR/mongo/db/introspect',
        '$BUILD_DIR/mongo/db/multitenancy',
        '$BUILD_DIR/mongo/db/pipeline/pipeline',
        '$BUILD_DIR/mongo/db/pipeline/process_interface/mongo_process_interface',
        '$BUILD_DIR/mongo/db/repl/dbcheck',
        '$BUILD_DIR/mongo/db/repl/oplog',
        '$BUILD_DIR/mongo/db/repl/repl_coordinator_interface',
        '$BUILD_DIR/mongo/db/repl/repl_server_parameters',
        '$BUILD_DIR/mongo/db/repl/replica_set_messages',
        '$BUILD_DIR/mongo/db/repl/shard_merge_recipient_service',
        '$BUILD_DIR/mongo/db/repl/tenant_migration_donor_service',
        '$BUILD_DIR/mongo/db/repl/tenant_migration_recipient_service',
        '$BUILD_DIR/mongo/db/rw_concern_d',
        '$BUILD_DIR/mongo/db/s/sharding_catalog',
        '$BUILD_DIR/mongo/db/s/sharding_catalog_manager',
        '$BUILD_DIR/mongo/db/s/sharding_commands_d',
        '$BUILD_DIR/mongo/db/s/sharding_runtime_d',
        '$BUILD_DIR/mongo/db/s/transaction_coordinator',
        '$BUILD_DIR/mongo/db/s/user_writes_recoverable_critical_section',
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/db/serverless/shard_split_donor_service',
        '$BUILD_DIR/mongo/db/set_change_stream_state_coordinator',
        '$BUILD_DIR/mongo/db/timeseries/timeseries_conversion_util',
        '$BUILD_DIR/mongo/db/transaction/transaction_api',
        '$BUILD_DIR/mongo/executor/inline_executor',
        '$BUILD_DIR/mongo/util/net/ssl_manager',
        '$BUILD_DIR/mongo/util/progress_meter',
        'cluster_server_parameter_commands_invocation',
        'core',
        'create_command',
        'dbcheck_command',
        'kill_common',
        'map_reduce_agg',
        'mongod_fcv',
        'mongod_fsync',
        'profile_common',
        'rwc_defaults_commands',
        'servers',
        'set_cluster_parameter_impl',
        'set_feature_compatibility_version_idl',
        'set_index_commit_quorum_idl',
        'set_user_write_block_mode_idl',
        'shutdown_idl',
        'standalone',
        'tenant_migration_cmds_request',
        'test_commands',
        'test_commands_enabled',
        'txn_cmd_request',
    ],
)

env.Library(
    target='cluster_server_parameter_commands_invocation',
    source=[
        'get_cluster_parameter_invocation.cpp',
        'set_cluster_parameter_invocation.cpp',
    ],
    LIBDEPS=[
        '$BUILD_DIR/mongo/base',
        '$BUILD_DIR/mongo/db/audit',
        '$BUILD_DIR/mongo/s/sharding_api',
        'cluster_server_parameter_cmds_idl',
    ],
)

env.Library(
    target='kill_common',
    source=[
        'kill_op_cmd_base.cpp',
        'kill_operations.idl',
    ],
    LIBDEPS=[
        '$BUILD_DIR/mongo/db/audit',
        '$BUILD_DIR/mongo/db/auth/authorization_manager_global',
        '$BUILD_DIR/mongo/db/auth/authprivilege',
        '$BUILD_DIR/mongo/db/commands',
        '$BUILD_DIR/mongo/db/operation_killer',
        '$BUILD_DIR/mongo/db/query/command_request_response',
    ],
)

env.Library(
    target='current_op_common',
    source=[
        'current_op_common.cpp',
    ],
    LIBDEPS=[
        '$BUILD_DIR/mongo/db/commands',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/pipeline/aggregation_request_helper',
        '$BUILD_DIR/mongo/db/query/command_request_response',
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/db/service_context',
        'test_commands_enabled',
    ],
)

env.Library(
    target='profile_common',
    source=[
        'profile_common.cpp',
        'profile.idl',
        '$BUILD_DIR/mongo/db/profile_filter_impl.cpp',
        'set_profiling_filter_globally_cmd.cpp',
    ],
    LIBDEPS=[
        '$BUILD_DIR/mongo/db/commands',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/auth/auth',
        '$BUILD_DIR/mongo/db/auth/authprivilege',
        '$BUILD_DIR/mongo/db/catalog/collection_catalog',
        '$BUILD_DIR/mongo/db/query/query_stats/query_stats',
        '$BUILD_DIR/mongo/db/query_expressions',
        '$BUILD_DIR/mongo/db/server_base',
    ],
)

env.Library(
    target="list_collections_filter",
    source=[
        'list_collections_filter.cpp',
    ],
    LIBDEPS=[
        '$BUILD_DIR/mongo/base',
    ],
)

env.Library(
    target='tenant_migration_cmds_request',
    source=[
        'tenant_migration_donor_cmds.idl',
        'tenant_migration_recipient_cmds.idl',
    ],
    LIBDEPS=[
        '$BUILD_DIR/mongo/base',
        '$BUILD_DIR/mongo/client/connection_string',
        '$BUILD_DIR/mongo/client/read_preference',
        '$BUILD_DIR/mongo/db/repl/repl_coordinator_interface',
        '$BUILD_DIR/mongo/db/repl/repl_server_parameters',
        '$BUILD_DIR/mongo/db/repl/tenant_migration_state_machine_idl',
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/db/serverless/serverless_types_idl',
        '$BUILD_DIR/mongo/idl/idl_parser',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
    ],
)
env.Library(
    target='txn_cmd_request',
    source=[
        "txn_cmds.idl",
        "txn_two_phase_commit_cmds.idl",
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/auth/authprivilege',
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
    ],
)

env.Library(
    target='map_reduce_parser',
    source=[
        'map_reduce_out_options.cpp',
        'map_reduce.idl',
    ],
    LIBDEPS=[
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/db/write_concern_options',
        '$BUILD_DIR/mongo/util/namespace_string_database_name_util',
    ],
)

env.Library(
    target='map_reduce_agg',
    source=[
        'map_reduce_agg.cpp',
    ],
    LIBDEPS=[
        '$BUILD_DIR/mongo/db/commands/servers',
        '$BUILD_DIR/mongo/db/index/index_access_method',
        '$BUILD_DIR/mongo/db/pipeline/process_interface/mongo_process_interface',
        '$BUILD_DIR/mongo/db/pipeline/process_interface/mongod_process_interface_factory',
        '$BUILD_DIR/mongo/db/query/map_reduce_output_format',
        '$BUILD_DIR/mongo/db/query_exec',
        '$BUILD_DIR/mongo/db/shard_role',
        '$BUILD_DIR/mongo/idl/idl_parser',
        'map_reduce_parser',
    ],
)

env.Library(
    target='dbcheck_command',
    source=[
        'dbcheck_command.cpp',
    ],
    LIBDEPS=[
        '$BUILD_DIR/mongo/db/catalog/health_log_interface',
        '$BUILD_DIR/mongo/db/repl/dbcheck',
    ],
    LIBDEPS_PRIVATE=[
        '$BUILD_DIR/mongo/db/catalog/catalog_helpers',
        '$BUILD_DIR/mongo/db/catalog/collection_options',
        '$BUILD_DIR/mongo/db/concurrency/exception_util',
        '$BUILD_DIR/mongo/db/dbhelpers',
        '$BUILD_DIR/mongo/db/query_exec',
        '$BUILD_DIR/mongo/db/record_id_helpers',
        '$BUILD_DIR/mongo/db/repl/oplog',
        '$BUILD_DIR/mongo/db/repl/repl_server_parameters',
        '$BUILD_DIR/mongo/db/server_base',
        '$BUILD_DIR/mongo/util/md5',
        '$BUILD_DIR/mongo/util/progress_meter',
    ],
)

env.CppUnitTest(
    target='map_reduce_agg_test',
    source=[
        'map_reduce_agg_test.cpp',
        'map_reduce_parse_test.cpp',
    ],
    LIBDEPS=[
        '$BUILD_DIR/mongo/db/auth/authmocks',
        '$BUILD_DIR/mongo/db/query/query_test_service_context',
        '$BUILD_DIR/mongo/db/service_context_non_d',
        '$BUILD_DIR/mongo/db/storage/two_phase_index_build_knobs_idl',
        'map_reduce_agg',
    ],
)

env.CppUnitTest(
    target='command_mirroring_test',
    source=[
        'command_mirroring_test.cpp',
    ],
    LIBDEPS=[
        '$BUILD_DIR/mongo/base',
        '$BUILD_DIR/mongo/db/auth/authmocks',
        '$BUILD_DIR/mongo/db/auth/authorization_manager_global',
        '$BUILD_DIR/mongo/db/commands',
        '$BUILD_DIR/mongo/db/service_context_non_d',
        '$BUILD_DIR/mongo/unittest/unittest',
        'standalone',
    ],
)

env.CppUnitTest(
    target="async_command_execution_test",
    source=[
        "async_command_execution_test.cpp",
    ],
    LIBDEPS=[
        "$BUILD_DIR/mongo/base",
        "$BUILD_DIR/mongo/db/auth/authmocks",
        "$BUILD_DIR/mongo/db/auth/authorization_manager_global",
        "$BUILD_DIR/mongo/db/commands",
        "$BUILD_DIR/mongo/db/commands/standalone",
        '$BUILD_DIR/mongo/db/service_context_non_d',
        "$BUILD_DIR/mongo/db/service_context_test_fixture",
        "$BUILD_DIR/mongo/util/version_impl",
    ],
)

env.CppUnitTest(
    target='db_commands_test',
    source=[
        'create_command_test.cpp',
        'create_indexes_test.cpp',
        'dbcheck_command_test.cpp',
        'external_data_source_commands_test.cpp',
        'fle_compact_test.cpp',
        'index_filter_commands_test.cpp',
        'list_collections_filter_test.cpp',
        'mr_test.cpp' if get_option('js-engine') != 'none' else [],
        'parse_log_component_settings_test.cpp',
        'plan_cache_commands_test.cpp',
        'server_status_metric_test.cpp',
        'set_cluster_parameter_invocation_test.cpp',
    ],
    LIBDEPS=[
        '$BUILD_DIR/mongo/crypto/aead_encryption',
        '$BUILD_DIR/mongo/crypto/encrypted_field_config',
        '$BUILD_DIR/mongo/crypto/fle_crypto',
        '$BUILD_DIR/mongo/db/auth/authmocks',
        '$BUILD_DIR/mongo/db/catalog/catalog_test_fixture',
        '$BUILD_DIR/mongo/db/catalog/collection_crud',
        '$BUILD_DIR/mongo/db/catalog/health_log',
        '$BUILD_DIR/mongo/db/concurrency/exception_util',
        '$BUILD_DIR/mongo/db/dbdirectclient',
        '$BUILD_DIR/mongo/db/fle_crud',
        '$BUILD_DIR/mongo/db/fle_mocks',
        '$BUILD_DIR/mongo/db/multitenancy',
        '$BUILD_DIR/mongo/db/op_observer/op_observer',
        '$BUILD_DIR/mongo/db/query/query_planner',
        '$BUILD_DIR/mongo/db/query/query_test_service_context',
        '$BUILD_DIR/mongo/db/query_exec',
        '$BUILD_DIR/mongo/db/repl/dbcheck_test_fixture',
        '$BUILD_DIR/mongo/db/repl/drop_pending_collection_reaper',
        '$BUILD_DIR/mongo/db/repl/replmocks',
        '$BUILD_DIR/mongo/db/repl/storage_interface_impl',
        '$BUILD_DIR/mongo/db/service_context_d_test_fixture',
        '$BUILD_DIR/mongo/db/shard_role',
        '$BUILD_DIR/mongo/db/storage/record_store_base',
        '$BUILD_DIR/mongo/idl/idl_parser',
        '$BUILD_DIR/mongo/shell/kms_idl',
        '$BUILD_DIR/mongo/util/version_impl',
        'cluster_server_parameter_commands_invocation',
        'core',
        'create_command',
        'dbcheck_command',
        'list_collections_filter',
        'mongod',
        'servers',
        'standalone',
    ],
)

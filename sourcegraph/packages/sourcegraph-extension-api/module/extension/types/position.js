import { illegalArgument } from './errors';
export class Position {
    static min(...positions) {
        let result = positions.pop();
        if (result === undefined) {
            return undefined;
        }
        for (const p of positions) {
            if (p.isBefore(result)) {
                result = p;
            }
        }
        return result;
    }
    static max(...positions) {
        let result = positions.pop();
        if (result === undefined) {
            return undefined;
        }
        for (const p of positions) {
            if (p.isAfter(result)) {
                result = p;
            }
        }
        return result;
    }
    static isPosition(other) {
        if (!other) {
            return false;
        }
        if (other instanceof Position) {
            return true;
        }
        const { line, character } = other;
        if (typeof line === 'number' && typeof character === 'number') {
            return true;
        }
        return false;
    }
    get line() {
        return this._line;
    }
    get character() {
        return this._character;
    }
    constructor(line, character) {
        if (line < 0) {
            throw illegalArgument('line must be non-negative');
        }
        if (character < 0) {
            throw illegalArgument('character must be non-negative');
        }
        this._line = line;
        this._character = character;
    }
    isBefore(other) {
        if (this._line < other.line) {
            return true;
        }
        if (other.line < this._line) {
            return false;
        }
        return this._character < other.character;
    }
    isBeforeOrEqual(other) {
        if (this._line < other.line) {
            return true;
        }
        if (other.line < this._line) {
            return false;
        }
        return this._character <= other.character;
    }
    isAfter(other) {
        return !this.isBeforeOrEqual(other);
    }
    isAfterOrEqual(other) {
        return !this.isBefore(other);
    }
    isEqual(other) {
        return this._line === other.line && this._character === other.character;
    }
    compareTo(other) {
        if (this._line < other.line) {
            return -1;
        }
        else if (this._line > other.line) {
            return 1;
        }
        else {
            // equal line
            if (this._character < other.character) {
                return -1;
            }
            else if (this._character > other.character) {
                return 1;
            }
            else {
                // equal line and character
                return 0;
            }
        }
    }
    translate(lineDeltaOrChange, characterDelta = 0) {
        if (lineDeltaOrChange === null || characterDelta === null) {
            throw illegalArgument();
        }
        let lineDelta;
        if (typeof lineDeltaOrChange === 'undefined') {
            lineDelta = 0;
        }
        else if (typeof lineDeltaOrChange === 'number') {
            lineDelta = lineDeltaOrChange;
        }
        else {
            lineDelta = typeof lineDeltaOrChange.lineDelta === 'number' ? lineDeltaOrChange.lineDelta : 0;
            characterDelta = typeof lineDeltaOrChange.characterDelta === 'number' ? lineDeltaOrChange.characterDelta : 0;
        }
        if (lineDelta === 0 && characterDelta === 0) {
            return this;
        }
        return new Position(this.line + lineDelta, this.character + characterDelta);
    }
    with(lineOrChange, character = this.character) {
        if (lineOrChange === null || character === null) {
            throw illegalArgument();
        }
        let line;
        if (typeof lineOrChange === 'undefined') {
            line = this.line;
        }
        else if (typeof lineOrChange === 'number') {
            line = lineOrChange;
        }
        else {
            line = typeof lineOrChange.line === 'number' ? lineOrChange.line : this.line;
            character = typeof lineOrChange.character === 'number' ? lineOrChange.character : this.character;
        }
        if (line === this.line && character === this.character) {
            return this;
        }
        return new Position(line, character);
    }
    toJSON() {
        return { line: this.line, character: this.character };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9zaXRpb24uanMiLCJzb3VyY2VSb290Ijoic3JjLyIsInNvdXJjZXMiOlsiZXh0ZW5zaW9uL3R5cGVzL3Bvc2l0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFFMUMsTUFBTSxPQUFPLFFBQVE7SUFHVixNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsU0FBaUM7UUFDbEQsSUFBSSxNQUFNLEdBQUcsU0FBUyxDQUFDLEdBQUcsRUFBRSxDQUFBO1FBQzVCLElBQUksTUFBTSxLQUFLLFNBQVMsRUFBRTtZQUN0QixPQUFPLFNBQVMsQ0FBQTtTQUNuQjtRQUNELEtBQUssTUFBTSxDQUFDLElBQUksU0FBUyxFQUFFO1lBQ3ZCLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRTtnQkFDcEIsTUFBTSxHQUFHLENBQUMsQ0FBQTthQUNiO1NBQ0o7UUFDRCxPQUFPLE1BQU0sQ0FBQTtJQUNqQixDQUFDO0lBSU0sTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLFNBQWlDO1FBQ2xELElBQUksTUFBTSxHQUFHLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQTtRQUM1QixJQUFJLE1BQU0sS0FBSyxTQUFTLEVBQUU7WUFDdEIsT0FBTyxTQUFTLENBQUE7U0FDbkI7UUFDRCxLQUFLLE1BQU0sQ0FBQyxJQUFJLFNBQVMsRUFBRTtZQUN2QixJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQ25CLE1BQU0sR0FBRyxDQUFDLENBQUE7YUFDYjtTQUNKO1FBQ0QsT0FBTyxNQUFNLENBQUE7SUFDakIsQ0FBQztJQUVNLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBVTtRQUMvQixJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ1IsT0FBTyxLQUFLLENBQUE7U0FDZjtRQUNELElBQUksS0FBSyxZQUFZLFFBQVEsRUFBRTtZQUMzQixPQUFPLElBQUksQ0FBQTtTQUNkO1FBQ0Qs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QUFJLEdBQUcsT0FBTyxZQUFZLENBQUMsSUFBSSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQTtZQUM1RSxTQUFTLEdBQUcsT0FBTyxZQUFZLENBQUMsU0FBUyxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQTtTQUNuRztRQUVELElBQUksSUFBSSxLQUFLLElBQUksQ0FBQyxJQUFJLElBQUksU0FBUyxLQUFLLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDcEQsT0FBTyxJQUFJLENBQUE7U0FDZDtRQUNELE9BQU8sSUFBSSxRQUFRLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFBO0lBQ3hDLENBQUM7SUFFTSxNQUFNO1FBQ1QsT0FBTyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUE7SUFDekQsQ0FBQztDQUNKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgc291cmNlZ3JhcGggZnJvbSAnc291cmNlZ3JhcGgnXG5pbXBvcnQgeyBpbGxlZ2FsQXJndW1lbnQgfSBmcm9tICcuL2Vycm9ycydcblxuZXhwb3J0IGNsYXNzIFBvc2l0aW9uIHtcbiAgICBwdWJsaWMgc3RhdGljIG1pbihwb3NpdGlvbjogc291cmNlZ3JhcGguUG9zaXRpb24sIC4uLnBvc2l0aW9uczogc291cmNlZ3JhcGguUG9zaXRpb25bXSk6IFBvc2l0aW9uXG4gICAgcHVibGljIHN0YXRpYyBtaW4oLi4ucG9zaXRpb25zOiBzb3VyY2VncmFwaC5Qb3NpdGlvbltdKTogc291cmNlZ3JhcGguUG9zaXRpb24gfCB1bmRlZmluZWRcbiAgICBwdWJsaWMgc3RhdGljIG1pbiguLi5wb3NpdGlvbnM6IHNvdXJjZWdyYXBoLlBvc2l0aW9uW10pOiBzb3VyY2VncmFwaC5Qb3NpdGlvbiB8IHVuZGVmaW5lZCB7XG4gICAgICAgIGxldCByZXN1bHQgPSBwb3NpdGlvbnMucG9wKClcbiAgICAgICAgaWYgKHJlc3VsdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBwIG9mIHBvc2l0aW9ucykge1xuICAgICAgICAgICAgaWYgKHAuaXNCZWZvcmUocmVzdWx0KSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBtYXgocG9zaXRpb246IHNvdXJjZWdyYXBoLlBvc2l0aW9uLCAuLi5wb3NpdGlvbnM6IHNvdXJjZWdyYXBoLlBvc2l0aW9uW10pOiBQb3NpdGlvblxuICAgIHB1YmxpYyBzdGF0aWMgbWF4KC4uLnBvc2l0aW9uczogc291cmNlZ3JhcGguUG9zaXRpb25bXSk6IHNvdXJjZWdyYXBoLlBvc2l0aW9uIHwgdW5kZWZpbmVkXG4gICAgcHVibGljIHN0YXRpYyBtYXgoLi4ucG9zaXRpb25zOiBzb3VyY2VncmFwaC5Qb3NpdGlvbltdKTogc291cmNlZ3JhcGguUG9zaXRpb24gfCB1bmRlZmluZWQge1xuICAgICAgICBsZXQgcmVzdWx0ID0gcG9zaXRpb25zLnBvcCgpXG4gICAgICAgIGlmIChyZXN1bHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgcCBvZiBwb3NpdGlvbnMpIHtcbiAgICAgICAgICAgIGlmIChwLmlzQWZ0ZXIocmVzdWx0KSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0XG4gICAgfVxuXG4gICAgcHVibGljIHN0YXRpYyBpc1Bvc2l0aW9uKG90aGVyOiBhbnkpOiBvdGhlciBpcyBzb3VyY2VncmFwaC5Qb3NpdGlvbiB7XG4gICAgICAgIGlmICghb3RoZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICB9XG4gICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIFBvc2l0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgbGluZSwgY2hhcmFjdGVyIH0gPSBvdGhlciBhcyBzb3VyY2VncmFwaC5Qb3NpdGlvblxuICAgICAgICBpZiAodHlwZW9mIGxpbmUgPT09ICdudW1iZXInICYmIHR5cGVvZiBjaGFyYWN0ZXIgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIHByaXZhdGUgX2xpbmU6IG51bWJlclxuICAgIHByaXZhdGUgX2NoYXJhY3RlcjogbnVtYmVyXG5cbiAgICBwdWJsaWMgZ2V0IGxpbmUoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xpbmVcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0IGNoYXJhY3RlcigpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2hhcmFjdGVyXG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IobGluZTogbnVtYmVyLCBjaGFyYWN0ZXI6IG51bWJlcikge1xuICAgICAgICBpZiAobGluZSA8IDApIHtcbiAgICAgICAgICAgIHRocm93IGlsbGVnYWxBcmd1bWVudCgnbGluZSBtdXN0IGJlIG5vbi1uZWdhdGl2ZScpXG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoYXJhY3RlciA8IDApIHtcbiAgICAgICAgICAgIHRocm93IGlsbGVnYWxBcmd1bWVudCgnY2hhcmFjdGVyIG11c3QgYmUgbm9uLW5lZ2F0aXZlJylcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9saW5lID0gbGluZVxuICAgICAgICB0aGlzLl9jaGFyYWN0ZXIgPSBjaGFyYWN0ZXJcbiAgICB9XG5cbiAgICBwdWJsaWMgaXNCZWZvcmUob3RoZXI6IHNvdXJjZWdyYXBoLlBvc2l0aW9uKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh0aGlzLl9saW5lIDwgb3RoZXIubGluZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgfVxuICAgICAgICBpZiAob3RoZXIubGluZSA8IHRoaXMuX2xpbmUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9jaGFyYWN0ZXIgPCBvdGhlci5jaGFyYWN0ZXJcbiAgICB9XG5cbiAgICBwdWJsaWMgaXNCZWZvcmVPckVxdWFsKG90aGVyOiBzb3VyY2VncmFwaC5Qb3NpdGlvbik6IGJvb2xlYW4ge1xuICAgICAgICBpZiAodGhpcy5fbGluZSA8IG90aGVyLmxpbmUpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIH1cbiAgICAgICAgaWYgKG90aGVyLmxpbmUgPCB0aGlzLl9saW5lKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fY2hhcmFjdGVyIDw9IG90aGVyLmNoYXJhY3RlclxuICAgIH1cblxuICAgIHB1YmxpYyBpc0FmdGVyKG90aGVyOiBzb3VyY2VncmFwaC5Qb3NpdGlvbik6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gIXRoaXMuaXNCZWZvcmVPckVxdWFsKG90aGVyKVxuICAgIH1cblxuICAgIHB1YmxpYyBpc0FmdGVyT3JFcXVhbChvdGhlcjogc291cmNlZ3JhcGguUG9zaXRpb24pOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICF0aGlzLmlzQmVmb3JlKG90aGVyKVxuICAgIH1cblxuICAgIHB1YmxpYyBpc0VxdWFsKG90aGVyOiBzb3VyY2VncmFwaC5Qb3NpdGlvbik6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fbGluZSA9PT0gb3RoZXIubGluZSAmJiB0aGlzLl9jaGFyYWN0ZXIgPT09IG90aGVyLmNoYXJhY3RlclxuICAgIH1cblxuICAgIHB1YmxpYyBjb21wYXJlVG8ob3RoZXI6IHNvdXJjZWdyYXBoLlBvc2l0aW9uKTogbnVtYmVyIHtcbiAgICAgICAgaWYgKHRoaXMuX2xpbmUgPCBvdGhlci5saW5lKSB7XG4gICAgICAgICAgICByZXR1cm4gLTFcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9saW5lID4gb3RoZXIubGluZSkge1xuICAgICAgICAgICAgcmV0dXJuIDFcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGVxdWFsIGxpbmVcbiAgICAgICAgICAgIGlmICh0aGlzLl9jaGFyYWN0ZXIgPCBvdGhlci5jaGFyYWN0ZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gLTFcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fY2hhcmFjdGVyID4gb3RoZXIuY2hhcmFjdGVyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDFcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gZXF1YWwgbGluZSBhbmQgY2hhcmFjdGVyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyB0cmFuc2xhdGUobGluZURlbHRhPzogbnVtYmVyLCBjaGFyYWN0ZXJEZWx0YT86IG51bWJlcik6IHNvdXJjZWdyYXBoLlBvc2l0aW9uXG4gICAgcHVibGljIHRyYW5zbGF0ZShjaGFuZ2U6IHsgbGluZURlbHRhPzogbnVtYmVyOyBjaGFyYWN0ZXJEZWx0YT86IG51bWJlciB9KTogc291cmNlZ3JhcGguUG9zaXRpb25cbiAgICBwdWJsaWMgdHJhbnNsYXRlKFxuICAgICAgICBsaW5lRGVsdGFPckNoYW5nZTogbnVtYmVyIHwgdW5kZWZpbmVkIHwgeyBsaW5lRGVsdGE/OiBudW1iZXI7IGNoYXJhY3RlckRlbHRhPzogbnVtYmVyIH0sXG4gICAgICAgIGNoYXJhY3RlckRlbHRhID0gMFxuICAgICk6IFBvc2l0aW9uIHtcbiAgICAgICAgaWYgKGxpbmVEZWx0YU9yQ2hhbmdlID09PSBudWxsIHx8IGNoYXJhY3RlckRlbHRhID09PSBudWxsKSB7XG4gICAgICAgICAgICB0aHJvdyBpbGxlZ2FsQXJndW1lbnQoKVxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGxpbmVEZWx0YTogbnVtYmVyXG4gICAgICAgIGlmICh0eXBlb2YgbGluZURlbHRhT3JDaGFuZ2UgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBsaW5lRGVsdGEgPSAwXG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGxpbmVEZWx0YU9yQ2hhbmdlID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgbGluZURlbHRhID0gbGluZURlbHRhT3JDaGFuZ2VcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxpbmVEZWx0YSA9IHR5cGVvZiBsaW5lRGVsdGFPckNoYW5nZS5saW5lRGVsdGEgPT09ICdudW1iZXInID8gbGluZURlbHRhT3JDaGFuZ2UubGluZURlbHRhIDogMFxuICAgICAgICAgICAgY2hhcmFjdGVyRGVsdGEgPSB0eXBlb2YgbGluZURlbHRhT3JDaGFuZ2UuY2hhcmFjdGVyRGVsdGEgPT09ICdudW1iZXInID8gbGluZURlbHRhT3JDaGFuZ2UuY2hhcmFjdGVyRGVsdGEgOiAwXG4gICAgICAgIH1cblxuICAgICAgICBpZiAobGluZURlbHRhID09PSAwICYmIGNoYXJhY3RlckRlbHRhID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpc1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUG9zaXRpb24odGhpcy5saW5lICsgbGluZURlbHRhLCB0aGlzLmNoYXJhY3RlciArIGNoYXJhY3RlckRlbHRhKVxuICAgIH1cblxuICAgIHB1YmxpYyB3aXRoKGxpbmU/OiBudW1iZXIsIGNoYXJhY3Rlcj86IG51bWJlcik6IHNvdXJjZWdyYXBoLlBvc2l0aW9uXG4gICAgcHVibGljIHdpdGgoY2hhbmdlOiB7IGxpbmU/OiBudW1iZXI7IGNoYXJhY3Rlcj86IG51bWJlciB9KTogc291cmNlZ3JhcGguUG9zaXRpb25cbiAgICBwdWJsaWMgd2l0aChcbiAgICAgICAgbGluZU9yQ2hhbmdlOiBudW1iZXIgfCB1bmRlZmluZWQgfCB7IGxpbmU/OiBudW1iZXI7IGNoYXJhY3Rlcj86IG51bWJlciB9LFxuICAgICAgICBjaGFyYWN0ZXI6IG51bWJlciA9IHRoaXMuY2hhcmFjdGVyXG4gICAgKTogc291cmNlZ3JhcGguUG9zaXRpb24ge1xuICAgICAgICBpZiAobGluZU9yQ2hhbmdlID09PSBudWxsIHx8IGNoYXJhY3RlciA9PT0gbnVsbCkge1xuICAgICAgICAgICAgdGhyb3cgaWxsZWdhbEFyZ3VtZW50KClcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBsaW5lOiBudW1iZXJcbiAgICAgICAgaWYgKHR5cGVvZiBsaW5lT3JDaGFuZ2UgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBsaW5lID0gdGhpcy5saW5lXG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGxpbmVPckNoYW5nZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIGxpbmUgPSBsaW5lT3JDaGFuZ2VcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxpbmUgPSB0eXBlb2YgbGluZU9yQ2hhbmdlLmxpbmUgPT09ICdudW1iZXInID8gbGluZU9yQ2hhbmdlLmxpbmUgOiB0aGlzLmxpbmVcbiAgICAgICAgICAgIGNoYXJhY3RlciA9IHR5cGVvZiBsaW5lT3JDaGFuZ2UuY2hhcmFjdGVyID09PSAnbnVtYmVyJyA/IGxpbmVPckNoYW5nZS5jaGFyYWN0ZXIgOiB0aGlzLmNoYXJhY3RlclxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxpbmUgPT09IHRoaXMubGluZSAmJiBjaGFyYWN0ZXIgPT09IHRoaXMuY2hhcmFjdGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpc1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUG9zaXRpb24obGluZSwgY2hhcmFjdGVyKVxuICAgIH1cblxuICAgIHB1YmxpYyB0b0pTT04oKTogYW55IHtcbiAgICAgICAgcmV0dXJuIHsgbGluZTogdGhpcy5saW5lLCBjaGFyYWN0ZXI6IHRoaXMuY2hhcmFjdGVyIH1cbiAgICB9XG59XG4iXX0=
import { illegalArgument } from './errors';
import { Position } from './position';
export class Range {
    static isRange(thing) {
        if (thing instanceof Range) {
            return true;
        }
        if (!thing) {
            return false;
        }
        return Position.isPosition(thing.start) && Position.isPosition(thing.end);
    }
    get start() {
        return this._start;
    }
    get end() {
        return this._end;
    }
    constructor(startLineOrStart, startColumnOrEnd, endLine, endColumn) {
        let start;
        let end;
        if (typeof startLineOrStart === 'number' &&
            typeof startColumnOrEnd === 'number' &&
            typeof endLine === 'number' &&
            typeof endColumn === 'number') {
            start = new Position(startLineOrStart, startColumnOrEnd);
            end = new Position(endLine, endColumn);
        }
        else if (startLineOrStart instanceof Position && startColumnOrEnd instanceof Position) {
            start = startLineOrStart;
            end = startColumnOrEnd;
        }
        if (!start || !end) {
            throw new Error('Invalid arguments');
        }
        if (start.isBefore(end)) {
            this._start = start;
            this._end = end;
        }
        else {
            this._start = end;
            this._end = start;
        }
    }
    contains(positionOrRange) {
        if (positionOrRange instanceof Range) {
            return this.contains(positionOrRange._start) && this.contains(positionOrRange._end);
        }
        else if (positionOrRange instanceof Position) {
            if (positionOrRange.isBefore(this._start)) {
                return false;
            }
            if (this._end.isBefore(positionOrRange)) {
                return false;
            }
            return true;
        }
        return false;
    }
    isEqual(other) {
        return this._start.isEqual(other.start) && this._end.isEqual(other.end);
    }
    intersection(other) {
        const start = Position.max(other.start, this._start);
        const end = Position.min(other.end, this._end);
        if (start.isAfter(end)) {
            // this happens when there is no overlap:
            // |-----|
            //          |----|
            return undefined;
        }
        return new Range(start, end);
    }
    union(other) {
        if (this.contains(other)) {
            return this;
        }
        else if (other.contains(this)) {
            return other;
        }
        const start = Position.min(other.start, this._start);
        const end = Position.max(other.end, this.end);
        return new Range(start, end);
    }
    get isEmpty() {
        return this._start.isEqual(this._end);
    }
    get isSingleLine() {
        return this._start.line === this._end.line;
    }
    with(startOrChange, end = this.end) {
        if (startOrChange === null || end === null) {
            throw illegalArgument();
        }
        let start;
        if (!startOrChange) {
            start = this.start;
        }
        else if (Position.isPosition(startOrChange)) {
            start = startOrChange;
        }
        else {
            start = startOrChange.start || this.start;
            end = startOrChange.end || this.end;
        }
        if (start.isEqual(this._start) && end.isEqual(this.end)) {
            return this;
        }
        return new Range(start, end);
    }
    toJSON() {
        return { start: this._start.toJSON(), end: this._end.toJSON() };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmFuZ2UuanMiLCJzb3VyY2VSb290Ijoic3JjLyIsInNvdXJjZXMiOlsiZXh0ZW5zaW9uL3R5cGVzL3JhbmdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDMUMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLFlBQVksQ0FBQTtBQUVyQyxNQUFNLE9BQU8sS0FBSztJQUNQLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBVTtRQUM1QixJQUFJLEtBQUssWUFBWSxLQUFLLEVBQUU7WUFDeEIsT0FBTyxJQUFJLENBQUE7U0FDZDtRQUNELElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDUixPQUFPLEtBQUssQ0FBQTtTQUNmO1FBQ0QsT0FBTyxRQUFRLENBQUMsVUFBVSxDQUFFLEtBQWUsQ0FBQyxLQUFLLENBQUMsSUFBSSxRQUFRLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxHQUFZLENBQUMsQ0FBQTtJQUNqRyxDQUFDO0lBS0QsSUFBVyxLQUFLO1FBQ1osT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFBO0lBQ3RCLENBQUM7SUFFRCxJQUFXLEdBQUc7UUFDVixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUE7SUFDcEIsQ0FBQztJQUlELFlBQ0ksZ0JBQStDLEVBQy9DLGdCQUErQyxFQUMvQyxPQUFnQixFQUNoQixTQUFrQjtRQUVsQixJQUFJLEtBQTJCLENBQUE7UUFDL0IsSUFBSSxHQUF5QixDQUFBO1FBRTdCLElBQ0ksT0FBTyxnQkFBZ0IsS0FBSyxRQUFRO1lBQ3BDLE9BQU8sZ0JBQWdCLEtBQUssUUFBUTtZQUNwQyxPQUFPLE9BQU8sS0FBSyxRQUFRO1lBQzNCLE9BQU8sU0FBUyxLQUFLLFFBQVEsRUFDL0I7WUFDRSxLQUFLLEdBQUcsSUFBSSxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQTtZQUN4RCxHQUFHLEdBQUcsSUFBSSxRQUFRLENBQUMsT0FBTyxFQUFFLFNBQVMsQ0FB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bnQiOlsiaW1wb3J0ICogYXMgc291cmNlZ3JhcGggZnJvbSAnc291cmNlZ3JhcGgnXG5pbXBvcnQgeyBpbGxlZ2FsQXJndW1lbnQgfSBmcm9tICcuL2Vycm9ycydcbmltcG9ydCB7IFBvc2l0aW9uIH0gZnJvbSAnLi9wb3NpdGlvbidcblxuZXhwb3J0IGNsYXNzIFJhbmdlIGltcGxlbWVudHMgc291cmNlZ3JhcGguUmFuZ2Uge1xuICAgIHB1YmxpYyBzdGF0aWMgaXNSYW5nZSh0aGluZzogYW55KTogdGhpbmcgaXMgc291cmNlZ3JhcGguUmFuZ2Uge1xuICAgICAgICBpZiAodGhpbmcgaW5zdGFuY2VvZiBSYW5nZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUG9zaXRpb24uaXNQb3NpdGlvbigodGhpbmcgYXMgUmFuZ2UpLnN0YXJ0KSAmJiBQb3NpdGlvbi5pc1Bvc2l0aW9uKHRoaW5nLmVuZCBhcyBSYW5nZSlcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgX3N0YXJ0OiBQb3NpdGlvblxuICAgIHByb3RlY3RlZCBfZW5kOiBQb3NpdGlvblxuXG4gICAgcHVibGljIGdldCBzdGFydCgpOiBzb3VyY2VncmFwaC5Qb3NpdGlvbiB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zdGFydFxuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgZW5kKCk6IHNvdXJjZWdyYXBoLlBvc2l0aW9uIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VuZFxuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHN0YXJ0OiBzb3VyY2VncmFwaC5Qb3NpdGlvbiwgZW5kOiBzb3VyY2VncmFwaC5Qb3NpdGlvbilcbiAgICBjb25zdHJ1Y3RvcihzdGFydExpbmU6IG51bWJlciwgc3RhcnRDb2x1bW46IG51bWJlciwgZW5kTGluZTogbnVtYmVyLCBlbmRDb2x1bW46IG51bWJlcilcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgc3RhcnRMaW5lT3JTdGFydDogbnVtYmVyIHwgc291cmNlZ3JhcGguUG9zaXRpb24sXG4gICAgICAgIHN0YXJ0Q29sdW1uT3JFbmQ6IG51bWJlciB8IHNvdXJjZWdyYXBoLlBvc2l0aW9uLFxuICAgICAgICBlbmRMaW5lPzogbnVtYmVyLFxuICAgICAgICBlbmRDb2x1bW4/OiBudW1iZXJcbiAgICApIHtcbiAgICAgICAgbGV0IHN0YXJ0OiBQb3NpdGlvbiB8IHVuZGVmaW5lZFxuICAgICAgICBsZXQgZW5kOiBQb3NpdGlvbiB8IHVuZGVmaW5lZFxuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIHR5cGVvZiBzdGFydExpbmVPclN0YXJ0ID09PSAnbnVtYmVyJyAmJlxuICAgICAgICAgICAgdHlwZW9mIHN0YXJ0Q29sdW1uT3JFbmQgPT09ICdudW1iZXInICYmXG4gICAgICAgICAgICB0eXBlb2YgZW5kTGluZSA9PT0gJ251bWJlcicgJiZcbiAgICAgICAgICAgIHR5cGVvZiBlbmRDb2x1bW4gPT09ICdudW1iZXInXG4gICAgICAgICkge1xuICAgICAgICAgICAgc3RhcnQgPSBuZXcgUG9zaXRpb24oc3RhcnRMaW5lT3JTdGFydCwgc3RhcnRDb2x1bW5PckVuZClcbiAgICAgICAgICAgIGVuZCA9IG5ldyBQb3NpdGlvbihlbmRMaW5lLCBlbmRDb2x1bW4pXG4gICAgICAgIH0gZWxzZSBpZiAoc3RhcnRMaW5lT3JTdGFydCBpbnN0YW5jZW9mIFBvc2l0aW9uICYmIHN0YXJ0Q29sdW1uT3JFbmQgaW5zdGFuY2VvZiBQb3NpdGlvbikge1xuICAgICAgICAgICAgc3RhcnQgPSBzdGFydExpbmVPclN0YXJ0XG4gICAgICAgICAgICBlbmQgPSBzdGFydENvbHVtbk9yRW5kXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXN0YXJ0IHx8ICFlbmQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBhcmd1bWVudHMnKVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHN0YXJ0LmlzQmVmb3JlKGVuZCkpIHtcbiAgICAgICAgICAgIHRoaXMuX3N0YXJ0ID0gc3RhcnRcbiAgICAgICAgICAgIHRoaXMuX2VuZCA9IGVuZFxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fc3RhcnQgPSBlbmRcbiAgICAgICAgICAgIHRoaXMuX2VuZCA9IHN0YXJ0XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgY29udGFpbnMocG9zaXRpb25PclJhbmdlOiBzb3VyY2VncmFwaC5Qb3NpdGlvbiB8IHNvdXJjZWdyYXBoLlJhbmdlKTogYm9vbGVhbiB7XG4gICAgICAgIGlmIChwb3NpdGlvbk9yUmFuZ2UgaW5zdGFuY2VvZiBSYW5nZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbnMocG9zaXRpb25PclJhbmdlLl9zdGFydCkgJiYgdGhpcy5jb250YWlucyhwb3NpdGlvbk9yUmFuZ2UuX2VuZClcbiAgICAgICAgfSBlbHNlIGlmIChwb3NpdGlvbk9yUmFuZ2UgaW5zdGFuY2VvZiBQb3NpdGlvbikge1xuICAgICAgICAgICAgaWYgKHBvc2l0aW9uT3JSYW5nZS5pc0JlZm9yZSh0aGlzLl9zdGFydCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLl9lbmQuaXNCZWZvcmUocG9zaXRpb25PclJhbmdlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICBwdWJsaWMgaXNFcXVhbChvdGhlcjogc291cmNlZ3JhcGguUmFuZ2UpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXJ0LmlzRXF1YWwob3RoZXIuc3RhcnQpICYmIHRoaXMuX2VuZC5pc0VxdWFsKG90aGVyLmVuZClcbiAgICB9XG5cbiAgICBwdWJsaWMgaW50ZXJzZWN0aW9uKG90aGVyOiBzb3VyY2VncmFwaC5SYW5nZSk6IHNvdXJjZWdyYXBoLlJhbmdlIHwgdW5kZWZpbmVkIHtcbiAgICAgICAgY29uc3Qgc3RhcnQgPSBQb3NpdGlvbi5tYXgob3RoZXIuc3RhcnQsIHRoaXMuX3N0YXJ0KVxuICAgICAgICBjb25zdCBlbmQgPSBQb3NpdGlvbi5taW4ob3RoZXIuZW5kLCB0aGlzLl9lbmQpXG4gICAgICAgIGlmIChzdGFydC5pc0FmdGVyKGVuZCkpIHtcbiAgICAgICAgICAgIC8vIHRoaXMgaGFwcGVucyB3aGVuIHRoZXJlIGlzIG5vIG92ZXJsYXA6XG4gICAgICAgICAgICAvLyB8LS0tLS18XG4gICAgICAgICAgICAvLyAgICAgICAgICB8LS0tLXxcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFJhbmdlKHN0YXJ0LCBlbmQpXG4gICAgfVxuXG4gICAgcHVibGljIHVuaW9uKG90aGVyOiBzb3VyY2VncmFwaC5SYW5nZSk6IHNvdXJjZWdyYXBoLlJhbmdlIHtcbiAgICAgICAgaWYgKHRoaXMuY29udGFpbnMob3RoZXIpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpc1xuICAgICAgICB9IGVsc2UgaWYgKG90aGVyLmNvbnRhaW5zKHRoaXMpKSB7XG4gICAgICAgICAgICByZXR1cm4gb3RoZXJcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzdGFydCA9IFBvc2l0aW9uLm1pbihvdGhlci5zdGFydCwgdGhpcy5fc3RhcnQpXG4gICAgICAgIGNvbnN0IGVuZCA9IFBvc2l0aW9uLm1heChvdGhlci5lbmQsIHRoaXMuZW5kKVxuICAgICAgICByZXR1cm4gbmV3IFJhbmdlKHN0YXJ0LCBlbmQpXG4gICAgfVxuXG4gICAgcHVibGljIGdldCBpc0VtcHR5KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fc3RhcnQuaXNFcXVhbCh0aGlzLl9lbmQpXG4gICAgfVxuXG4gICAgcHVibGljIGdldCBpc1NpbmdsZUxpbmUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zdGFydC5saW5lID09PSB0aGlzLl9lbmQubGluZVxuICAgIH1cblxuICAgIHB1YmxpYyB3aXRoKHN0YXJ0Pzogc291cmNlZ3JhcGguUG9zaXRpb24sIGVuZD86IHNvdXJjZWdyYXBoLlBvc2l0aW9uKTogc291cmNlZ3JhcGguUmFuZ2VcbiAgICBwdWJsaWMgd2l0aChjaGFuZ2U6IHsgc3RhcnQ/OiBzb3VyY2VncmFwaC5Qb3NpdGlvbjsgZW5kPzogc291cmNlZ3JhcGguUG9zaXRpb24gfSk6IHNvdXJjZWdyYXBoLlJhbmdlXG4gICAgcHVibGljIHdpdGgoXG4gICAgICAgIHN0YXJ0T3JDaGFuZ2U6IHNvdXJjZWdyYXBoLlBvc2l0aW9uIHwgdW5kZWZpbmVkIHwgeyBzdGFydD86IHNvdXJjZWdyYXBoLlBvc2l0aW9uOyBlbmQ/OiBzb3VyY2VncmFwaC5Qb3NpdGlvbiB9LFxuICAgICAgICBlbmQ6IHNvdXJjZWdyYXBoLlBvc2l0aW9uID0gdGhpcy5lbmRcbiAgICApOiBzb3VyY2VncmFwaC5SYW5nZSB7XG4gICAgICAgIGlmIChzdGFydE9yQ2hhbmdlID09PSBudWxsIHx8IGVuZCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgdGhyb3cgaWxsZWdhbEFyZ3VtZW50KClcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBzdGFydDogc291cmNlZ3JhcGguUG9zaXRpb25cbiAgICAgICAgaWYgKCFzdGFydE9yQ2hhbmdlKSB7XG4gICAgICAgICAgICBzdGFydCA9IHRoaXMuc3RhcnRcbiAgICAgICAgfSBlbHNlIGlmIChQb3NpdGlvbi5pc1Bvc2l0aW9uKHN0YXJ0T3JDaGFuZ2UpKSB7XG4gICAgICAgICAgICBzdGFydCA9IHN0YXJ0T3JDaGFuZ2VcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN0YXJ0ID0gc3RhcnRPckNoYW5nZS5zdGFydCB8fCB0aGlzLnN0YXJ0XG4gICAgICAgICAgICBlbmQgPSBzdGFydE9yQ2hhbmdlLmVuZCB8fCB0aGlzLmVuZFxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHN0YXJ0LmlzRXF1YWwodGhpcy5fc3RhcnQpICYmIGVuZC5pc0VxdWFsKHRoaXMuZW5kKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXNcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFJhbmdlKHN0YXJ0LCBlbmQpXG4gICAgfVxuXG4gICAgcHVibGljIHRvSlNPTigpOiBhbnkge1xuICAgICAgICByZXR1cm4geyBzdGFydDogdGhpcy5fc3RhcnQudG9KU09OKCksIGVuZDogdGhpcy5fZW5kLnRvSlNPTigpIH1cbiAgICB9XG59XG4iXX0=
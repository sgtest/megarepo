/** Valid token types in expressions. */
export var TokenType;
(function (TokenType) {
    /** An operator. */
    TokenType[TokenType["Operator"] = 0] = "Operator";
    /** An identifier. */
    TokenType[TokenType["Identifier"] = 1] = "Identifier";
    /** A string literal. */
    TokenType[TokenType["String"] = 2] = "String";
    /**
     * The start of a template until its first expression.
     *
     * See https://tc39.github.io/ecma262/#sec-template-literal-lexical-components for documentation on the
     * ECMAScript lexical components for templates, upon which this is based.
     */
    TokenType[TokenType["TemplateHead"] = 3] = "TemplateHead";
    /** The end of a previous template expression until the next template expression. */
    TokenType[TokenType["TemplateMiddle"] = 4] = "TemplateMiddle";
    /** The end of a previous template expression until the end of the template. */
    TokenType[TokenType["TemplateTail"] = 5] = "TemplateTail";
    /** A template with no substitutions. */
    TokenType[TokenType["NoSubstitutionTemplate"] = 6] = "NoSubstitutionTemplate";
    /** A number literal. */
    TokenType[TokenType["Number"] = 7] = "Number";
})(TokenType || (TokenType = {}));
/**
 * All valid operators in expressions. The values are the operator precedence (or, for operators that are not operators, 0). This
 * must be kept in sync with OPERATOR_CHARS.
 *
 * Exported for testing only.
 */
export const OPERATORS = {
    '(': 0,
    ')': 0,
    '}': 0,
    ',': 0,
    '=': 0,
    '||': 1,
    '&&': 2,
    '^': 4,
    '==': 6,
    '!=': 6,
    '===': 6,
    '!==': 6,
    '<': 7,
    '>': 7,
    '<=': 7,
    '>=': 7,
    '+': 9,
    '-': 9,
    '*': 10,
    '/': 10,
    '%': 10,
    '!': 11,
};
/**
 * A tree with the next valid operator characters for multi-character operators. This must be kept in sync with
 * OPERATORS.
 *
 * Exported for testing only.
 */
export const OPERATOR_CHARS = {
    '&': { '&': true },
    '|': { '|': true },
    '=': {
        '\x00': true,
        '=': {
            '\x00': true,
            '=': true,
        },
    },
    '!': {
        '\x00': true,
        '=': {
            '\x00': true,
            '=': true,
        },
    },
    '<': { '\x00': true, '=': true },
    '>': { '\x00': true, '=': true },
    '^': true,
    '}': true,
    '(': true,
    ')': true,
    ',': true,
    '+': true,
    '-': true,
    '*': true,
    '/': true,
    '%': true,
};
function isWhiteSpace(ch) {
    return ch === '\u0009' || ch === ' ' || ch === '\u00A0';
}
function isLetter(ch) {
    return (ch >= 'a' && ch <= 'z') || (ch >= 'A' && ch <= 'Z');
}
function isDecimalDigit(ch) {
    return ch >= '0' && ch <= '9';
}
function isIdentifierStart(ch) {
    return ch === '_' || isLetter(ch);
}
function isIdentifierPart(ch) {
    return isIdentifierStart(ch) || isDecimalDigit(ch) || ch === '.';
}
/** The token that indicates the beginning of a template string. */
export const TEMPLATE_BEGIN = '${'; // tslint:disable-line:no-invalid-template-strings
/** Scans an expression. */
export class Lexer {
    constructor() {
        this.expression = '';
        this.length = 0;
        this._index = 0;
        this.marker = 0;
        this.curlyStack = 0;
    }
    /** The current character position of the lexer's cursor. */
    get index() {
        return this._index;
    }
    reset(str) {
        this.expression = str;
        this.length = str.length;
        this._index = 0;
        this.curlyStack = 0;
    }
    next() {
        this.skipSpaces();
        if (this._index >= this.length) {
            return undefined;
        }
        this.marker = this._index;
        const token = this.scanNext();
        if (token !== undefined) {
            return token;
        }
        throw new SyntaxError(`Unexpected character ${JSON.stringify(this.peekNextChar())} (at ${this.index})`);
    }
    peek() {
        const savedIndex = this._index;
        const savedCurlyStack = this.curlyStack;
        let token;
        try {
            token = this.next();
            if (token) {
                delete token.start;
                delete token.end;
            }
        }
        catch (e) {
            token = undefined;
        }
        this._index = savedIndex;
        this.curlyStack = savedCurlyStack;
        return token;
    }
    scanNext() {
        let token = this.scanString();
        if (token !== undefined) {
            return token;
        }
        token = this.scanTemplate();
        if (token !== undefined) {
            return token;
        }
        token = this.scanNumber();
        if (token !== undefined) {
            return token;
        }
        token = this.scanOperator();
        if (token !== undefined) {
            return token;
        }
        token = this.scanIdentifier();
        if (token !== undefined) {
            return token;
        }
        return undefined;
    }
    peekNextChar(advance = 0) {
        const idx = this._index + advance;
        return idx < this.length ? this.expression.charAt(idx) : '\x00';
    }
    getNextChar() {
        let ch = '\x00';
        const idx = this._index;
        if (idx < this.length) {
            ch = this.expression.charAt(idx);
            this._index += 1;
        }
        return ch;
    }
    createToken(type, value) {
        return {
            type,
            value,
            start: this.marker,
            end: this._index,
        };
    }
    skipSpaces() {
        while (this._index < this.length) {
            const ch = this.peekNextChar();
            if (!isWhiteSpace(ch)) {
                break;
            }
            this.getNextChar();
        }
    }
    scanOperator() {
        let searchTree = OPERATOR_CHARS;
        let value = '';
        while (searchTree && searchTree !== true) {
            const ch = this.peekNextChar();
            searchTree = searchTree[ch];
            if (searchTree) {
                value += ch;
                this.getNextChar();
            }
        }
        if (value === '}') {
            this.curlyStack--;
        }
        if (value === '') {
            return undefined;
        }
        return this.createToken(TokenType.Operator, value);
    }
    scanIdentifier() {
        let ch = this.peekNextChar();
        if (!isIdentifierStart(ch)) {
            return undefined;
        }
        let id = this.getNextChar();
        while (true) {
            ch = this.peekNextChar();
            if (!isIdentifierPart(ch)) {
                break;
            }
            id += this.getNextChar();
        }
        return this.createToken(TokenType.Identifier, id);
    }
    scanString() {
        const quote = this.peekNextChar();
        if (quote !== "'" && quote !== '"') {
            return undefined;
        }
        this.getNextChar();
        let terminated = false;
        let str = '';
        while (this._index < this.length) {
            const ch = this.getNextChar();
            if (ch === quote) {
                terminated = true;
                break;
            }
            else if (ch === '\\') {
                str += backslashEscapeCodeString(this.getNextChar());
            }
            else {
                str += ch;
            }
        }
        if (!terminated) {
            throw new Error(`Unterminated string literal (at ${this.index})`);
        }
        return this.createToken(TokenType.String, str);
    }
    scanTemplate() {
        const ch = this.peekNextChar();
        // tslint:disable-next-line:no-invalid-template-strings
        if (!(ch === '`' || (ch === '}' && this.curlyStack > 0))) {
            return undefined;
        }
        this.getNextChar();
        const head = ch === '`';
        return this.doScanTemplate(head);
    }
    backtick() {
        return true;
    }
    doScanTemplate(head) {
        let tail = false;
        let terminated = false;
        let hasSubstitution = false;
        let str = '';
        while (this._index < this.length) {
            const ch = this.getNextChar();
            if (ch === '`' && this.backtick()) {
                tail = true;
                terminated = true;
                break;
            }
            else if (ch === '\\') {
                str += backslashEscapeCodeString(this.getNextChar());
            }
            else {
                if (ch === '$') {
                    const ch2 = this.peekNextChar();
                    if (ch2 === '{') {
                        // tslint:disable-next-line:no-invalid-template-strings
                        this.curlyStack++;
                        this.getNextChar();
                        terminated = true;
                        hasSubstitution = true;
                        break;
                    }
                }
                str += ch;
            }
        }
        if (!head) {
            this.curlyStack--;
        }
        if (this.backtick()) {
            if (!terminated) {
                throw new Error(`Unterminated template literal (at ${this.index})`);
            }
        }
        else if (this._index === this.length) {
            tail = true;
        }
        let type;
        if (head && terminated && !hasSubstitution) {
            type = TokenType.NoSubstitutionTemplate;
        }
        else if (head) {
            type = TokenType.TemplateHead;
        }
        else if (tail) {
            type = TokenType.TemplateTail;
        }
        else {
            type = TokenType.TemplateMiddle;
        }
        return this.createToken(type, str);
    }
    scanNumber() {
        let ch = this.peekNextChar();
        if (!isDecimalDigit(ch) && ch !== '.') {
            return undefined;
        }
        let num = '';
        if (ch !== '.') {
            num = this.getNextChar();
            while (true) {
                ch = this.peekNextChar();
                if (!isDecimalDigit(ch)) {
                    break;
                }
                num += this.getNextChar();
            }
        }
        if (ch === '.') {
            num += this.getNextChar();
            while (true) {
                ch = this.peekNextChar();
                if (!isDecimalDigit(ch)) {
                    break;
                }
                num += this.getNextChar();
            }
        }
        if (ch === 'e' || ch === 'E') {
            num += this.getNextChar();
            ch = this.peekNextChar();
            if (ch === '+' || ch === '-' || isDecimalDigit(ch)) {
                num += this.getNextChar();
                while (true) {
                    ch = this.peekNextChar();
                    if (!isDecimalDigit(ch)) {
                        break;
                    }
                    num += this.getNextChar();
                }
            }
            else {
                ch = `character ${JSON.stringify(ch)}`;
                if (this._index >= this.length) {
                    ch = '<end>';
                }
                throw new SyntaxError(`Unexpected ${ch} after the exponent sign (at ${this.index})`);
            }
        }
        if (num === '.') {
            throw new SyntaxError(`Expected decimal digits after the dot sign (at ${this.index})`);
        }
        return this.createToken(TokenType.Number, num);
    }
}
/** Scans a template. */
export class TemplateLexer extends Lexer {
    next() {
        if (this._index === 0) {
            return this.doScanTemplate(true);
        }
        return super.next();
    }
    backtick() {
        // The root is not surrounded with backticks.
        return this.curlyStack !== 0;
    }
}
function backslashEscapeCodeString(ch) {
    switch (ch) {
        case 'n':
            return '\n';
        case 'r':
            return '\r';
        case 't':
            return '\t';
        default:
            return ch;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGV4ZXIuanMiLCJzb3VyY2VSb290Ijoic3JjLyIsInNvdXJjZXMiOlsiY2xpZW50L2NvbnRleHQvZXhwci9sZXhlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSx3Q0FBd0M7QUFDeEMsTUFBTSxDQUFOLElBQVksU0E2Qlg7QUE3QkQsV0FBWSxTQUFTO0lBQ2pCLG1CQUFtQjtJQUNuQixpREFBUSxDQUFBO0lBRVIscUJBQXFCO0lBQ3JCLHFEQUFVLENBQUE7SUFFVix3QkFBd0I7SUFDeEIsNkNBQU0sQ0FBQTtJQUVOOzs7OztPQUtHO0lBQ0gseURBQVksQ0FBQTtJQUVaLG9GQUFvRjtJQUNwRiw2REFBYyxDQUFBO0lBRWQsK0VBQStFO0lBQy9FLHlEQUFZLENBQUE7SUFFWix3Q0FBd0M7SUFDeEMsNkVBQXNCLENBQUE7SUFFdEIsd0JBQXdCO0lBQ3hCLDZDQUFNLENBQUE7QUFDVixDQUFDLEVBN0JXLFNBQVMsS0FBVCxTQUFTLFFBNkJwQjtBQXNCRDs7Ozs7R0FLRztBQUNILE1BQU0sQ0FBQyxNQUFNLFNBQVMsR0FBRztJQUNyQixHQUFHLEVBQUUsQ0FBQztJQUNOLEdBQUcsRUFBRSxDQUFDO0lBQ04sR0FBRyxFQUFFLENBQUM7SUFDTixHQUFHLEVBQUUsQ0FBQztJQUNOLEdBQUcsRUFBRSxDQUFDO0lBQ04sSUFBSSxFQUFFLENBQUM7SUFDUCxJQUFJLEVBQUUsQ0FBQztJQUNQLEdBQUcsRUFBRSxDQUFDO0lBQ04sSUFBSSxFQUFFLENBQUM7SUFDUCxJQUFJLEVBQUUsQ0FBQztJQUNQLEtBQUssRUFBRSxDQUFDO0lBQ1IsS0FBSyxFQUFFLENBQUM7SUFDUixHQUFHLEVBQUUsQ0FBQztJQUNOLEdBQUcsRUFBRSxDQUFDO0lBQ04sSUFBSSxFQUFFLENBQUM7SUFDUCxJQUFJLEVBQUUsQ0FBQztJQUNQLEdBQUcsRUFBRSxDQUFDO0lBQ04sR0FBRyxFQUFFLENBQUM7SUFDTixHQUFHLEVBQUUsRUFBRTtJQUNQLEdBQUcsRUFBRSxFQUFFO0lBQ1AsR0FBRyxFQUFFLEVBQUU7SUFDUCxHQUFHLEVBQUUsRUFBRTtDQUNWLENBQUE7QUFPRDs7Ozs7R0FLRztBQUNILE1BQU0sQ0FBQyxNQUFNLGNBQWMsR0FBbUM7SUFDMUQsR0FBRyxFQUFFLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRTtJQUNsQixHQUFHLEVBQUUsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFO0lBQ2xCLEdBQUcsRUFBRTtRQUNELE1BQU0sRUFBRSxJQUFJO1FBQ1osR0FBRyxFQUFFO1lBQ0QsTUFBTSxFQUFFLElBQUk7WUFDWixHQUFHLEVBQUUsSUFBSTtTQUNaO0tBQ0o7SUFDRCxHQUFHLEVBQUU7UUFDRCxNQUFNLEVBQUUsSUFBSTtRQUNaLEdBQUcsRUFBRTtZQUNELE1BQU0sRUFBRSxJQUFJO1lBQ1osR0FBRyxFQUFFLElBQUk7U0FDWjtLQUNKO0lBQ0QsR0FBRyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFO0lBQ2hDLEdBQUcsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRTtJQUNoQyxHQUFHLEVBQUUsSUFBSTtJQUNULEdBQUcsRUFBRSxJQUFJO0lBQ1QsR0FBRyxFQUFFLElBQUk7SUFDVCxHQUFHLEVBQUUsSUFBSTtJQUNULEdBQUcsRUFBRSxJQUFJO0lBQ1QsR0FBRyxFQUFFLElBQUk7SUFDVCxHQUFHLEVBQUUsSUFBSTtJQUNULEdBQUcsRUFBRSxJQUFJO0lBQ1QsR0FBRyxFQUFFLElBQUk7SUFDVCxHQUFHLEVBQUUsSUFBSTtDQUNaLENBQUE7QUFFRCxTQUFTLFlBQVksQ0FBQyxFQUFVO0lBQzVCLE9BQU8sRUFBRSxLQUFLLFFBQVEsSUFBSSxFQUFFLEtBQUssR0FBRyxJQUFJLEVBQUUsS0FBSyxRQUFRLENBQUE7QUFDM0QsQ0FBQztBQUVELFNBQVMsUUFBUSxDQUFDLEVBQVU7SUFDeEIsT0FBTyxDQUFDLEVBQUUsSUFBSSxHQUFHLElBQUksRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEdBQUcsSUFBSSxFQUFFLElBQUksR0FBRyxDQUFDLENBQUE7QUFDL0QsQ0FBQztBQUVELFNBQVMsY0FBYyxDQUFDLEVBQVU7SUFDOUIsT0FBTyxFQUFFLElBQUksR0FBRyxJQUFJLEVBQUUsSUFBSSxHQUFHLENBQUE7QUFDakMsQ0FBQztBQUVELFNBQVMsaUJBQWlCLENBQUMsRUFBVTtJQUNqQyxPQUFPLEVBQUUsS0FBSyxHQUFHLElBQUksUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFBO0FBQ3JDLENBQUM7QUFFRCxTQUFTLGdCQUFnQixDQUFDLEVBQVU7SUFDaEMsT0FBTyxpQkFBaUIsQ0FBQyxFQUFFLENBQUMsSUFBSSxjQUFjLENBQUMsRUFBRSxDQUFDLElBQUksRUFBRSxLQUFLLEdBQUcsQ0FBQTtBQUNwRSxDQUFDO0FBRUQsbUVBQW1FO0FBQ25FLE1BQU0sQ0FBQyxNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUEsQ0FBQyxrREFBa0Q7QUFFckYsMkJBQTJCO0FBQzNCLE1BQU0sT0FBTyxLQUFLO0lBQWxCO1FBQ1ksZUFBVSxHQUFHLEVBQUUsQ0FBQTtRQUNmLFdBQU0sR0FBRyxDQUFDLENBQUE7UUFDUixXQUFNLEdBQUcsQ0FBQyxDQUFBO1FBQ1osV0FBTSxHQUFHLENBQUMsQ0FBQTtRQUNSLGVBQVUsR0FBRyxDQUFDLENBQUE7SUE2UzVCLENBQUM7SUEzU0csNERBQTREO0lBQzVELElBQVcsS0FBSztRQUNaLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQTtJQUN0QixDQUFDO0lBRU0sS0FBSyxDQUFDLEdBQVc7UUFDcEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUE7UUFDckIsSUFBSSxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFBO1FBQ3hCLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFBO1FBQ2YsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUE7SUFDdkIsQ0FBQztJQUVNLElBQUk7UUFDUCxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUE7UUFDakIsSUFBSSxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDNUIsT0FBTyxTQUFTLENBQUE7U0FDbkI7UUFFRCxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUE7UUFFekIsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFBO1FBQzdCLElBQUksS0FBSyxLQUFLLFNBQVMsRUFBRTtZQUNyQixPQUFPLEtBQUssQ0FBQTtTQUNmO1FBRUQsTUFBTSxJQUFJLFdBQVcsQ0FBQyx3QkFBd0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsUUFBUSxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQTtJQUMzRyxDQUFDO0lBRU0sSUFBSTtRQUNQLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUE7UUFDOUIsTUFBTSxlQUFlLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQTtRQUN2QyxJQUFJLEtBQXdCLENBQUE7UUFDNUIsSUFBSTtZQUNBLEtBQUssR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUE7WUFDbkIsSUFBSSxLQUFLLEVBQUU7Z0JBQ1AsT0FBTyxLQUFLLENBQUMsS0FBSyxDQUFBO2dCQUNsQixPQUFPLEtBQUssQ0FBQyxHQUFHLENBQUE7YUFDbkI7U0FDSjtRQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ1IsS0FBSyxHQUFHLFNBQVMsQ0FBQTtTQUNwQjtRQUNELElBQUksQ0FBQyxNQUFNLEdBQUcsVUFBVSxDQUFBO1FBQ3hCLElBQUksQ0FBQyxVQUFVLEdBQUcsZUFBZSxDQUFBO1FBRWpDLE9BQU8sS0FBSyxDQUFBO0lBQ2hCLENBQUM7SUFFUyxRQUFRO1FBQ2QsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFBO1FBQzdCLElBQUksS0FBSyxLQUFLLFNBQVMsRUFBRTtZQUNyQixPQUFPLEtBQUssQ0FBQTtTQUNmO1FBRUQsS0FBSyxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQTtRQUMzQixJQUFJLEtBQUssS0FBSyxTQUFTLEVBQUU7WUFDckIsT0FBTyxLQUFLLENBQUE7U0FDZjtRQUVELEtBQUssR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUE7UUFDekIsSUFBSSxLQUFLLEtBQUssU0FBUyxFQUFFO1lBQ3JCLE9BQU8sS0FBSyxDQUFBO1NBQ2Y7UUFFRCxLQUFLLEdBQUcsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFBO1FBQzNCLElBQUksS0FBSyxLQUFLLFNBQVMsRUFBRTtZQUNyQixPQUFPLEtBQUssQ0FBQTtTQUNmO1FBRUQsS0FBSyxHQUFHLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQTtRQUM3QixJQUFJLEtBQUssS0FBSyxTQUFTLEVBQUU7WUFDckIsT0FBTyxLQUFLLENBQUE7U0FDZjtRQUVELE9BQU8sU0FBUyxDQUFBO0lBQ3BCLENBQUM7SUFFTyxZQUFZLENBQUMsT0FBTyxHQUFHLENBQUM7UUFDNUIsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sR0FBRyxPQUFPLENBQUE7UUFDakMsT0FBTyxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQTtJQUNuRSxDQUFDO0lBRU8sV0FBVztRQUNmLElBQUksRUFBRSxHQUFHLE1BQU0sQ0FBQTtRQUNmLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUE7UUFDdkIsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNuQixFQUFFLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDaEMsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUE7U0FDbkI7UUFDRCxPQUFPLEVBQUUsQ0FBQTtJQUNiLENBQUM7SUFFTyxXQUFXLENBQUMsSUFBZSxFQUFFLEtBQVU7UUFDM0MsT0FBTztZQUNILElBQUk7WUFDSixLQUFLO1lBQ0wsS0FBSyxFQUFFLElBQUksQ0FBQyxNQUFNO1lBQ2xCLEdBQUcsRUFBRSxJQUFJLENBQUMsTUFBTTtTQUNuQixDQUFBO0lBQ0wsQ0FBQztJQUVPLFVBQVU7UUFDZCxPQUFPLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUM5QixNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUE7WUFDOUIsSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsRUFBRTtnQkFDbkIsTUFBSzthQUNSO1lBQ0QsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFBO1NBQ3JCO0lBQ0wsQ0FBQztJQUVPLFlBQVk7UUFDaEIsSUFBSSxVQUFVLEdBQTJCLGNBQWMsQ0FBQTtRQUN2RCxJQUFJLEtBQUssR0FBRyxFQUFFLENBQUE7UUFDZCxPQUFPLFVBQVUsSUFBSSxVQUFVLEtBQUssSUFBSSxFQUFFO1lBQ3RDLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQTtZQUM5QixVQUFVLEdBQUcsVUFBVSxDQUFDLEVBQUUsQ0FBQyxDQUFBO1lBQzNCLElBQUksVUFBVSxFQUFFO2dCQUNaLEtBQUssSUFBSSxFQUFFLENBQUE7Z0JBQ1gsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFBO2FBQ3JCO1NBQ0o7UUFDRCxJQUFJLEtBQUssS0FBSyxHQUFHLEVBQUU7WUFDZixJQUFJLENBQUMsVUFBVSxFQUFFLENBQUE7U0FDcEI7UUFDRCxJQUFJLEtBQUssS0FBSyxFQUFFLEVBQUU7WUFDZCxPQUFPLFNBQVMsQ0FBQTtTQUNuQjtRQUNELE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFBO0lBQ3RELENBQUM7SUFFTyxjQUFjO1FBQ2xCLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQTtRQUM1QixJQUFJLENBQUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDLEVBQUU7WUFDeEIsT0FBTyxTQUFTLENBQUE7U0FDbkI7UUFFRCxJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUE7UUFDM0IsT0FBTyxJQUFJLEVBQUU7WUFDVCxFQUFFLEdBQUcsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFBO1lBQ3hCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLENBQUMsRUFBRTtnQkFDdkIsTUFBSzthQUNSO1lBQ0QsRUFBRSxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQTtTQUMzQjtRQUVELE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQyxDQUFBO0lBQ3JELENBQUM7SUFFTyxVQUFVO1FBQ2QsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFBO1FBQ2pDLElBQUksS0FBSyxLQUFLLEdBQUcsSUFBSSxLQUFLLEtBQUssR0FBRyxFQUFFO1lBQ2hDLE9BQU8sU0FBUyxDQUFBO1NBQ25CO1FBQ0QsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFBO1FBRWxCLElBQUksVUFBVSxHQUFHLEtBQUssQ0FBQTtRQUN0QixJQUFJLEdBQUcsR0FBRyxFQUFFLENBQUE7UUFDWixPQUFPLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUM5QixNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUE7WUFDN0IsSUFBSSxFQUFFLEtBQUssS0FBSyxFQUFFO2dCQUNkLFVBQVUsR0FBRyxJQUFJLENBQUE7Z0JBQ2pCLE1BQUs7YUFDUjtpQkFBTSxJQUFJLEVBQUUsS0FBSyxJQUFJLEVBQUU7Z0JBQ3BCLEdBQUcsSUFBSSx5QkFBeUIsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQTthQUN2RDtpQkFBTTtnQkFDSCxHQUFHLElBQUksRUFBRSxDQUFBO2FBQ1o7U0FDSjtRQUNELElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDYixNQUFNLElBQUksS0FBSyxDQUFDLG1DQUFtQyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQTtTQUNwRTtRQUNELE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQ2xELENBQUM7SUFFTyxZQUFZO1FBQ2hCLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQTtRQUM5Qix1REFBdUQ7UUFDdkQsSUFBSSxDQUFDLENBQUMsRUFBRSxLQUFLLEdBQUcsSUFBSSxDQUFDLEVBQUUsS0FBSyxHQUFHLElBQUksSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFO1lBQ3RELE9BQU8sU0FBUyxDQUFBO1NBQ25CO1FBQ0QsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFBO1FBRWxCLE1BQU0sSUFBSSxHQUFHLEVBQUUsS0FBSyxHQUFHLENBQUE7UUFDdkIsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQ3BDLENBQUM7SUFFUyxRQUFRO1FBQ2QsT0FBTyxJQUFJLENBQUE7SUFDZixDQUFDO0lBRVMsY0FBYyxDQUFDLElBQWE7UUFDbEMsSUFBSSxJQUFJLEdBQUcsS0FBSyxDQUFBO1FBRWhCLElBQUksVUFBVSxHQUFHLEtBQUssQ0FBQTtRQUN0QixJQUFJLGVBQWUsR0FBRyxLQUFLLENBQUE7UUFDM0IsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFBO1FBQ1osT0FBTyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDOUIsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFBO1lBQzdCLElBQUksRUFBRSxLQUFLLEdBQUcsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFLEVBQUU7Z0JBQy9CLElBQUksR0FBRyxJQUFJLENBQUE7Z0JBQ1gsVUFBVSxHQUFHLElBQUksQ0FBQTtnQkFDakIsTUFBSzthQUNSO2lCQUFNLElBQUksRUFBRSxLQUFLLElBQUksRUFBRTtnQkFDcEIsR0FBRyxJQUFJLHlCQUF5QixDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFBO2FBQ3ZEO2lCQUFNO2dCQUNILElBQUksRUFBRSxLQUFLLEdBQUcsRUFBRTtvQkFDWixNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUE7b0JBQy9CLElBQUksR0FBRyxLQUFLLEdBQUcsRUFBRTt3QkFDYix1REFBdUQ7d0JBQ3ZELElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQTt3QkFDakIsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFBO3dCQUNsQixVQUFVLEdBQUcsSUFBSSxDQUFBO3dCQUNqQixlQUFlLEdBQUcsSUFBSSxDQUFBO3dCQUN0QixNQUFLO3FCQUNSO2lCQUNKO2dCQUNELEdBQUcsSUFBSSxFQUFFLENBQUE7YUFDWjtTQUNKO1FBQ0QsSUFBSSxDQUFDLElBQUksRUFBRTtZQUNQLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQTtTQUNwQjtRQUNELElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRSxFQUFFO1lBQ2pCLElBQUksQ0FBQyxVQUFVLEVBQUU7Z0JBQ2IsTUFBTSxJQUFJLEtBQUssQ0FBQyxxQ0FBcUMsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUE7YUFDdEU7U0FDSjthQUFNLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ3BDLElBQUksR0FBRyxJQUFJLENBQUE7U0FDZDtRQUVELElBQUksSUFBZSxDQUFBO1FBQ25CLElBQUksSUFBSSxJQUFJLFVBQVUsSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUN4QyxJQUFJLEdBQUcsU0FBUyxDQUFDLHNCQUFzQixDQUFBO1NBQzFDO2FBQU0sSUFBSSxJQUFJLEVBQUU7WUFDYixJQUFJLEdBQUcsU0FBUyxDQUFDLFlBQVksQ0FBQTtTQUNoQzthQUFNLElBQUksSUFBSSxFQUFFO1lBQ2IsSUFBSSxHQUFHLFNBQVMsQ0FBQyxZQUFZLENBQUE7U0FDaEM7YUFBTTtZQUNILElBQUksR0FBRyxTQUFTLENBQUMsY0FBYyxDQUFBO1NBQ2xDO1FBQ0QsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQTtJQUN0QyxDQUFDO0lBRU8sVUFBVTtRQUNkLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQTtRQUM1QixJQUFJLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQyxJQUFJLEVBQUUsS0FBSyxHQUFHLEVBQUU7WUFDbkMsT0FBTyxTQUFTLENBQUE7U0FDbkI7UUFFRCxJQUFJLEdBQUcsR0FBRyxFQUFFLENBQUE7UUFDWixJQUFJLEVBQUUsS0FBSyxHQUFHLEVBQUU7WUFDWixHQUFHLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFBO1lBQ3hCLE9BQU8sSUFBSSxFQUFFO2dCQUNULEVBQUUsR0FBRyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUE7Z0JBQ3hCLElBQUksQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDLEVBQUU7b0JBQ3JCLE1BQUs7aUJBQ1I7Z0JBQ0QsR0FBRyxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQTthQUM1QjtTQUNKO1FBRUQsSUFBSSxFQUFFLEtBQUssR0FBRyxFQUFFO1lBQ1osR0FBRyxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQTtZQUN6QixPQUFPLElBQUksRUFBRTtnQkFDVCxFQUFFLEdBQUcsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFBO2dCQUN4QixJQUFJLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQyxFQUFFO29CQUNyQixNQUFLO2lCQUNSO2dCQUNELEdBQUcsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUE7YUFDNUI7U0FDSjtRQUVELElBQUksRUFBRSxLQUFLLEdBQUcsSUFBSSxFQUFFLEtBQUssR0FBRyxFQUFFO1lBQzFCLEdBQUcsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUE7WUFDekIsRUFBRSxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQTtZQUN4QixJQUFJLEVBQUUsS0FBSyxHQUFHLElBQUksRUFBRSxLQUFLLEdBQUcsSUFBSSxjQUFjLENBQUMsRUFBRSxDQUFDLEVBQUU7Z0JBQ2hELEdBQUcsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUE7Z0JBQ3pCLE9BQU8sSUFBSSxFQUFFO29CQUNULEVBQUUsR0FBRyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUE7b0JBQ3hCLElBQUksQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDLEVBQUU7d0JBQ3JCLE1BQUs7cUJBQ1I7b0JBQ0QsR0FBRyxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQTtpQkFDNUI7YUFDSjtpQkFBTTtnQkFDSCxFQUFFLEdBQUcsYUFBYSxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUE7Z0JBQ3RDLElBQUksSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFO29CQUM1QixFQUFFLEdBQUcsT0FBTyxDQUFBO2lCQUNmO2dCQUNELE1BQU0sSUFBSSxXQUFXLENBQUMsY0FBYyxFQUFFLGdDQUFnQyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQTthQUN2RjtTQUNKO1FBRUQsSUFBSSxHQUFHLEtBQUssR0FBRyxFQUFFO1lBQ2IsTUFBTSxJQUFJLFdBQVcsQ0FBQyxrREFBa0QsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUE7U0FDekY7UUFFRCxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQTtJQUNsRCxDQUFDO0NBQ0o7QUFFRCx3QkFBd0I7QUFDeEIsTUFBTSxPQUFPLGFBQWMsU0FBUSxLQUFLO0lBQzdCLElBQUk7UUFDUCxJQUFJLElBQUksQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ25CLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQTtTQUNuQztRQUNELE9BQU8sS0FBSyxDQUFDLElBQUksRUFBRSxDQUFBO0lBQ3ZCLENBQUM7SUFFUyxRQUFRO1FBQ2QsNkNBQTZDO1FBQzdDLE9BQU8sSUFBSSxDQUFDLFVBQVUsS0FBSyxDQUFDLENBQUE7SUFDaEMsQ0FBQztDQUNKO0FBRUQsU0FBUyx5QkFBeUIsQ0FBQyxFQUFVO0lBQ3pDLFFBQVEsRUFBRSxFQUFFO1FBQ1IsS0FBSyxHQUFHO1lBQ0osT0FBTyxJQUFJLENBQUE7UUFDZixLQUFLLEdBQUc7WUFDSixPQUFPLElBQUksQ0FBQTtRQUNmLEtBQUssR0FBRztZQUNKLE9BQU8sSUFBSSxDQUFBO1FBQ2Y7WUFDSSxPQUFPLEVBQUUsQ0FBQTtLQUNoQjtBQUNMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiogVmFsaWQgdG9rZW4gdHlwZXMgaW4gZXhwcmVzc2lvbnMuICovXG5leHBvcnQgZW51bSBUb2tlblR5cGUge1xuICAgIC8qKiBBbiBvcGVyYXRvci4gKi9cbiAgICBPcGVyYXRvcixcblxuICAgIC8qKiBBbiBpZGVudGlmaWVyLiAqL1xuICAgIElkZW50aWZpZXIsXG5cbiAgICAvKiogQSBzdHJpbmcgbGl0ZXJhbC4gKi9cbiAgICBTdHJpbmcsXG5cbiAgICAvKipcbiAgICAgKiBUaGUgc3RhcnQgb2YgYSB0ZW1wbGF0ZSB1bnRpbCBpdHMgZmlyc3QgZXhwcmVzc2lvbi5cbiAgICAgKlxuICAgICAqIFNlZSBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy10ZW1wbGF0ZS1saXRlcmFsLWxleGljYWwtY29tcG9uZW50cyBmb3IgZG9jdW1lbnRhdGlvbiBvbiB0aGVcbiAgICAgKiBFQ01BU2NyaXB0IGxleGljYWwgY29tcG9uZW50cyBmb3IgdGVtcGxhdGVzLCB1cG9uIHdoaWNoIHRoaXMgaXMgYmFzZWQuXG4gICAgICovXG4gICAgVGVtcGxhdGVIZWFkLFxuXG4gICAgLyoqIFRoZSBlbmQgb2YgYSBwcmV2aW91cyB0ZW1wbGF0ZSBleHByZXNzaW9uIHVudGlsIHRoZSBuZXh0IHRlbXBsYXRlIGV4cHJlc3Npb24uICovXG4gICAgVGVtcGxhdGVNaWRkbGUsXG5cbiAgICAvKiogVGhlIGVuZCBvZiBhIHByZXZpb3VzIHRlbXBsYXRlIGV4cHJlc3Npb24gdW50aWwgdGhlIGVuZCBvZiB0aGUgdGVtcGxhdGUuICovXG4gICAgVGVtcGxhdGVUYWlsLFxuXG4gICAgLyoqIEEgdGVtcGxhdGUgd2l0aCBubyBzdWJzdGl0dXRpb25zLiAqL1xuICAgIE5vU3Vic3RpdHV0aW9uVGVtcGxhdGUsXG5cbiAgICAvKiogQSBudW1iZXIgbGl0ZXJhbC4gKi9cbiAgICBOdW1iZXIsXG59XG5cbi8qKiBBIHRva2VuIHRoYXQgdGhlIGV4cHJlc3Npb24gbGV4ZXIgc2Nhbm5lZCBpbiBhbiBleHByZXNzaW9uLiAqL1xuZXhwb3J0IGludGVyZmFjZSBUb2tlbiB7XG4gICAgLyoqIFRoZSB0eXBlIG9mIHRoaXMgdG9rZW4uICovXG4gICAgdHlwZTogVG9rZW5UeXBlXG5cbiAgICAvKipcbiAgICAgKiBUaGUgdG9rZW4ncyB2YWx1ZS5cbiAgICAgKlxuICAgICAqIEZvciBzdHJpbmcgYW5kIHRlbXBsYXRlIGxpdGVyYWxzLCB0aGlzIGlzIHRoZSBwYXJzZWQgc3RyaW5nIHZhbHVlIChhZnRlciBhY2NvdW50aW5nIGZvciBlc2NhcGUgc2VxdWVuY2VzIGJ1dFxuICAgICAqIG5vdCB0ZW1wbGF0ZSBleHByZXNzaW9ucykuIEZvciBudW1iZXIgbGl0ZXJhbHMsIHRoaXMgaXMgdGhlICh1bnBhcnNlZCkgc3RyaW5nIHJlcHJlc2VudGF0aW9uLlxuICAgICAqL1xuICAgIHZhbHVlOiBhbnlcblxuICAgIC8qKiBUaGUgc3RhcnQgY2hhcmFjdGVyIHBvc2l0aW9uIG9mIHRoaXMgdG9rZW4uICovXG4gICAgc3RhcnQ6IG51bWJlclxuXG4gICAgLyoqIFRoZSBlbmQgY2hhcmFjdGVyIHBvc2l0aW9uIG9mIHRoaXMgdG9rZW4uICovXG4gICAgZW5kOiBudW1iZXJcbn1cblxuLyoqXG4gKiBBbGwgdmFsaWQgb3BlcmF0b3JzIGluIGV4cHJlc3Npb25zLiBUaGUgdmFsdWVzIGFyZSB0aGUgb3BlcmF0b3IgcHJlY2VkZW5jZSAob3IsIGZvciBvcGVyYXRvcnMgdGhhdCBhcmUgbm90IG9wZXJhdG9ycywgMCkuIFRoaXNcbiAqIG11c3QgYmUga2VwdCBpbiBzeW5jIHdpdGggT1BFUkFUT1JfQ0hBUlMuXG4gKlxuICogRXhwb3J0ZWQgZm9yIHRlc3Rpbmcgb25seS5cbiAqL1xuZXhwb3J0IGNvbnN0IE9QRVJBVE9SUyA9IHtcbiAgICAnKCc6IDAsXG4gICAgJyknOiAwLFxuICAgICd9JzogMCxcbiAgICAnLCc6IDAsXG4gICAgJz0nOiAwLFxuICAgICd8fCc6IDEsXG4gICAgJyYmJzogMixcbiAgICAnXic6IDQsXG4gICAgJz09JzogNixcbiAgICAnIT0nOiA2LFxuICAgICc9PT0nOiA2LFxuICAgICchPT0nOiA2LFxuICAgICc8JzogNyxcbiAgICAnPic6IDcsXG4gICAgJzw9JzogNyxcbiAgICAnPj0nOiA3LFxuICAgICcrJzogOSxcbiAgICAnLSc6IDksXG4gICAgJyonOiAxMCxcbiAgICAnLyc6IDEwLFxuICAgICclJzogMTAsXG4gICAgJyEnOiAxMSxcbn1cblxuLyoqIEFsbCB2YWxpZCBvcGVyYXRvcnMuICovXG5leHBvcnQgdHlwZSBPcGVyYXRvciA9IGtleW9mIHR5cGVvZiBPUEVSQVRPUlNcblxuZXhwb3J0IHR5cGUgT3BlcmF0b3JUcmVlID0gYm9vbGVhbiB8IHsgW2NoOiBzdHJpbmddOiBPcGVyYXRvclRyZWUgfVxuXG4vKipcbiAqIEEgdHJlZSB3aXRoIHRoZSBuZXh0IHZhbGlkIG9wZXJhdG9yIGNoYXJhY3RlcnMgZm9yIG11bHRpLWNoYXJhY3RlciBvcGVyYXRvcnMuIFRoaXMgbXVzdCBiZSBrZXB0IGluIHN5bmMgd2l0aFxuICogT1BFUkFUT1JTLlxuICpcbiAqIEV4cG9ydGVkIGZvciB0ZXN0aW5nIG9ubHkuXG4gKi9cbmV4cG9ydCBjb25zdCBPUEVSQVRPUl9DSEFSUzogeyBbY2g6IHN0cmluZ106IE9wZXJhdG9yVHJlZSB9ID0ge1xuICAgICcmJzogeyAnJic6IHRydWUgfSxcbiAgICAnfCc6IHsgJ3wnOiB0cnVlIH0sXG4gICAgJz0nOiB7XG4gICAgICAgICdcXHgwMCc6IHRydWUsXG4gICAgICAgICc9Jzoge1xuICAgICAgICAgICAgJ1xceDAwJzogdHJ1ZSxcbiAgICAgICAgICAgICc9JzogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICB9LFxuICAgICchJzoge1xuICAgICAgICAnXFx4MDAnOiB0cnVlLFxuICAgICAgICAnPSc6IHtcbiAgICAgICAgICAgICdcXHgwMCc6IHRydWUsXG4gICAgICAgICAgICAnPSc6IHRydWUsXG4gICAgICAgIH0sXG4gICAgfSxcbiAgICAnPCc6IHsgJ1xceDAwJzogdHJ1ZSwgJz0nOiB0cnVlIH0sXG4gICAgJz4nOiB7ICdcXHgwMCc6IHRydWUsICc9JzogdHJ1ZSB9LFxuICAgICdeJzogdHJ1ZSxcbiAgICAnfSc6IHRydWUsXG4gICAgJygnOiB0cnVlLFxuICAgICcpJzogdHJ1ZSxcbiAgICAnLCc6IHRydWUsXG4gICAgJysnOiB0cnVlLFxuICAgICctJzogdHJ1ZSxcbiAgICAnKic6IHRydWUsXG4gICAgJy8nOiB0cnVlLFxuICAgICclJzogdHJ1ZSxcbn1cblxuZnVuY3Rpb24gaXNXaGl0ZVNwYWNlKGNoOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gY2ggPT09ICdcXHUwMDA5JyB8fCBjaCA9PT0gJyAnIHx8IGNoID09PSAnXFx1MDBBMCdcbn1cblxuZnVuY3Rpb24gaXNMZXR0ZXIoY2g6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoY2ggPj0gJ2EnICYmIGNoIDw9ICd6JykgfHwgKGNoID49ICdBJyAmJiBjaCA8PSAnWicpXG59XG5cbmZ1bmN0aW9uIGlzRGVjaW1hbERpZ2l0KGNoOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gY2ggPj0gJzAnICYmIGNoIDw9ICc5J1xufVxuXG5mdW5jdGlvbiBpc0lkZW50aWZpZXJTdGFydChjaDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGNoID09PSAnXycgfHwgaXNMZXR0ZXIoY2gpXG59XG5cbmZ1bmN0aW9uIGlzSWRlbnRpZmllclBhcnQoY2g6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBpc0lkZW50aWZpZXJTdGFydChjaCkgfHwgaXNEZWNpbWFsRGlnaXQoY2gpIHx8IGNoID09PSAnLidcbn1cblxuLyoqIFRoZSB0b2tlbiB0aGF0IGluZGljYXRlcyB0aGUgYmVnaW5uaW5nIG9mIGEgdGVtcGxhdGUgc3RyaW5nLiAqL1xuZXhwb3J0IGNvbnN0IFRFTVBMQVRFX0JFR0lOID0gJyR7JyAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lOm5vLWludmFsaWQtdGVtcGxhdGUtc3RyaW5nc1xuXG4vKiogU2NhbnMgYW4gZXhwcmVzc2lvbi4gKi9cbmV4cG9ydCBjbGFzcyBMZXhlciB7XG4gICAgcHJpdmF0ZSBleHByZXNzaW9uID0gJydcbiAgICBwcml2YXRlIGxlbmd0aCA9IDBcbiAgICBwcm90ZWN0ZWQgX2luZGV4ID0gMFxuICAgIHByaXZhdGUgbWFya2VyID0gMFxuICAgIHByb3RlY3RlZCBjdXJseVN0YWNrID0gMFxuXG4gICAgLyoqIFRoZSBjdXJyZW50IGNoYXJhY3RlciBwb3NpdGlvbiBvZiB0aGUgbGV4ZXIncyBjdXJzb3IuICovXG4gICAgcHVibGljIGdldCBpbmRleCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5faW5kZXhcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVzZXQoc3RyOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5leHByZXNzaW9uID0gc3RyXG4gICAgICAgIHRoaXMubGVuZ3RoID0gc3RyLmxlbmd0aFxuICAgICAgICB0aGlzLl9pbmRleCA9IDBcbiAgICAgICAgdGhpcy5jdXJseVN0YWNrID0gMFxuICAgIH1cblxuICAgIHB1YmxpYyBuZXh0KCk6IFRva2VuIHwgdW5kZWZpbmVkIHtcbiAgICAgICAgdGhpcy5za2lwU3BhY2VzKClcbiAgICAgICAgaWYgKHRoaXMuX2luZGV4ID49IHRoaXMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm1hcmtlciA9IHRoaXMuX2luZGV4XG5cbiAgICAgICAgY29uc3QgdG9rZW4gPSB0aGlzLnNjYW5OZXh0KClcbiAgICAgICAgaWYgKHRva2VuICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0b2tlblxuICAgICAgICB9XG5cbiAgICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKGBVbmV4cGVjdGVkIGNoYXJhY3RlciAke0pTT04uc3RyaW5naWZ5KHRoaXMucGVla05leHRDaGFyKCkpfSAoYXQgJHt0aGlzLmluZGV4fSlgKVxuICAgIH1cblxuICAgIHB1YmxpYyBwZWVrKCk6IFBpY2s8VG9rZW4sIEV4Y2x1ZGU8a2V5b2YgVG9rZW4sICdzdGFydCcgfCAnZW5kJz4+IHwgdW5kZWZpbmVkIHtcbiAgICAgICAgY29uc3Qgc2F2ZWRJbmRleCA9IHRoaXMuX2luZGV4XG4gICAgICAgIGNvbnN0IHNhdmVkQ3VybHlTdGFjayA9IHRoaXMuY3VybHlTdGFja1xuICAgICAgICBsZXQgdG9rZW46IFRva2VuIHwgdW5kZWZpbmVkXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB0b2tlbiA9IHRoaXMubmV4dCgpXG4gICAgICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgdG9rZW4uc3RhcnRcbiAgICAgICAgICAgICAgICBkZWxldGUgdG9rZW4uZW5kXG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHRva2VuID0gdW5kZWZpbmVkXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5faW5kZXggPSBzYXZlZEluZGV4XG4gICAgICAgIHRoaXMuY3VybHlTdGFjayA9IHNhdmVkQ3VybHlTdGFja1xuXG4gICAgICAgIHJldHVybiB0b2tlblxuICAgIH1cblxuICAgIHByb3RlY3RlZCBzY2FuTmV4dCgpOiBUb2tlbiB8IHVuZGVmaW5lZCB7XG4gICAgICAgIGxldCB0b2tlbiA9IHRoaXMuc2NhblN0cmluZygpXG4gICAgICAgIGlmICh0b2tlbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdG9rZW5cbiAgICAgICAgfVxuXG4gICAgICAgIHRva2VuID0gdGhpcy5zY2FuVGVtcGxhdGUoKVxuICAgICAgICBpZiAodG9rZW4gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRva2VuXG4gICAgICAgIH1cblxuICAgICAgICB0b2tlbiA9IHRoaXMuc2Nhbk51bWJlcigpXG4gICAgICAgIGlmICh0b2tlbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdG9rZW5cbiAgICAgICAgfVxuXG4gICAgICAgIHRva2VuID0gdGhpcy5zY2FuT3BlcmF0b3IoKVxuICAgICAgICBpZiAodG9rZW4gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRva2VuXG4gICAgICAgIH1cblxuICAgICAgICB0b2tlbiA9IHRoaXMuc2NhbklkZW50aWZpZXIoKVxuICAgICAgICBpZiAodG9rZW4gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRva2VuXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBwZWVrTmV4dENoYXIoYWR2YW5jZSA9IDApOiBzdHJpbmcge1xuICAgICAgICBjb25zdCBpZHggPSB0aGlzLl9pbmRleCArIGFkdmFuY2VcbiAgICAgICAgcmV0dXJuIGlkeCA8IHRoaXMubGVuZ3RoID8gdGhpcy5leHByZXNzaW9uLmNoYXJBdChpZHgpIDogJ1xceDAwJ1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0TmV4dENoYXIoKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IGNoID0gJ1xceDAwJ1xuICAgICAgICBjb25zdCBpZHggPSB0aGlzLl9pbmRleFxuICAgICAgICBpZiAoaWR4IDwgdGhpcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNoID0gdGhpcy5leHByZXNzaW9uLmNoYXJBdChpZHgpXG4gICAgICAgICAgICB0aGlzLl9pbmRleCArPSAxXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNoXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjcmVhdGVUb2tlbih0eXBlOiBUb2tlblR5cGUsIHZhbHVlOiBhbnkpOiBUb2tlbiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICBzdGFydDogdGhpcy5tYXJrZXIsXG4gICAgICAgICAgICBlbmQ6IHRoaXMuX2luZGV4LFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBza2lwU3BhY2VzKCk6IHZvaWQge1xuICAgICAgICB3aGlsZSAodGhpcy5faW5kZXggPCB0aGlzLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgY2ggPSB0aGlzLnBlZWtOZXh0Q2hhcigpXG4gICAgICAgICAgICBpZiAoIWlzV2hpdGVTcGFjZShjaCkpIHtcbiAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5nZXROZXh0Q2hhcigpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHNjYW5PcGVyYXRvcigpOiBUb2tlbiB8IHVuZGVmaW5lZCB7XG4gICAgICAgIGxldCBzZWFyY2hUcmVlOiBPcGVyYXRvclRyZWUgfCBib29sZWFuID0gT1BFUkFUT1JfQ0hBUlNcbiAgICAgICAgbGV0IHZhbHVlID0gJydcbiAgICAgICAgd2hpbGUgKHNlYXJjaFRyZWUgJiYgc2VhcmNoVHJlZSAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgY29uc3QgY2ggPSB0aGlzLnBlZWtOZXh0Q2hhcigpXG4gICAgICAgICAgICBzZWFyY2hUcmVlID0gc2VhcmNoVHJlZVtjaF1cbiAgICAgICAgICAgIGlmIChzZWFyY2hUcmVlKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgKz0gY2hcbiAgICAgICAgICAgICAgICB0aGlzLmdldE5leHRDaGFyKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodmFsdWUgPT09ICd9Jykge1xuICAgICAgICAgICAgdGhpcy5jdXJseVN0YWNrLS1cbiAgICAgICAgfVxuICAgICAgICBpZiAodmFsdWUgPT09ICcnKSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlVG9rZW4oVG9rZW5UeXBlLk9wZXJhdG9yLCB2YWx1ZSlcbiAgICB9XG5cbiAgICBwcml2YXRlIHNjYW5JZGVudGlmaWVyKCk6IFRva2VuIHwgdW5kZWZpbmVkIHtcbiAgICAgICAgbGV0IGNoID0gdGhpcy5wZWVrTmV4dENoYXIoKVxuICAgICAgICBpZiAoIWlzSWRlbnRpZmllclN0YXJ0KGNoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGlkID0gdGhpcy5nZXROZXh0Q2hhcigpXG4gICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICBjaCA9IHRoaXMucGVla05leHRDaGFyKClcbiAgICAgICAgICAgIGlmICghaXNJZGVudGlmaWVyUGFydChjaCkpIHtcbiAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWQgKz0gdGhpcy5nZXROZXh0Q2hhcigpXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVUb2tlbihUb2tlblR5cGUuSWRlbnRpZmllciwgaWQpXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzY2FuU3RyaW5nKCk6IFRva2VuIHwgdW5kZWZpbmVkIHtcbiAgICAgICAgY29uc3QgcXVvdGUgPSB0aGlzLnBlZWtOZXh0Q2hhcigpXG4gICAgICAgIGlmIChxdW90ZSAhPT0gXCInXCIgJiYgcXVvdGUgIT09ICdcIicpIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmdldE5leHRDaGFyKClcblxuICAgICAgICBsZXQgdGVybWluYXRlZCA9IGZhbHNlXG4gICAgICAgIGxldCBzdHIgPSAnJ1xuICAgICAgICB3aGlsZSAodGhpcy5faW5kZXggPCB0aGlzLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgY2ggPSB0aGlzLmdldE5leHRDaGFyKClcbiAgICAgICAgICAgIGlmIChjaCA9PT0gcXVvdGUpIHtcbiAgICAgICAgICAgICAgICB0ZXJtaW5hdGVkID0gdHJ1ZVxuICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNoID09PSAnXFxcXCcpIHtcbiAgICAgICAgICAgICAgICBzdHIgKz0gYmFja3NsYXNoRXNjYXBlQ29kZVN0cmluZyh0aGlzLmdldE5leHRDaGFyKCkpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHN0ciArPSBjaFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghdGVybWluYXRlZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnRlcm1pbmF0ZWQgc3RyaW5nIGxpdGVyYWwgKGF0ICR7dGhpcy5pbmRleH0pYClcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVUb2tlbihUb2tlblR5cGUuU3RyaW5nLCBzdHIpXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzY2FuVGVtcGxhdGUoKTogVG9rZW4gfCB1bmRlZmluZWQge1xuICAgICAgICBjb25zdCBjaCA9IHRoaXMucGVla05leHRDaGFyKClcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWludmFsaWQtdGVtcGxhdGUtc3RyaW5nc1xuICAgICAgICBpZiAoIShjaCA9PT0gJ2AnIHx8IChjaCA9PT0gJ30nICYmIHRoaXMuY3VybHlTdGFjayA+IDApKSkge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgICAgICB9XG4gICAgICAgIHRoaXMuZ2V0TmV4dENoYXIoKVxuXG4gICAgICAgIGNvbnN0IGhlYWQgPSBjaCA9PT0gJ2AnXG4gICAgICAgIHJldHVybiB0aGlzLmRvU2NhblRlbXBsYXRlKGhlYWQpXG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGJhY2t0aWNrKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cblxuICAgIHByb3RlY3RlZCBkb1NjYW5UZW1wbGF0ZShoZWFkOiBib29sZWFuKTogVG9rZW4ge1xuICAgICAgICBsZXQgdGFpbCA9IGZhbHNlXG5cbiAgICAgICAgbGV0IHRlcm1pbmF0ZWQgPSBmYWxzZVxuICAgICAgICBsZXQgaGFzU3Vic3RpdHV0aW9uID0gZmFsc2VcbiAgICAgICAgbGV0IHN0ciA9ICcnXG4gICAgICAgIHdoaWxlICh0aGlzLl9pbmRleCA8IHRoaXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCBjaCA9IHRoaXMuZ2V0TmV4dENoYXIoKVxuICAgICAgICAgICAgaWYgKGNoID09PSAnYCcgJiYgdGhpcy5iYWNrdGljaygpKSB7XG4gICAgICAgICAgICAgICAgdGFpbCA9IHRydWVcbiAgICAgICAgICAgICAgICB0ZXJtaW5hdGVkID0gdHJ1ZVxuICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNoID09PSAnXFxcXCcpIHtcbiAgICAgICAgICAgICAgICBzdHIgKz0gYmFja3NsYXNoRXNjYXBlQ29kZVN0cmluZyh0aGlzLmdldE5leHRDaGFyKCkpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gJyQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoMiA9IHRoaXMucGVla05leHRDaGFyKClcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoMiA9PT0gJ3snKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8taW52YWxpZC10ZW1wbGF0ZS1zdHJpbmdzXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cmx5U3RhY2srK1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXROZXh0Q2hhcigpXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXJtaW5hdGVkID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgaGFzU3Vic3RpdHV0aW9uID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzdHIgKz0gY2hcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIWhlYWQpIHtcbiAgICAgICAgICAgIHRoaXMuY3VybHlTdGFjay0tXG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuYmFja3RpY2soKSkge1xuICAgICAgICAgICAgaWYgKCF0ZXJtaW5hdGVkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnRlcm1pbmF0ZWQgdGVtcGxhdGUgbGl0ZXJhbCAoYXQgJHt0aGlzLmluZGV4fSlgKVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2luZGV4ID09PSB0aGlzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGFpbCA9IHRydWVcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCB0eXBlOiBUb2tlblR5cGVcbiAgICAgICAgaWYgKGhlYWQgJiYgdGVybWluYXRlZCAmJiAhaGFzU3Vic3RpdHV0aW9uKSB7XG4gICAgICAgICAgICB0eXBlID0gVG9rZW5UeXBlLk5vU3Vic3RpdHV0aW9uVGVtcGxhdGVcbiAgICAgICAgfSBlbHNlIGlmIChoZWFkKSB7XG4gICAgICAgICAgICB0eXBlID0gVG9rZW5UeXBlLlRlbXBsYXRlSGVhZFxuICAgICAgICB9IGVsc2UgaWYgKHRhaWwpIHtcbiAgICAgICAgICAgIHR5cGUgPSBUb2tlblR5cGUuVGVtcGxhdGVUYWlsXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0eXBlID0gVG9rZW5UeXBlLlRlbXBsYXRlTWlkZGxlXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlVG9rZW4odHlwZSwgc3RyKVxuICAgIH1cblxuICAgIHByaXZhdGUgc2Nhbk51bWJlcigpOiBUb2tlbiB8IHVuZGVmaW5lZCB7XG4gICAgICAgIGxldCBjaCA9IHRoaXMucGVla05leHRDaGFyKClcbiAgICAgICAgaWYgKCFpc0RlY2ltYWxEaWdpdChjaCkgJiYgY2ggIT09ICcuJykge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IG51bSA9ICcnXG4gICAgICAgIGlmIChjaCAhPT0gJy4nKSB7XG4gICAgICAgICAgICBudW0gPSB0aGlzLmdldE5leHRDaGFyKClcbiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgY2ggPSB0aGlzLnBlZWtOZXh0Q2hhcigpXG4gICAgICAgICAgICAgICAgaWYgKCFpc0RlY2ltYWxEaWdpdChjaCkpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbnVtICs9IHRoaXMuZ2V0TmV4dENoYXIoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNoID09PSAnLicpIHtcbiAgICAgICAgICAgIG51bSArPSB0aGlzLmdldE5leHRDaGFyKClcbiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgY2ggPSB0aGlzLnBlZWtOZXh0Q2hhcigpXG4gICAgICAgICAgICAgICAgaWYgKCFpc0RlY2ltYWxEaWdpdChjaCkpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbnVtICs9IHRoaXMuZ2V0TmV4dENoYXIoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNoID09PSAnZScgfHwgY2ggPT09ICdFJykge1xuICAgICAgICAgICAgbnVtICs9IHRoaXMuZ2V0TmV4dENoYXIoKVxuICAgICAgICAgICAgY2ggPSB0aGlzLnBlZWtOZXh0Q2hhcigpXG4gICAgICAgICAgICBpZiAoY2ggPT09ICcrJyB8fCBjaCA9PT0gJy0nIHx8IGlzRGVjaW1hbERpZ2l0KGNoKSkge1xuICAgICAgICAgICAgICAgIG51bSArPSB0aGlzLmdldE5leHRDaGFyKClcbiAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBjaCA9IHRoaXMucGVla05leHRDaGFyKClcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0RlY2ltYWxEaWdpdChjaCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbnVtICs9IHRoaXMuZ2V0TmV4dENoYXIoKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY2ggPSBgY2hhcmFjdGVyICR7SlNPTi5zdHJpbmdpZnkoY2gpfWBcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5faW5kZXggPj0gdGhpcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2ggPSAnPGVuZD4nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcihgVW5leHBlY3RlZCAke2NofSBhZnRlciB0aGUgZXhwb25lbnQgc2lnbiAoYXQgJHt0aGlzLmluZGV4fSlgKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG51bSA9PT0gJy4nKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoYEV4cGVjdGVkIGRlY2ltYWwgZGlnaXRzIGFmdGVyIHRoZSBkb3Qgc2lnbiAoYXQgJHt0aGlzLmluZGV4fSlgKVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlVG9rZW4oVG9rZW5UeXBlLk51bWJlciwgbnVtKVxuICAgIH1cbn1cblxuLyoqIFNjYW5zIGEgdGVtcGxhdGUuICovXG5leHBvcnQgY2xhc3MgVGVtcGxhdGVMZXhlciBleHRlbmRzIExleGVyIHtcbiAgICBwdWJsaWMgbmV4dCgpOiBUb2tlbiB8IHVuZGVmaW5lZCB7XG4gICAgICAgIGlmICh0aGlzLl9pbmRleCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZG9TY2FuVGVtcGxhdGUodHJ1ZSlcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3VwZXIubmV4dCgpXG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGJhY2t0aWNrKCk6IGJvb2xlYW4ge1xuICAgICAgICAvLyBUaGUgcm9vdCBpcyBub3Qgc3Vycm91bmRlZCB3aXRoIGJhY2t0aWNrcy5cbiAgICAgICAgcmV0dXJuIHRoaXMuY3VybHlTdGFjayAhPT0gMFxuICAgIH1cbn1cblxuZnVuY3Rpb24gYmFja3NsYXNoRXNjYXBlQ29kZVN0cmluZyhjaDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBzd2l0Y2ggKGNoKSB7XG4gICAgICAgIGNhc2UgJ24nOlxuICAgICAgICAgICAgcmV0dXJuICdcXG4nXG4gICAgICAgIGNhc2UgJ3InOlxuICAgICAgICAgICAgcmV0dXJuICdcXHInXG4gICAgICAgIGNhc2UgJ3QnOlxuICAgICAgICAgICAgcmV0dXJuICdcXHQnXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gY2hcbiAgICB9XG59XG4iXX0=
import { from, Subscription } from 'rxjs';
import { map } from 'rxjs/operators';
import { createProxyAndHandleRequests } from '../../common/proxy';
import { SubscriptionMap } from './common';
/** @internal */
export class ClientLanguageFeatures {
    constructor(connection, hoverRegistry, definitionRegistry, typeDefinitionRegistry, implementationRegistry, referencesRegistry) {
        this.hoverRegistry = hoverRegistry;
        this.definitionRegistry = definitionRegistry;
        this.typeDefinitionRegistry = typeDefinitionRegistry;
        this.implementationRegistry = implementationRegistry;
        this.referencesRegistry = referencesRegistry;
        this.subscriptions = new Subscription();
        this.registrations = new SubscriptionMap();
        this.subscriptions.add(this.registrations);
        this.proxy = createProxyAndHandleRequests('languageFeatures', connection, this);
    }
    $unregister(id) {
        this.registrations.remove(id);
    }
    $registerHoverProvider(id, selector) {
        this.registrations.add(id, this.hoverRegistry.registerProvider({ documentSelector: selector }, (params) => from(this.proxy.$provideHover(id, params.textDocument.uri, params.position))));
    }
    $registerDefinitionProvider(id, selector) {
        this.registrations.add(id, this.definitionRegistry.registerProvider({ documentSelector: selector }, (params) => from(this.proxy.$provideDefinition(id, params.textDocument.uri, params.position)).pipe(map(result => result || []))));
    }
    $registerTypeDefinitionProvider(id, selector) {
        this.registrations.add(id, this.typeDefinitionRegistry.registerProvider({ documentSelector: selector }, (params) => from(this.proxy.$provideTypeDefinition(id, params.textDocument.uri, params.position)).pipe(map(result => result || []))));
    }
    $registerImplementationProvider(id, selector) {
        this.registrations.add(id, this.implementationRegistry.registerProvider({ documentSelector: selector }, (params) => from(this.proxy.$provideImplementation(id, params.textDocument.uri, params.position)).pipe(map(result => result || []))));
    }
    $registerReferenceProvider(id, selector) {
        this.registrations.add(id, this.referencesRegistry.registerProvider({ documentSelector: selector }, (params) => from(this.proxy.$provideReferences(id, params.textDocument.uri, params.position, params.context)).pipe(map(result => result || []))));
    }
    unsubscribe() {
        this.subscriptions.unsubscribe();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGFuZ3VhZ2VGZWF0dXJlcy5qcyIsInNvdXJjZVJvb3QiOiJzcmMvIiwic291cmNlcyI6WyJjbGllbnQvYXBpL2xhbmd1YWdlRmVhdHVyZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLElBQUksRUFBYyxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUE7QUFDckQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFBO0FBRXBDLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLG9CQUFvQixDQUFBO0FBUWpFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFZMUMsZ0JBQWdCO0FBQ2hCLE1BQU0sT0FBTyxzQkFBc0I7SUFLL0IsWUFDSSxVQUFzQixFQUNkLGFBR1AsRUFDTyxrQkFHUCxFQUNPLHNCQUdQLEVBQ08sc0JBR1AsRUFDTyxrQkFBMEQ7UUFoQjFELGtCQUFhLEdBQWIsYUFBYSxDQUdwQjtRQUNPLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FHekI7UUFDTywyQkFBc0IsR0FBdEIsc0JBQXNCLENBRzdCO1FBQ08sMkJBQXNCLEdBQXRCLHNCQUFzQixDQUc3QjtRQUNPLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBd0M7UUF0QjlELGtCQUFhLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQTtRQUNsQyxrQkFBYSxHQUFHLElBQUksZUFBZSxFQUFFLENBQUE7UUF1QnpDLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQTtRQUUxQyxJQUFJLENBQUMsS0FBSyxHQUFHLDRCQUE0QixDQUFDLGtCQUFrQixFQUFFLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQTtJQUNuRixDQUFDO0lBRU0sV0FBVyxDQUFDLEVBQVU7UUFDekIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUE7SUFDakMsQ0FBQztJQUVNLHNCQUFzQixDQUFDLEVBQVUsRUFB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Q0FDSixDQUFBO0lBQ0wsQ0FBQztJQUVNLFdBQVc7UUFDZCxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsRUFBRSxDQUFBO0lBQ3BDLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGZyb20sIE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnXG5pbXBvcnQgeyBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycydcbmltcG9ydCB7IERvY3VtZW50U2VsZWN0b3IgfSBmcm9tICdzb3VyY2VncmFwaCdcbmltcG9ydCB7IGNyZWF0ZVByb3h5QW5kSGFuZGxlUmVxdWVzdHMgfSBmcm9tICcuLi8uLi9jb21tb24vcHJveHknXG5pbXBvcnQgeyBFeHRMYW5ndWFnZUZlYXR1cmVzQVBJIH0gZnJvbSAnLi4vLi4vZXh0ZW5zaW9uL2FwaS9sYW5ndWFnZUZlYXR1cmVzJ1xuaW1wb3J0IHsgUmVmZXJlbmNlUGFyYW1zLCBUZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcywgVGV4dERvY3VtZW50UmVnaXN0cmF0aW9uT3B0aW9ucyB9IGZyb20gJy4uLy4uL3Byb3RvY29sJ1xuaW1wb3J0IHsgQ29ubmVjdGlvbiB9IGZyb20gJy4uLy4uL3Byb3RvY29sL2pzb25ycGMyL2Nvbm5lY3Rpb24nXG5pbXBvcnQgeyBEZWZpbml0aW9uLCBIb3ZlciwgTG9jYXRpb24gfSBmcm9tICcuLi8uLi9wcm90b2NvbC9wbGFpblR5cGVzJ1xuaW1wb3J0IHsgUHJvdmlkZVRleHREb2N1bWVudEhvdmVyU2lnbmF0dXJlIH0gZnJvbSAnLi4vcHJvdmlkZXJzL2hvdmVyJ1xuaW1wb3J0IHsgUHJvdmlkZVRleHREb2N1bWVudExvY2F0aW9uU2lnbmF0dXJlLCBUZXh0RG9jdW1lbnRSZWZlcmVuY2VzUHJvdmlkZXJSZWdpc3RyeSB9IGZyb20gJy4uL3Byb3ZpZGVycy9sb2NhdGlvbidcbmltcG9ydCB7IEZlYXR1cmVQcm92aWRlclJlZ2lzdHJ5IH0gZnJvbSAnLi4vcHJvdmlkZXJzL3JlZ2lzdHJ5J1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uTWFwIH0gZnJvbSAnLi9jb21tb24nXG5cbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ2xpZW50TGFuZ3VhZ2VGZWF0dXJlc0FQSSB7XG4gICAgJHVucmVnaXN0ZXIoaWQ6IG51bWJlcik6IHZvaWRcbiAgICAkcmVnaXN0ZXJIb3ZlclByb3ZpZGVyKGlkOiBudW1iZXIsIHNlbGVjdG9yOiBEb2N1bWVudFNlbGVjdG9yKTogdm9pZFxuICAgICRyZWdpc3RlckRlZmluaXRpb25Qcm92aWRlcihpZDogbnVtYmVyLCBzZWxlY3RvcjogRG9jdW1lbnRTZWxlY3Rvcik6IHZvaWRcbiAgICAkcmVnaXN0ZXJUeXBlRGVmaW5pdGlvblByb3ZpZGVyKGlkOiBudW1iZXIsIHNlbGVjdG9yOiBEb2N1bWVudFNlbGVjdG9yKTogdm9pZFxuICAgICRyZWdpc3RlckltcGxlbWVudGF0aW9uUHJvdmlkZXIoaWQ6IG51bWJlciwgc2VsZWN0b3I6IERvY3VtZW50U2VsZWN0b3IpOiB2b2lkXG4gICAgJHJlZ2lzdGVyUmVmZXJlbmNlUHJvdmlkZXIoaWQ6IG51bWJlciwgc2VsZWN0b3I6IERvY3VtZW50U2VsZWN0b3IpOiB2b2lkXG59XG5cbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydCBjbGFzcyBDbGllbnRMYW5ndWFnZUZlYXR1cmVzIGltcGxlbWVudHMgQ2xpZW50TGFuZ3VhZ2VGZWF0dXJlc0FQSSB7XG4gICAgcHJpdmF0ZSBzdWJzY3JpcHRpb25zID0gbmV3IFN1YnNjcmlwdGlvbigpXG4gICAgcHJpdmF0ZSByZWdpc3RyYXRpb25zID0gbmV3IFN1YnNjcmlwdGlvbk1hcCgpXG4gICAgcHJpdmF0ZSBwcm94eTogRXh0TGFuZ3VhZ2VGZWF0dXJlc0FQSVxuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIGNvbm5lY3Rpb246IENvbm5lY3Rpb24sXG4gICAgICAgIHByaXZhdGUgaG92ZXJSZWdpc3RyeTogRmVhdHVyZVByb3ZpZGVyUmVnaXN0cnk8XG4gICAgICAgICAgICBUZXh0RG9jdW1lbnRSZWdpc3RyYXRpb25PcHRpb25zLFxuICAgICAgICAgICAgUHJvdmlkZVRleHREb2N1bWVudEhvdmVyU2lnbmF0dXJlXG4gICAgICAgID4sXG4gICAgICAgIHByaXZhdGUgZGVmaW5pdGlvblJlZ2lzdHJ5OiBGZWF0dXJlUHJvdmlkZXJSZWdpc3RyeTxcbiAgICAgICAgICAgIFRleHREb2N1bWVudFJlZ2lzdHJhdGlvbk9wdGlvbnMsXG4gICAgICAgICAgICBQcm92aWRlVGV4dERvY3VtZW50TG9jYXRpb25TaWduYXR1cmVcbiAgICAgICAgPixcbiAgICAgICAgcHJpdmF0ZSB0eXBlRGVmaW5pdGlvblJlZ2lzdHJ5OiBGZWF0dXJlUHJvdmlkZXJSZWdpc3RyeTxcbiAgICAgICAgICAgIFRleHREb2N1bWVudFJlZ2lzdHJhdGlvbk9wdGlvbnMsXG4gICAgICAgICAgICBQcm92aWRlVGV4dERvY3VtZW50TG9jYXRpb25TaWduYXR1cmVcbiAgICAgICAgPixcbiAgICAgICAgcHJpdmF0ZSBpbXBsZW1lbnRhdGlvblJlZ2lzdHJ5OiBGZWF0dXJlUHJvdmlkZXJSZWdpc3RyeTxcbiAgICAgICAgICAgIFRleHREb2N1bWVudFJlZ2lzdHJhdGlvbk9wdGlvbnMsXG4gICAgICAgICAgICBQcm92aWRlVGV4dERvY3VtZW50TG9jYXRpb25TaWduYXR1cmVcbiAgICAgICAgPixcbiAgICAgICAgcHJpdmF0ZSByZWZlcmVuY2VzUmVnaXN0cnk6IFRleHREb2N1bWVudFJlZmVyZW5jZXNQcm92aWRlclJlZ2lzdHJ5XG4gICAgKSB7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5hZGQodGhpcy5yZWdpc3RyYXRpb25zKVxuXG4gICAgICAgIHRoaXMucHJveHkgPSBjcmVhdGVQcm94eUFuZEhhbmRsZVJlcXVlc3RzKCdsYW5ndWFnZUZlYXR1cmVzJywgY29ubmVjdGlvbiwgdGhpcylcbiAgICB9XG5cbiAgICBwdWJsaWMgJHVucmVnaXN0ZXIoaWQ6IG51bWJlcik6IHZvaWQge1xuICAgICAgICB0aGlzLnJlZ2lzdHJhdGlvbnMucmVtb3ZlKGlkKVxuICAgIH1cblxuICAgIHB1YmxpYyAkcmVnaXN0ZXJIb3ZlclByb3ZpZGVyKGlkOiBudW1iZXIsIHNlbGVjdG9yOiBEb2N1bWVudFNlbGVjdG9yKTogdm9pZCB7XG4gICAgICAgIHRoaXMucmVnaXN0cmF0aW9ucy5hZGQoXG4gICAgICAgICAgICBpZCxcbiAgICAgICAgICAgIHRoaXMuaG92ZXJSZWdpc3RyeS5yZWdpc3RlclByb3ZpZGVyKFxuICAgICAgICAgICAgICAgIHsgZG9jdW1lbnRTZWxlY3Rvcjogc2VsZWN0b3IgfSxcbiAgICAgICAgICAgICAgICAocGFyYW1zOiBUZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcyk6IE9ic2VydmFibGU8SG92ZXIgfCBudWxsIHwgdW5kZWZpbmVkPiA9PlxuICAgICAgICAgICAgICAgICAgICBmcm9tKHRoaXMucHJveHkuJHByb3ZpZGVIb3ZlcihpZCwgcGFyYW1zLnRleHREb2N1bWVudC51cmksIHBhcmFtcy5wb3NpdGlvbikpXG4gICAgICAgICAgICApXG4gICAgICAgIClcbiAgICB9XG5cbiAgICBwdWJsaWMgJHJlZ2lzdGVyRGVmaW5pdGlvblByb3ZpZGVyKGlkOiBudW1iZXIsIHNlbGVjdG9yOiBEb2N1bWVudFNlbGVjdG9yKTogdm9pZCB7XG4gICAgICAgIHRoaXMucmVnaXN0cmF0aW9ucy5hZGQoXG4gICAgICAgICAgICBpZCxcbiAgICAgICAgICAgIHRoaXMuZGVmaW5pdGlvblJlZ2lzdHJ5LnJlZ2lzdGVyUHJvdmlkZXIoXG4gICAgICAgICAgICAgICAgeyBkb2N1bWVudFNlbGVjdG9yOiBzZWxlY3RvciB9LFxuICAgICAgICAgICAgICAgIChwYXJhbXM6IFRleHREb2N1bWVudFBvc2l0aW9uUGFyYW1zKTogT2JzZXJ2YWJsZTxEZWZpbml0aW9uPiA9PlxuICAgICAgICAgICAgICAgICAgICBmcm9tKHRoaXMucHJveHkuJHByb3ZpZGVEZWZpbml0aW9uKGlkLCBwYXJhbXMudGV4dERvY3VtZW50LnVyaSwgcGFyYW1zLnBvc2l0aW9uKSkucGlwZShcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcChyZXN1bHQgPT4gcmVzdWx0IHx8IFtdKVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgIClcbiAgICB9XG5cbiAgICBwdWJsaWMgJHJlZ2lzdGVyVHlwZURlZmluaXRpb25Qcm92aWRlcihpZDogbnVtYmVyLCBzZWxlY3RvcjogRG9jdW1lbnRTZWxlY3Rvcik6IHZvaWQge1xuICAgICAgICB0aGlzLnJlZ2lzdHJhdGlvbnMuYWRkKFxuICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICB0aGlzLnR5cGVEZWZpbml0aW9uUmVnaXN0cnkucmVnaXN0ZXJQcm92aWRlcihcbiAgICAgICAgICAgICAgICB7IGRvY3VtZW50U2VsZWN0b3I6IHNlbGVjdG9yIH0sXG4gICAgICAgICAgICAgICAgKHBhcmFtczogVGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXMpOiBPYnNlcnZhYmxlPERlZmluaXRpb24+ID0+XG4gICAgICAgICAgICAgICAgICAgIGZyb20odGhpcy5wcm94eS4kcHJvdmlkZVR5cGVEZWZpbml0aW9uKGlkLCBwYXJhbXMudGV4dERvY3VtZW50LnVyaSwgcGFyYW1zLnBvc2l0aW9uKSkucGlwZShcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcChyZXN1bHQgPT4gcmVzdWx0IHx8IFtdKVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgIClcbiAgICB9XG5cbiAgICBwdWJsaWMgJHJlZ2lzdGVySW1wbGVtZW50YXRpb25Qcm92aWRlcihpZDogbnVtYmVyLCBzZWxlY3RvcjogRG9jdW1lbnRTZWxlY3Rvcik6IHZvaWQge1xuICAgICAgICB0aGlzLnJlZ2lzdHJhdGlvbnMuYWRkKFxuICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICB0aGlzLmltcGxlbWVudGF0aW9uUmVnaXN0cnkucmVnaXN0ZXJQcm92aWRlcihcbiAgICAgICAgICAgICAgICB7IGRvY3VtZW50U2VsZWN0b3I6IHNlbGVjdG9yIH0sXG4gICAgICAgICAgICAgICAgKHBhcmFtczogVGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXMpOiBPYnNlcnZhYmxlPERlZmluaXRpb24+ID0+XG4gICAgICAgICAgICAgICAgICAgIGZyb20odGhpcy5wcm94eS4kcHJvdmlkZUltcGxlbWVudGF0aW9uKGlkLCBwYXJhbXMudGV4dERvY3VtZW50LnVyaSwgcGFyYW1zLnBvc2l0aW9uKSkucGlwZShcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcChyZXN1bHQgPT4gcmVzdWx0IHx8IFtdKVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgIClcbiAgICB9XG5cbiAgICBwdWJsaWMgJHJlZ2lzdGVyUmVmZXJlbmNlUHJvdmlkZXIoaWQ6IG51bWJlciwgc2VsZWN0b3I6IERvY3VtZW50U2VsZWN0b3IpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5yZWdpc3RyYXRpb25zLmFkZChcbiAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgdGhpcy5yZWZlcmVuY2VzUmVnaXN0cnkucmVnaXN0ZXJQcm92aWRlcihcbiAgICAgICAgICAgICAgICB7IGRvY3VtZW50U2VsZWN0b3I6IHNlbGVjdG9yIH0sXG4gICAgICAgICAgICAgICAgKHBhcmFtczogUmVmZXJlbmNlUGFyYW1zKTogT2JzZXJ2YWJsZTxMb2NhdGlvbltdPiA9PlxuICAgICAgICAgICAgICAgICAgICBmcm9tKFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm94eS4kcHJvdmlkZVJlZmVyZW5jZXMoaWQsIHBhcmFtcy50ZXh0RG9jdW1lbnQudXJpLCBwYXJhbXMucG9zaXRpb24sIHBhcmFtcy5jb250ZXh0KVxuICAgICAgICAgICAgICAgICAgICApLnBpcGUobWFwKHJlc3VsdCA9PiByZXN1bHQgfHwgW10pKVxuICAgICAgICAgICAgKVxuICAgICAgICApXG4gICAgfVxuXG4gICAgcHVibGljIHVuc3Vic2NyaWJlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMudW5zdWJzY3JpYmUoKVxuICAgIH1cbn1cbiJdfQ==
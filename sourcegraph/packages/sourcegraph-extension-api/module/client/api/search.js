import { from, Subscription } from 'rxjs';
import { createProxyAndHandleRequests } from '../../common/proxy';
import { SubscriptionMap } from './common';
/** @internal */
export class Search {
    constructor(connection, queryTransformerRegistry) {
        this.queryTransformerRegistry = queryTransformerRegistry;
        this.subscriptions = new Subscription();
        this.registrations = new SubscriptionMap();
        this.subscriptions.add(this.registrations);
        this.proxy = createProxyAndHandleRequests('search', connection, this);
    }
    $registerQueryTransformer(id) {
        this.registrations.add(id, this.queryTransformerRegistry.registerProvider({}, (query) => from(this.proxy.$transformQuery(id, query))));
    }
    $unregister(id) {
        this.registrations.remove(id);
    }
    unsubscribe() {
        this.subscriptions.unsubscribe();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLmpzIiwic291cmNlUm9vdCI6InNyYy8iLCJzb3VyY2VzIjpbImNsaWVudC9hcGkvc2VhcmNoLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxJQUFJLEVBQWMsWUFBWSxFQUFFLE1BQU0sTUFBTSxDQUFBO0FBR3JELE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLG9CQUFvQixDQUFBO0FBR2pFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFRMUMsZ0JBQWdCO0FBQ2hCLE1BQU0sT0FBTyxNQUFNO0lBS2YsWUFDSSxVQUFzQixFQUNkLHdCQUE4RTtRQUE5RSw2QkFBd0IsR0FBeEIsd0JBQXdCLENBQXNEO1FBTmxGLGtCQUFhLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQTtRQUNsQyxrQkFBYSxHQUFHLElBQUksZUFBZSxFQUFFLENBQUE7UUFPekMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFBO1FBRTFDLElBQUksQ0FBQyxLQUFLLEdBQUcsNEJBQTRCLENBQUMsUUFBUSxFQUFFLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQTtJQUN6RSxDQUFDO0lBRU0seUJBQXlCLENBQUMsRUFBVTtRQUN2QyxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FDbEIsRUFBRSxFQUNGLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxnQkFBZ0IsQ0FDMUMsRUFBRSxFQUNGLENBQUMsS0FBYSxFQUFzQixFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUFDLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUNyRixDQUNKLENBQUE7SUFDTCxDQUFDO0lBRU0sV0FBVyxDQUFDLEVBQVU7UUFDekIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUE7SUFDakMsQ0FBQztJQUVNLFdBQVc7UUFDZCxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsRUFBRSxDQUFBO0lBQ3BDLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGZyb20sIE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnXG5pbXBvcnQgeyBFeHRTZWFyY2ggfSBmcm9tICdzcmMvZXh0ZW5zaW9uL2FwaS9zZWFyY2gnXG5pbXBvcnQgeyBDb25uZWN0aW9uIH0gZnJvbSAnc3JjL3Byb3RvY29sL2pzb25ycGMyL2Nvbm5lY3Rpb24nXG5pbXBvcnQgeyBjcmVhdGVQcm94eUFuZEhhbmRsZVJlcXVlc3RzIH0gZnJvbSAnLi4vLi4vY29tbW9uL3Byb3h5J1xuaW1wb3J0IHsgVHJhbnNmb3JtUXVlcnlTaWduYXR1cmUgfSBmcm9tICcuLi9wcm92aWRlcnMvcXVlcnlUcmFuc2Zvcm1lcidcbmltcG9ydCB7IEZlYXR1cmVQcm92aWRlclJlZ2lzdHJ5IH0gZnJvbSAnLi4vcHJvdmlkZXJzL3JlZ2lzdHJ5J1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uTWFwIH0gZnJvbSAnLi9jb21tb24nXG5cbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydCBpbnRlcmZhY2UgU2VhcmNoQVBJIHtcbiAgICAkcmVnaXN0ZXJRdWVyeVRyYW5zZm9ybWVyKGlkOiBudW1iZXIpOiB2b2lkXG4gICAgJHVucmVnaXN0ZXIoaWQ6IG51bWJlcik6IHZvaWRcbn1cblxuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0IGNsYXNzIFNlYXJjaCBpbXBsZW1lbnRzIFNlYXJjaEFQSSB7XG4gICAgcHJpdmF0ZSBzdWJzY3JpcHRpb25zID0gbmV3IFN1YnNjcmlwdGlvbigpXG4gICAgcHJpdmF0ZSByZWdpc3RyYXRpb25zID0gbmV3IFN1YnNjcmlwdGlvbk1hcCgpXG4gICAgcHJpdmF0ZSBwcm94eTogRXh0U2VhcmNoXG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgY29ubmVjdGlvbjogQ29ubmVjdGlvbixcbiAgICAgICAgcHJpdmF0ZSBxdWVyeVRyYW5zZm9ybWVyUmVnaXN0cnk6IEZlYXR1cmVQcm92aWRlclJlZ2lzdHJ5PHt9LCBUcmFuc2Zvcm1RdWVyeVNpZ25hdHVyZT5cbiAgICApIHtcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLmFkZCh0aGlzLnJlZ2lzdHJhdGlvbnMpXG5cbiAgICAgICAgdGhpcy5wcm94eSA9IGNyZWF0ZVByb3h5QW5kSGFuZGxlUmVxdWVzdHMoJ3NlYXJjaCcsIGNvbm5lY3Rpb24sIHRoaXMpXG4gICAgfVxuXG4gICAgcHVibGljICRyZWdpc3RlclF1ZXJ5VHJhbnNmb3JtZXIoaWQ6IG51bWJlcik6IHZvaWQge1xuICAgICAgICB0aGlzLnJlZ2lzdHJhdGlvbnMuYWRkKFxuICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICB0aGlzLnF1ZXJ5VHJhbnNmb3JtZXJSZWdpc3RyeS5yZWdpc3RlclByb3ZpZGVyKFxuICAgICAgICAgICAgICAgIHt9LFxuICAgICAgICAgICAgICAgIChxdWVyeTogc3RyaW5nKTogT2JzZXJ2YWJsZTxzdHJpbmc+ID0+IGZyb20odGhpcy5wcm94eS4kdHJhbnNmb3JtUXVlcnkoaWQsIHF1ZXJ5KSlcbiAgICAgICAgICAgIClcbiAgICAgICAgKVxuICAgIH1cblxuICAgIHB1YmxpYyAkdW5yZWdpc3RlcihpZDogbnVtYmVyKTogdm9pZCB7XG4gICAgICAgIHRoaXMucmVnaXN0cmF0aW9ucy5yZW1vdmUoaWQpXG4gICAgfVxuXG4gICAgcHVibGljIHVuc3Vic2NyaWJlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMudW5zdWJzY3JpYmUoKVxuICAgIH1cbn1cbiJdfQ==
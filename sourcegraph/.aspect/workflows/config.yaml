---
bazel:
  rcfiles:
    - ".aspect/bazelrc/ci.sourcegraph.bazelrc"
env:
  REDIS_CACHE_ENDPOINT: ":6379"
  GIT_PAGER: ""
tasks:
  # Checks that BUILD files are formatted
  - buildifier:
      queue: aspect-small
  # Checks that BUILD file content is up-to-date with sources
  - gazelle:
      queue: aspect-small
      target: //:configure
      fix_target: //:configure
  # Checks that all tests are passing
  - test:
      include_eternal_tests: true
      targets:
        - //...
        # exclude testing as it is executed in a seperate job
        - -//testing/...
  - test:
      include_eternal_tests: true
      targets:
        - //testing/...
        # This target should only really run when on main which we aren't handling. For the time being while we
        # evaluate Aspect Workflows it is ok
        # TODO(burmudar): Let this only run on main branch
        - //testing:codeintel_integration_test
  - finalization:
      queue: aspect-small

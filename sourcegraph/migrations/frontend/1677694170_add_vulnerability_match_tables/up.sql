CREATE TABLE IF NOT EXISTS vulnerability_matches (
	id                                 SERIAL PRIMARY KEY,
	upload_id                          INT NOT NULL,
	vulnerability_affected_package_id  INT NOT NULL,

	CONSTRAINT fk_upload FOREIGN KEY (upload_id) REFERENCES lsif_uploads(id) ON DELETE CASCADE,
	CONSTRAINT fk_vulnerability_affected_packages FOREIGN KEY (vulnerability_affected_package_id) REFERENCES vulnerability_affected_packages(id) ON DELETE CASCADE
);

CREATE UNIQUE INDEX IF NOT EXISTS vulnerability_matches_upload_id_vulnerability_affected_package_id ON vulnerability_matches(upload_id, vulnerability_affected_package_id);
CREATE INDEX IF NOT EXISTS vulnerability_matches_vulnerability_affected_package_id ON vulnerability_matches(vulnerability_affected_package_id);

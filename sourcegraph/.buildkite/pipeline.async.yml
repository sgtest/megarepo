env:
  ENTERPRISE: '1'
  MINIFY: '1'
  FORCE_COLOR: '3'
  NODE_OPTIONS: '--max_old_space_size=4096'

steps:
  - command:
      - COVERAGE_INSTRUMENT=true dev/ci/yarn-run.sh build-storybook
      - yarn --cwd client/shared run download-puppeteer-browser
      - yarn run cover-storybook
      - yarn nyc report -r json
      - bash <(curl -s https://codecov.io/bash) -c -F typescript -F storybook
    label: ':storybook::codecov: Storybook coverage'
  # Issue to fix: https://github.com/sourcegraph/sourcegraph/issues/25910
  # - command:
  #     - dev/ci/yarn-build.sh client/web
  #     - yarn lhci autorun
  #   label: ':lighthouse: Lighthouse'
  #   env:
  #     NODE_ENV: production
  #     WEBPACK_SERVE_INDEX: 'true'
  #     SOURCEGRAPH_API_URL: https://sourcegraph.com

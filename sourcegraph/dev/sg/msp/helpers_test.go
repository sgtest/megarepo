package msp

import (
	"testing"

	"github.com/hexops/autogold/v2"
)

func TestGenerateCloudDeployDocstring(t *testing.T) {
	comment := generateCloudDeployDocstring("PROJECT_ID", "SERVICE_ID", "REGION", "rollout-REGION.clouddeploy.yaml")
	autogold.Expect(`# DO NOT EDIT; generated by 'sg msp generate'
#
# This file defines additional Cloud Deploy configuration that is not yet available in Terraform.
# Apply this using the following command:
#
#   gcloud deploy apply --project=PROJECT_ID --region=REGION --file=rollout-REGION.clouddeploy.yaml
#
# Releases can be created using the following command, which can be added to CI pipelines:
#
#   gcloud deploy releases create $RELEASE_NAME --labels="commit=$COMMIT,author=$AUTHOR" --deploy-parameters="customTarget/tag=$TAG" --project=PROJECT_ID --region=REGION --delivery-pipeline=SERVICE_ID-REGION-rollout --source='gs://PROJECT_ID-cloudrun-skaffold/source.tar.gz'
#
# The secret 'cloud_deploy_releaser_service_account_id' provides the ID of a service account
# that can be used to provision workload auth, for example https://sourcegraph.sourcegraph.com/github.com/sourcegraph/infrastructure/-/blob/managed-services/continuous-deployment-pipeline/main.tf?L5-20
`).Equal(t, comment)
}

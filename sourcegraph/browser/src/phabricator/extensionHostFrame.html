<script type="text/javascript">
    // Create extension host worker
    const assetsUrl = window.parent.SOURCEGRAPH_ASSETS_URL || '/.assets/extension/'
    const hostWorker = new Worker(new URL('scripts/extensionHostWorker.bundle.js', assetsUrl).href)
    // Forward extension host worker init message,
    // making sur to transfer the endpoint MessagePort objects.
    window.addEventListener('message', ({ data }) => {
        const { type, payload } = data
        switch (type) {
            case 'workerInit':
                hostWorker.postMessage(payload, Object.values(payload.endpoints))
                break
            default:
                console.error('Unknown message type', type)
        }
    })
</script>

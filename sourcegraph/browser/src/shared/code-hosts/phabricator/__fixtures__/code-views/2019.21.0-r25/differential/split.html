<div class="phui-box phui-box-border phui-object-box mlt mll mlr phui-object-box-collapsed phui-box-blue-property "><div class="phui-header-shell "><h1 class="phui-header-view"><div class="phui-header-row"><div class="phui-header-col2"><span class="phui-header-header">Diff 1</span></div><div class="phui-header-col3"></div></div></h1></div><div class="differential-review-stage" id="differential-review-stage"><div class="differential-changeset repository-crossreference sg-mounted" id="diff-change-i2hTAYOJp2ME" data-sigil="differential-changeset" data-meta="0_44" data-autoid="autoid_1"><legend class="phabricator-anchor-navigation-marker" data-sigil="marker" data-meta="0_42"></legend><a name="change-i2hTAYOJp2ME" id="change-i2hTAYOJp2ME" class="phabricator-anchor-view"></a><div class="differential-changeset-buttons"><div class="sourcegraph-app-annotator" style="display: inline-block;"><ul class="code-view-toolbar"> <li class="code-view-toolbar__item"><a href="https://80bd068b.ngrok.io/github.com/sourcegraph/jsonrpc2/-/compare/35a74f039c6a54af5bf0402d8f7da046c3f63ba2...880ad59426247e2c6dc564dee6c680afe682a55b?utm_source=phabricator-integration#diff-3ef8fa70102f84ab1c1e85853eb28a70" aria-label="View file diff on Sourcegraph" class="open-on-sourcegraph button grey action-item--phabricator"><svg viewBox="0 0 40 40" class="action-item__icon--phabricator"><g fill="none" fill-rule="evenodd"><path d="M11.5941935,5.12629921 L20.4929032,36.888189 C21.0909677,39.0226772 23.3477419,40.279685 25.5325806,39.6951181 C27.7190323,39.1105512 29.0051613,36.9064567 28.4067742,34.7722835 L19.5064516,3.00944882 C18.9080645,0.875590551 16.6516129,-0.381732283 14.4667742,0.203149606 C12.2822581,0.786771654 10.9958065,2.99149606 11.5941935,5.12598425 L11.5941935,5.12629921 Z" fill="#F96316"></path><path d="M28.0722581,5.00598425 L5.7883871,29.5748031 C4.28516129,31.2314961 4.44225806,33.7647244 6.13741935,35.2327559 C7.83258065,36.7004724 10.4245161,36.5474016 11.9277419,34.8913386 L34.2116129,10.3228346 C35.7148387,8.66614173 35.5577419,6.13385827 33.8625806,4.66551181 C32.1667742,3.19653543 29.5741935,3.34992126 28.0722581,5.00566929 L28.0722581,5.00598425 Z" fill="#B200F8"></path><path d="M2.82258065,18.6204724 L34.6019355,28.8866142 C36.7525806,29.5811024 39.0729032,28.4412598 39.7841935,26.3395276 C40.4970968,24.2381102 39.3293548,21.9716535 37.1777419,21.2762205 L5.39935484,11.0110236 C3.24774194,10.3159055 0.928387097,11.455748 0.216774194,13.5574803 C-0.494193548,15.6588976 0.673548387,17.9259843 2.82322581,18.6204724 L2.82258065,18.6204724 Z" fill="#00B4F2"></path></g></svg> </a></li> </ul></div> <a class="button button-grey has-icon has-text phui-button-default " href="#" role="button" data-sigil="differential-view-options" data-meta="0_38"><span class="visual-only phui-icon-view phui-font-fa fa-bars" data-meta="0_39" aria-hidden="true"></span><div class="phui-button-text">View Options</div></a></div><h1 class="differential-file-icon-header"><span class="visual-only phui-icon-view phui-font-fa fa-file-text-o" data-meta="0_43" aria-hidden="true"></span>handler_with_error.go</h1><div class="changeset-view-content" data-sigil="changeset-view-content"><table class="differential-diff remarkup-code PhabricatorMonospaced diff-2up" data-sigil="differential-diff intercept-copy"><colgroup><col class="num"><col class="left"><col class="num"><col class="copy"><col class="right"><col class="cov"></colgroup><tbody><tr data-sigil="context-target"><td class="show-context-line n left-context"></td><td class="show-more"><a href="#" data-mustcapture="1" data-sigil="show-more" data-meta="2_0">Show All 25 Lines</a></td><td class="show-context-line n" data-n="22"></td><td colspan="3" class="show-context"><span data-copy-text="	">  </span>if req.Notif {
</td></tr><tr><td id="C1OL26" class=" n" data-n="26"></td><td class="" data-copy-mode="copy-l"><span data-copy-text="	">  </span><span data-copy-text="	">  </span>return
</td><td id="C1NL26" class=" n" data-n="26"></td><td class="copy"></td><td class="" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span data-copy-text="	">  </span>return
</td></tr><tr><td id="C1OL27" class=" n" data-n="27"></td><td class="" data-copy-mode="copy-l"><span data-copy-text="	">  </span>}
</td><td id="C1NL27" class=" n" data-n="27"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span>}</span><span>
</span></td></tr><tr><td id="C1OL28" class=" n" data-n="28"></td><td class="" data-copy-mode="copy-l">
</td><td id="C1NL28" class=" n" data-n="28"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span>
</span></td></tr><tr><td id="C1OL29" class=" n" data-n="29"></td><td class="" data-copy-mode="copy-l"><span data-copy-text="	">  </span>resp := &amp;Response{ID: req.ID}
</td><td id="C1NL29" class=" n" data-n="29"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span>resp</span><span> </span><span><span>:</span></span><span><span>=</span></span><span> </span><span><span>&amp;</span></span><span><span class="">Response</span></span><span><span>{</span></span><span><span>ID</span></span><span><span>:</span></span><span> </span><span><span>req</span></span><span><span>.</span></span><span><span>ID</span></span><span><span>}</span></span><span>
</span></td></tr><tr><td id="C1OL30" class=" n" data-n="30"></td><td class="" data-copy-mode="copy-l"><span data-copy-text="	">  </span>if err == nil {
</td><td id="C1NL30" class=" n" data-n="30"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span>if</span><span> </span><span><span>err</span></span><span> </span><span><span>=</span></span><span><span>=</span></span><span> </span><span><span>nil</span></span><span> </span><span><span>{</span></span><span>
</span></td></tr><tr><td id="C1OL31" class=" n" data-n="31"></td><td class="annotated" data-copy-mode="copy-l"><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span>err</span><span> </span><span><span>=</span></span><span> </span><span><span>resp</span></span><span><span>.</span></span><span><span>SetResult</span></span><span><span>(</span></span><span><span>result</span></span><span><span>)</span></span><span>
</span></td><td id="C1NL31" class=" n" data-n="31"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span>err</span><span> </span><span><span>=</span></span><span> </span><span><span>resp</span></span><span><span>.</span></span><span><span>SetResult</span></span><span><span>(</span></span><span><span>result</span></span><span><span>)</span></span><span>
</span></td></tr><tr><td id="C1OL32" class=" n" data-n="32"></td><td class="annotated" data-copy-mode="copy-l"><span data-copy-text="	">  </span><span>}</span><span>
</span></td><td id="C1NL32" class=" n" data-n="32"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span>}</span><span>
</span></td></tr><tr><td id="C1OL33" class=" n" data-n="33"></td><td class="annotated" data-copy-mode="copy-l"><span data-copy-text="	">  </span><span>if</span><span> </span><span><span>err</span></span><span> </span><span><span>!</span></span><span><span>=</span></span><span> </span><span><span>nil</span></span><span> </span><span><span>{</span></span><span>
</span></td><td id="C1NL33" class=" n" data-n="33"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span>if</span><span> </span><span><span>err</span></span><span> </span><span><span>!</span></span><span><span>=</span></span><span> </span><span><span>nil</span></span><span> </span><span><span>{</span></span><span>
</span></td></tr><tr><td id="C1OL34" class="old old-full n" data-n="34"></td><td class="old old-full annotated" data-copy-mode="copy-l"><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span>if</span><span> </span><span><span>e</span></span><span><span>,</span></span><span> </span><span><span>ok</span></span><span> </span><span><span>:</span></span><span><span>=</span></span><span> </span><span><span>err</span></span><span><span>.</span></span><span><span>(</span></span><span><span>*</span></span><span><span>Error</span></span><span><span>)</span></span><span><span>;</span></span><span> </span><span><span>ok</span></span><span> </span><span><span>{</span></span><span>
</span></td><td class=" n"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"></td></tr><tr><td id="C1OL35" class="old old-full n" data-n="35"></td><td class="old old-full annotated" data-copy-mode="copy-l"><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span>resp</span><span><span>.</span></span><span><span>Error</span></span><span> </span><span><span>=</span></span><span> </span><span><span>e</span></span><span>
</span></td><td class=" n"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"></td></tr><tr><td id="C1OL36" class="old old-full n annotated" data-n="36"></td><td class="old old-full annotated" data-copy-mode="copy-l"><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span>}</span><span> </span><span><span>else</span></span><span> </span><span><span>{</span></span><span>
</span></td><td class=" n"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"></td></tr><tr><td id="C1OL37" class="old old-full n" data-n="37"></td><td class="old old-full annotated" data-copy-mode="copy-l"><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span>resp</span><span><span>.</span></span><span><span>Error</span></span><span> </span><span><span>=</span></span><span> </span><span><span>&amp;</span></span><span><span class="">Error</span></span><span><span>{</span></span><span><span class="">Message</span></span><span><span>:</span></span><span> </span><span><span>err</span></span><span><span>.</span></span><span><span>Error</span></span><span><span>(</span></span><span><span>)</span></span><span><span>}</span></span><span>
</span></td><td class=" n"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"></td></tr><tr><td id="C1OL38" class=" n" data-n="38"></td><td class="annotated" data-copy-mode="copy-l"><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span>}</span><span>
</span></td><td id="C1NL34" class=" n" data-n="34"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span>}</span><span>
</span></td></tr><tr><td id="C1OL39" class=" n" data-n="39"></td><td class="annotated" data-copy-mode="copy-l"><span data-copy-text="	">  </span><span>}</span><span>
</span></td><td id="C1NL35" class=" n" data-n="35"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span>}</span><span>
</span></td></tr><tr><td id="C1OL40" class=" n" data-n="40"></td><td class="annotated" data-copy-mode="copy-l"><span>
</span></td><td id="C1NL36" class=" n" data-n="36"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span>
</span></td></tr><tr><td id="C1OL41" class=" n" data-n="41"></td><td class="" data-copy-mode="copy-l"><span data-copy-text="	">  </span>if !req.Notif {
</td><td id="C1NL37" class=" n" data-n="37"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span>if</span><span> </span><span><span>!</span></span><span><span>req</span></span><span><span>.</span></span><span><span class="">Notif</span></span><span> </span><span><span>{</span></span><span>
</span></td></tr><tr><td id="C1OL42" class=" n" data-n="42"></td><td class="" data-copy-mode="copy-l"><span data-copy-text="	">  </span><span data-copy-text="	">  </span>if err := conn.SendResponse(ctx, resp); err != nil {
</td><td id="C1NL38" class=" n" data-n="38"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span>if</span><span> </span><span><span>err</span></span><span> </span><span><span>:</span></span><span><span>=</span></span><span> </span><span><span>conn</span></span><span><span>.</span></span><span><span class="">SendResponse</span></span><span><span>(</span></span><span><span>ctx</span></span><span><span>,</span></span><span> </span><span><span>resp</span></span><span><span>)</span></span><span><span>;</span></span><span> </span><span><span>err</span></span><span> </span><span><span>!</span></span><span><span>=</span></span><span> </span><span><span>nil</span></span><span> </span><span><span>{</span></span><span>
</span></td></tr><tr><td id="C1OL43" class=" n" data-n="43"></td><td class="" data-copy-mode="copy-l"><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span data-copy-text="	">  </span>if err != ErrClosed || !h.suppressErrClosed {
</td><td id="C1NL39" class=" n" data-n="39"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span>if</span><span> </span><span><span>err</span></span><span> </span><span><span>!</span></span><span><span>=</span></span><span> </span><span><span>ErrClosed</span></span><span> </span><span><span>|</span></span><span><span>|</span></span><span> </span><span><span>!</span></span><span><span>h</span></span><span><span>.</span></span><span><span class="">suppressErrClosed</span></span><span> </span><span><span>{</span></span><span>
</span></td></tr><tr><td id="C1OL44" class=" n" data-n="44"></td><td class="" data-copy-mode="copy-l"><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span data-copy-text="	">  </span>log.Printf("jsonrpc2 handler: sending response %s: %s", resp.ID, err)
</td><td id="C1NL40" class=" n" data-n="40"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span>log</span><span><span>.</span></span><span><span class="">Printf</span></span><span><span>(</span></span><span><span>"</span></span><span><span>jsonrpc2</span></span><span> </span><span><span>handler</span></span><span><span>:</span></span><span> </span><span><span>sending</span></span><span> </span><span><span>response</span></span><span> </span><span><span>%</span></span><span><span>s</span></span><span><span>:</span></span><span> </span><span><span>%</span></span><span><span>s</span></span><span><span>"</span></span><span><span>,</span></span><span> </span><span><span>resp</span></span><span><span>.</span></span><span><span>ID</span></span><span><span>,</span></span><span> </span><span><span>err</span></span><span><span>)</span></span><span>
</span></td></tr><tr><td id="C1OL45" class=" n" data-n="45"></td><td class="" data-copy-mode="copy-l"><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span data-copy-text="	">  </span>}
</td><td id="C1NL41" class=" n" data-n="41"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span>}</span><span>
</span></td></tr><tr data-sigil="context-target"><td class="show-context-line n left-context"></td><td class="show-more"><a href="#" data-mustcapture="1" data-sigil="show-more" data-meta="2_1">Show All 11 Lines</a></td><td class="show-context-line n"></td><td colspan="3" class="show-context"></td></tr><tr><td id="C1OL57" class=" n" data-n="57"></td><td class="" data-copy-mode="copy-l">// interested in the request and closed the connection, etc) and as such it
</td><td id="C1NL53" class=" n" data-n="53"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span>/</span><span><span>/</span></span><span> </span><span><span>interested</span></span><span> </span><span><span>in</span></span><span> </span><span><span>the</span></span><span> </span><span><span>request</span></span><span> </span><span><span>and</span></span><span> </span><span><span>closed</span></span><span> </span><span><span>the</span></span><span> </span><span><span>connection</span></span><span><span>,</span></span><span> </span><span><span>etc</span></span><span><span>)</span></span><span> </span><span><span>and</span></span><span> </span><span><span>as</span></span><span> </span><span><span>such</span></span><span> </span><span><span>it</span></span><span>
</span></td></tr><tr><td id="C1OL58" class=" n" data-n="58"></td><td class="annotated" data-copy-mode="copy-l"><span>/</span><span><span>/</span></span><span> </span><span><span>would</span></span><span> </span><span><span>be</span></span><span> </span><span><span>log</span></span><span> </span><span><span>spam</span></span><span><span>,</span></span><span> </span><span><span>whereas</span></span><span> </span><span><span>a</span></span><span> </span><span><span>handler</span></span><span> </span><span><span>that</span></span><span> </span><span><span>serves</span></span><span> </span><span><span>internal</span></span><span> </span><span><span>connections</span></span><span> </span><span><span>would</span></span><span>
</span></td><td id="C1NL54" class=" n" data-n="54"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span>/</span><span><span>/</span></span><span> </span><span><span>would</span></span><span> </span><span><span>be</span></span><span> </span><span><span>log</span></span><span> </span><span><span>spam</span></span><span><span>,</span></span><span> </span><span><span>whereas</span></span><span> </span><span><span>a</span></span><span> </span><span><span>handler</span></span><span> </span><span><span>that</span></span><span> </span><span><span>serves</span></span><span> </span><span><span>internal</span></span><span> </span><span><span>connections</span></span><span> </span><span><span>would</span></span><span>
</span></td></tr><tr><td id="C1OL59" class=" n" data-n="59"></td><td class="annotated" data-copy-mode="copy-l"><span>/</span><span><span>/</span></span><span> </span><span><span>never</span></span><span> </span><span><span>expect</span></span><span> </span><span><span>connections</span></span><span> </span><span><span>to</span></span><span> </span><span><span>go</span></span><span> </span><span><span>away</span></span><span> </span><span><span>unexpectedly</span></span><span> </span><span><span>(</span></span><span><span>which</span></span><span> </span><span><span>could</span></span><span> </span><span><span>indicate</span></span><span>
</span></td><td id="C1NL55" class=" n" data-n="55"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span>/</span><span><span>/</span></span><span> </span><span><span>never</span></span><span> </span><span><span>expect</span></span><span> </span><span><span>connections</span></span><span> </span><span><span>to</span></span><span> </span><span><span>go</span></span><span> </span><span><span>away</span></span><span> </span><span><span>unexpectedly</span></span><span> </span><span><span>(</span></span><span><span>which</span></span><span> </span><span><span>could</span></span><span> </span><span><span>indicate</span></span><span>
</span></td></tr><tr><td id="C1OL60" class=" n" data-n="60"></td><td class="annotated" data-copy-mode="copy-l"><span>/</span><span><span>/</span></span><span> </span><span><span>service</span></span><span> </span><span><span>degradation</span></span><span><span>,</span></span><span> </span><span><span>etc</span></span><span><span>)</span></span><span> </span><span><span>and</span></span><span> </span><span><span>as</span></span><span> </span><span><span>such</span></span><span> </span><span><span>ErrClosed</span></span><span> </span><span><span>should</span></span><span> </span><span><span>always</span></span><span> </span><span><span>be</span></span><span> </span><span><span>logged</span></span><span><span>.</span></span><span>
</span></td><td id="C1NL56" class=" n" data-n="56"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span>/</span><span><span>/</span></span><span> </span><span><span>service</span></span><span> </span><span><span>degradation</span></span><span><span>,</span></span><span> </span><span><span>etc</span></span><span><span>)</span></span><span> </span><span><span>and</span></span><span> </span><span><span>as</span></span><span> </span><span><span>such</span></span><span> </span><span><span>ErrClosed</span></span><span> </span><span><span>should</span></span><span> </span><span><span>always</span></span><span> </span><span><span>be</span></span><span> </span><span><span>logged</span></span><span><span>.</span></span><span>
</span></td></tr><tr><td id="C1OL61" class=" n" data-n="61"></td><td class="annotated" data-copy-mode="copy-l"><span>func</span><span> </span><span><span>(</span></span><span><span>h</span></span><span> </span><span><span>*</span></span><span><span class="">HandlerWithErrorConfigurer</span></span><span><span>)</span></span><span> </span><span><span class="">SuppressErrClosed</span></span><span><span>(</span></span><span><span>)</span></span><span> </span><span><span class="">Handler</span></span><span> </span><span><span>{</span></span><span>
</span></td><td id="C1NL57" class=" n" data-n="57"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span>func</span><span> </span><span><span>(</span></span><span><span>h</span></span><span> </span><span><span>*</span></span><span><span class="">HandlerWithErrorConfigurer</span></span><span><span>)</span></span><span> </span><span><span class="">SuppressErrClosed</span></span><span><span>(</span></span><span><span>)</span></span><span> </span><span><span>Handler</span></span><span> </span><span><span>{</span></span><span>
</span></td></tr><tr><td id="C1OL62" class=" n" data-n="62"></td><td class="annotated" data-copy-mode="copy-l"><span data-copy-text="	">  </span><span>h</span><span><span>.</span></span><span><span class="">suppressErrClosed</span></span><span> </span><span><span>=</span></span><span> </span><span><span>true</span></span><span>
</span></td><td id="C1NL58" class="n annotated" data-n="58"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span>h</span><span><span>.</span></span><span><span class="">suppressErrClosed</span></span><span> </span><span><span>=</span></span><span> </span><span><span>true</span></span><span>
</span></td></tr><tr><td id="C1OL63" class=" n" data-n="63"></td><td class="annotated" data-copy-mode="copy-l"><span data-copy-text="	">  </span><span>return</span><span> </span><span><span>h</span></span><span>
</span></td><td id="C1NL59" class=" n" data-n="59"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span>return</span><span> </span><span><span>h</span></span><span>
</span></td></tr><tr><td id="C1OL64" class=" n" data-n="64"></td><td class="annotated" data-copy-mode="copy-l"><span>}</span><span>
</span></td><td id="C1NL60" class=" n" data-n="60"></td><td class="copy"></td><td class="annotated" colspan="2" data-copy-mode="copy-r"><span>}</span><span>
</span></td></tr><tr><td class=" n"></td><td class="annotated" data-copy-mode="copy-l"></td><td id="C1NL61" class="new new-full n" data-n="61"></td><td class="copy"></td><td class="new new-full annotated" colspan="2" data-copy-mode="copy-r"><span>
</span></td></tr><tr><td class=" n"></td><td class="annotated" data-copy-mode="copy-l"></td><td id="C1NL62" class="new new-full n" data-n="62"></td><td class="copy"></td><td class="new new-full annotated" colspan="2" data-copy-mode="copy-r"><span>
</span></td></tr><tr><td class=" n"></td><td class="annotated" data-copy-mode="copy-l"></td><td id="C1NL63" class="new new-full n annotated" data-n="63"></td><td class="copy"></td><td class="new new-full annotated" colspan="2" data-copy-mode="copy-r"><span>/</span><span><span>/</span></span><span> </span><span><span>random</span></span><span> </span><span><span>will</span></span><span> </span><span><span>create</span></span><span> </span><span><span>a</span></span><span> </span><span><span>file</span></span><span> </span><span><span>of</span></span><span> </span><span><span>size</span></span><span> </span><span><span>bytes</span></span><span> </span><span><span>(</span></span><span><span>rounded</span></span><span> </span><span><span>up</span></span><span> </span><span><span>to</span></span><span> </span><span><span>next</span></span><span> </span><span><span>1024</span></span><span> </span><span><span>size</span></span><span><span>)</span></span><span>
</span></td></tr><tr><td class=" n"></td><td class="annotated" data-copy-mode="copy-l"></td><td id="C1NL64" class="new new-full n annotated" data-n="64"></td><td class="copy"></td><td class="new new-full annotated" colspan="2" data-copy-mode="copy-r"><span>func</span><span> </span><span><span class="">randoasfasfafsm_1</span></span><span><span>(</span></span><span><span>size</span></span><span> </span><span><span>int</span></span><span><span>)</span></span><span> </span><span><span>error</span></span><span> </span><span><span>{</span></span><span>
</span></td></tr><tr><td class=" n"></td><td class="annotated" data-copy-mode="copy-l"></td><td id="C1NL65" class="new new-full n" data-n="65"></td><td class="copy"></td><td class="new new-full annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span>const</span><span> </span><span><span>bufSize</span></span><span> </span><span><span>=</span></span><span> </span><span><span>1024</span></span><span>
</span></td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL66" class="new new-full n" data-n="66"></td><td class="copy"></td><td class="new new-full annotated" colspan="2" data-copy-mode="copy-r"><span>
</span></td></tr><tr><td class=" n"></td><td class="annotated" data-copy-mode="copy-l"></td><td id="C1NL67" class="new new-full n" data-n="67"></td><td class="copy"></td><td class="new new-full annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span>f</span><span><span>,</span></span><span> </span><span><span>err</span></span><span> </span><span><span>:</span></span><span><span>=</span></span><span> </span><span><span>os</span></span><span><span>.</span></span><span><span>Create</span></span><span><span>(</span></span><span><span>"</span></span><span><span>/</span></span><span><span>tmp</span></span><span><span>/</span></span><span><span>test</span></span><span><span>"</span></span><span><span>)</span></span><span>
</span></td></tr><tr><td class=" n"></td><td class="annotated" data-copy-mode="copy-l"></td><td id="C1NL68" class="new new-full n" data-n="68"></td><td class="copy"></td><td class="new new-full annotated" colspan="2" data-copy-mode="copy-r"><span>
</span></td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL69" class="new new-full n" data-n="69"></td><td class="copy"></td><td class="new new-full annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span>fb</span><span> </span><span><span>:</span></span><span><span>=</span></span><span> </span><span><span>bufio</span></span><span><span>.</span></span><span><span>NewWriter</span></span><span><span>(</span></span><span><span>f</span></span><span><span>)</span></span><span>
</span></td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL70" class="new new-full n" data-n="70"></td><td class="copy"></td><td class="new new-full annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span>defer</span><span> </span><span><span>fb</span></span><span><span>.</span></span><span><span>Flush</span></span><span><span>(</span></span><span><span>)</span></span><span>
</span></td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL71" class="new new-full n" data-n="71"></td><td class="copy"></td><td class="new new-full annotated" colspan="2" data-copy-mode="copy-r"><span>
</span></td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL72" class="new new-full n" data-n="72"></td><td class="copy"></td><td class="new new-full annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span>buf</span><span> </span><span><span>:</span></span><span><span>=</span></span><span> </span><span><span>make</span></span><span><span>(</span></span><span><span>[</span></span><span><span>]</span></span><span><span>byte</span></span><span><span>,</span></span><span> </span><span><span>bufSize</span></span><span><span>)</span></span><span>
</span></td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL73" class="new new-full n" data-n="73"></td><td class="copy"></td><td class="new new-full annotated" colspan="2" data-copy-mode="copy-r"><span>
</span></td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL74" class="new new-full n" data-n="74"></td><td class="copy"></td><td class="new new-full annotated" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span>for</span><span> </span><span><span>i</span></span><span> </span><span><span>:</span></span><span><span>=</span></span><span> </span><span><span>size</span></span><span><span>;</span></span><span> </span><span><span>i</span></span><span> </span><span><span>&gt;</span></span><span> </span><span><span>0</span></span><span><span>;</span></span><span> </span><span><span>i</span></span><span> </span><span><span>-</span></span><span><span>=</span></span><span> </span><span><span>bufSize</span></span><span> </span><span><span>{</span></span><span>
</span></td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL75" class="new new-full n" data-n="75"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span data-copy-text="	">  </span>if _, err = rand.Read(buf); err != nil {
</td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL76" class="new new-full n" data-n="76"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span data-copy-text="	">  </span>fmt.Printf("error occurred during random: %!s(MISSING)\n", err)
</td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL77" class="new new-full n" data-n="77"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span data-copy-text="	">  </span>break
</td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL78" class="new new-full n" data-n="78"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span data-copy-text="	">  </span>}
</td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL79" class="new new-full n" data-n="79"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span data-copy-text="	">  </span>bR := bytes.NewReader(buf)
</td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL80" class="new new-full n" data-n="80"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span data-copy-text="	">  </span>if _, err = io.Copy(fb, bR); err != nil {
</td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL81" class="new new-full n" data-n="81"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span data-copy-text="	">  </span>fmt.Printf("failed during copy: %!s(MISSING)\n", err)
</td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL82" class="new new-full n" data-n="82"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span data-copy-text="	">  </span><span data-copy-text="	">  </span>break
</td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL83" class="new new-full n" data-n="83"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span><span data-copy-text="	">  </span>}
</td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL84" class="new new-full n" data-n="84"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span>}
</td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL85" class="new new-full n" data-n="85"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">
</td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL86" class="new new-full n" data-n="86"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r"><span data-copy-text="	">  </span>return err
</td></tr><tr><td class=" n"></td><td class="" data-copy-mode="copy-l"></td><td id="C1NL87" class="new new-full n" data-n="87"></td><td class="copy"></td><td class="new new-full" colspan="2" data-copy-mode="copy-r">}
</td></tr></tbody></table></div></div></div></div>
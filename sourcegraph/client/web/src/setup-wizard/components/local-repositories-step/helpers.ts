import { GetLocalCodeHostsResult } from '../../../graphql-operations'

export interface LocalCodeHost {
    id: string
    path: string
    autogenerated: boolean
}

/**
 * Parses gql response and returns path setting of the first non-generated
 * local external service.
 */
export function getLocalServicePath(data?: GetLocalCodeHostsResult): string {
    const localCodeHost = getLocalService(data)

    if (!localCodeHost) {
        return ''
    }

    return localCodeHost.path
}

/**
 * Returns a local service that has been created manually by user in the setup wizard,
 * it ignores autogenerated on the backend local external services
 */
export function getLocalService(data?: GetLocalCodeHostsResult, isAutogenerated?: boolean): LocalCodeHost | null {
    if (!data) {
        return null
    }

    return (
        data.localExternalServices.find(service =>
            isAutogenerated ? service.autogenerated : !service.autogenerated
        ) ?? null
    )
}

/**
 * Generates minimal code host configuration for the local repositories code host.
 */
export function createDefaultLocalServiceConfig(path: string): string {
    return `{ "url":"${window.context.srcServeGitUrl}", "root": "${path}", "repos": ["src-serve-local"] }`
}

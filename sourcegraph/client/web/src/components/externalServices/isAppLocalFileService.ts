import { parse as parseJSONC } from 'jsonc-parser'

import { ExternalServiceFields, ExternalServiceKind } from '../../graphql-operations'

// Returns true if the external service is an autogenerated local file sync from App.
export function isAppLocalFileService(node: Pick<ExternalServiceFields, 'kind' | 'config'>): boolean {
    if (node.kind !== ExternalServiceKind.OTHER) {
        return false
    }
    try {
        const config = parseJSONC(node.config) as unknown
        if (typeof config === 'object' && config && 'root' in config && config.root) {
            return true
        }
        return false
    } catch {
        return false
    }
}

import { AlertKind } from '@sourcegraph/shared/src/search/stream'

/**
 * For logging lucky search events. Calculates events based on
 * user clicking a result.
 * To be removed at latest by 12/2022.
 */
export const smartSearchClickedEvent = (alertKind: AlertKind, alertTitle: string, descriptions: string[]): string => {
    const rules = descriptions.map(entry => {
        if (entry.match(/patterns as regular expressions/)) {
            return 'Regexp'
        }
        if (entry.match(/unquote patterns/)) {
            return 'Unquote'
        }
        if (entry.match(/AND patterns together/)) {
            return 'And'
        }
        if (entry.match(/language filter for pattern/)) {
            return 'Lang'
        }
        if (entry.match(/search type for pattern/)) {
            return 'Type'
        }
        return 'Other'
    })

    const prefix =
        alertKind === 'smart-search-pure-results' ? 'SearchResultClickedAutoPure' : 'SearchResultClickedAdded'

    // If we got one autogenerated query and no results for the original query, log
    // that a user clicked a result for that rule specifically.
    const rule = rules.length === 1 ? rules[0] : 'Unknown'

    return `${prefix}${rule}`
}

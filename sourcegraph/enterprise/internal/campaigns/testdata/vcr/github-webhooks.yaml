---
version: 1
interactions:
- request:
    body: ""
    form: {}
    headers:
      Accept:
      - application/vnd.github.jean-grey-preview+json,application/vnd.github.mercy-preview+json
      - application/vnd.github.machine-man-preview+json
      Content-Type:
      - application/json; charset=utf-8
    url: https://api.github.com/repos/sourcegraph/sourcegraph
    method: GET
  response:
    body: '{"id":41288708,"node_id":"MDEwOlJlcG9zaXRvcnk0MTI4ODcwOA==","name":"sourcegraph","full_name":"sourcegraph/sourcegraph","private":false,"owner":{"login":"sourcegraph","id":3979584,"node_id":"MDEyOk9yZ2FuaXphdGlvbjM5Nzk1ODQ=","avatar_url":"https://avatars0.githubusercontent.com/u/3979584?v=4","gravatar_id":"","url":"https://api.github.com/users/sourcegraph","html_url":"https://github.com/sourcegraph","followers_url":"https://api.github.com/users/sourcegraph/followers","following_url":"https://api.github.com/users/sourcegraph/following{/other_user}","gists_url":"https://api.github.com/users/sourcegraph/gists{/gist_id}","starred_url":"https://api.github.com/users/sourcegraph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sourcegraph/subscriptions","organizations_url":"https://api.github.com/users/sourcegraph/orgs","repos_url":"https://api.github.com/users/sourcegraph/repos","events_url":"https://api.github.com/users/sourcegraph/events{/privacy}","received_events_url":"https://api.github.com/users/sourcegraph/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/sourcegraph/sourcegraph","description":"Universal code search (self-hosted)","fork":false,"url":"https://api.github.com/repos/sourcegraph/sourcegraph","forks_url":"https://api.github.com/repos/sourcegraph/sourcegraph/forks","keys_url":"https://api.github.com/repos/sourcegraph/sourcegraph/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sourcegraph/sourcegraph/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sourcegraph/sourcegraph/teams","hooks_url":"https://api.github.com/repos/sourcegraph/sourcegraph/hooks","issue_events_url":"https://api.github.com/repos/sourcegraph/sourcegraph/issues/events{/number}","events_url":"https://api.github.com/repos/sourcegraph/sourcegraph/events","assignees_url":"https://api.github.com/repos/sourcegraph/sourcegraph/assignees{/user}","branches_url":"https://api.github.com/repos/sourcegraph/sourcegraph/branches{/branch}","tags_url":"https://api.github.com/repos/sourcegraph/sourcegraph/tags","blobs_url":"https://api.github.com/repos/sourcegraph/sourcegraph/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sourcegraph/sourcegraph/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sourcegraph/sourcegraph/git/refs{/sha}","trees_url":"https://api.github.com/repos/sourcegraph/sourcegraph/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sourcegraph/sourcegraph/statuses/{sha}","languages_url":"https://api.github.com/repos/sourcegraph/sourcegraph/languages","stargazers_url":"https://api.github.com/repos/sourcegraph/sourcegraph/stargazers","contributors_url":"https://api.github.com/repos/sourcegraph/sourcegraph/contributors","subscribers_url":"https://api.github.com/repos/sourcegraph/sourcegraph/subscribers","subscription_url":"https://api.github.com/repos/sourcegraph/sourcegraph/subscription","commits_url":"https://api.github.com/repos/sourcegraph/sourcegraph/commits{/sha}","git_commits_url":"https://api.github.com/repos/sourcegraph/sourcegraph/git/commits{/sha}","comments_url":"https://api.github.com/repos/sourcegraph/sourcegraph/comments{/number}","issue_comment_url":"https://api.github.com/repos/sourcegraph/sourcegraph/issues/comments{/number}","contents_url":"https://api.github.com/repos/sourcegraph/sourcegraph/contents/{+path}","compare_url":"https://api.github.com/repos/sourcegraph/sourcegraph/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sourcegraph/sourcegraph/merges","archive_url":"https://api.github.com/repos/sourcegraph/sourcegraph/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sourcegraph/sourcegraph/downloads","issues_url":"https://api.github.com/repos/sourcegraph/sourcegraph/issues{/number}","pulls_url":"https://api.github.com/repos/sourcegraph/sourcegraph/pulls{/number}","milestones_url":"https://api.github.com/repos/sourcegraph/sourcegraph/milestones{/number}","notifications_url":"https://api.github.com/repos/sourcegraph/sourcegraph/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sourcegraph/sourcegraph/labels{/name}","releases_url":"https://api.github.com/repos/sourcegraph/sourcegraph/releases{/id}","deployments_url":"https://api.github.com/repos/sourcegraph/sourcegraph/deployments","created_at":"2015-08-24T07:27:28Z","updated_at":"2020-10-21T13:39:51Z","pushed_at":"2020-10-21T13:47:22Z","git_url":"git://github.com/sourcegraph/sourcegraph.git","ssh_url":"git@github.com:sourcegraph/sourcegraph.git","clone_url":"https://github.com/sourcegraph/sourcegraph.git","svn_url":"https://github.com/sourcegraph/sourcegraph","homepage":"https://sourcegraph.com","size":454321,"stargazers_count":4018,"watchers_count":4018,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"forks_count":443,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1701,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"topics":["code-intelligence","code-search","lsif-enabled","open-source","repo-type-main","sourcegraph"],"forks":443,"open_issues":1701,"watchers":4018,"default_branch":"main","permissions":{"admin":true,"push":true,"pull":true},"temp_clone_token":"","allow_squash_merge":true,"allow_merge_commit":false,"allow_rebase_merge":true,"delete_branch_on_merge":true,"organization":{"login":"sourcegraph","id":3979584,"node_id":"MDEyOk9yZ2FuaXphdGlvbjM5Nzk1ODQ=","avatar_url":"https://avatars0.githubusercontent.com/u/3979584?v=4","gravatar_id":"","url":"https://api.github.com/users/sourcegraph","html_url":"https://github.com/sourcegraph","followers_url":"https://api.github.com/users/sourcegraph/followers","following_url":"https://api.github.com/users/sourcegraph/following{/other_user}","gists_url":"https://api.github.com/users/sourcegraph/gists{/gist_id}","starred_url":"https://api.github.com/users/sourcegraph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sourcegraph/subscriptions","organizations_url":"https://api.github.com/users/sourcegraph/orgs","repos_url":"https://api.github.com/users/sourcegraph/repos","events_url":"https://api.github.com/users/sourcegraph/events{/privacy}","received_events_url":"https://api.github.com/users/sourcegraph/received_events","type":"Organization","site_admin":false},"network_count":443,"subscribers_count":99}'
    headers:
      Access-Control-Allow-Origin:
      - '*'
      Access-Control-Expose-Headers:
      - ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset
      Cache-Control:
      - private, max-age=60, s-maxage=60
      Content-Security-Policy:
      - default-src 'none'
      Content-Type:
      - application/json; charset=utf-8
      Date:
      - Wed, 21 Oct 2020 13:49:10 GMT
      Etag:
      - W/"a8271f48f4e8561b9910e2af00f8d5e23ead4a46a8b25b169240d967362501ad"
      Last-Modified:
      - Wed, 21 Oct 2020 13:39:51 GMT
      Referrer-Policy:
      - origin-when-cross-origin, strict-origin-when-cross-origin
      Server:
      - GitHub.com
      Status:
      - 200 OK
      Strict-Transport-Security:
      - max-age=31536000; includeSubdomains; preload
      Vary:
      - Accept, Authorization, Cookie, X-GitHub-OTP
      - Accept-Encoding, Accept, X-Requested-With
      - Accept-Encoding
      X-Accepted-Oauth-Scopes:
      - repo
      X-Content-Type-Options:
      - nosniff
      X-Frame-Options:
      - deny
      X-Github-Media-Type:
      - github.v3; param=jean-grey-preview; format=json, github.mercy-preview; param=machine-man-preview; format=json
      X-Github-Request-Id:
      - C719:DBDA:235CADCB:28C155E0:5F903C56
      X-Oauth-Scopes:
      - read:discussion, read:org, repo
      X-Ratelimit-Limit:
      - "5000"
      X-Ratelimit-Remaining:
      - "4969"
      X-Ratelimit-Reset:
      - "1603288280"
      X-Ratelimit-Used:
      - "31"
      X-Xss-Protection:
      - 1; mode=block
    status: 200 OK
    code: 200
    duration: ""
- request:
    body: '{"query":"\nfragment actor on Actor {\n  avatarUrl\n  login\n  url\n}\n\nfragment label on Label {\n  name\n  color\n  description\n  id\n}\n\nfragment commit on Commit {\n  oid\n  message\n  messageHeadline\n  committedDate\n  pushedDate\n  url\n  committer {\n    avatarUrl\n    email\n    name\n    user {\n      ...actor\n    }\n  }\n}\n\nfragment review on PullRequestReview {\n  databaseId\n  author {\n    ...actor\n  }\n  authorAssociation\n  body\n  state\n  url\n  createdAt\n  updatedAt\n  commit {\n    ...commit\n  }\n  includesCreatedEdit\n}\n\nfragment timelineItems on PullRequestTimelineItems {\n  ... on AssignedEvent {\n    actor {\n      ...actor\n    }\n    assignee {\n      ...actor\n    }\n    createdAt\n  }\n  ... on ClosedEvent {\n    actor {\n      ...actor\n    }\n    createdAt\n    url\n  }\n  ... on IssueComment {\n    databaseId\n    author {\n      ...actor\n    }\n    authorAssociation\n    body\n    createdAt\n    editor {\n      ...actor\n    }\n    url\n    updatedAt\n    includesCreatedEdit\n    publishedAt\n  }\n  ... on RenamedTitleEvent {\n    actor {\n      ...actor\n    }\n    previousTitle\n    currentTitle\n    createdAt\n  }\n  ... on MergedEvent {\n    actor {\n      ...actor\n    }\n    mergeRefName\n    url\n    commit {\n      ...commit\n    }\n    createdAt\n  }\n  ... on PullRequestReview {\n    ...review\n  }\n  ... on PullRequestReviewThread {\n    comments(last: 100) {\n      nodes {\n        databaseId\n        author {\n          ...actor\n        }\n        authorAssociation\n        editor {\n          ...actor\n        }\n        commit {\n          ...commit\n        }\n        body\n        state\n        url\n        createdAt\n        updatedAt\n        includesCreatedEdit\n      }\n    }\n  }\n  ... on ReopenedEvent {\n    actor {\n      ...actor\n    }\n    createdAt\n  }\n  ... on ReviewDismissedEvent {\n    actor {\n      ...actor\n    }\n    review {\n      ...review\n    }\n    dismissalMessage\n    createdAt\n  }\n  ... on ReviewRequestRemovedEvent {\n    actor {\n      ...actor\n    }\n    requestedReviewer {\n      ...actor\n    }\n    requestedTeam: requestedReviewer {\n      ... on Team {\n        name\n        url\n        avatarUrl\n      }\n    }\n    createdAt\n  }\n  ... on ReviewRequestedEvent {\n    actor {\n      ...actor\n    }\n    requestedReviewer {\n      ...actor\n    }\n    requestedTeam: requestedReviewer {\n      ... on Team {\n        name\n        url\n        avatarUrl\n      }\n    }\n    createdAt\n  }\n  ... on ReadyForReviewEvent {\n    actor {\n      ...actor\n    }\n    createdAt\n  }\n  ... on ConvertToDraftEvent {\n    actor {\n      ...actor\n    }\n    createdAt\n  }\n  ... on UnassignedEvent {\n    actor {\n      ...actor\n    }\n    assignee {\n      ...actor\n    }\n    createdAt\n  }\n  ... on LabeledEvent {\n    actor {\n      ...actor\n    }\n    label {\n      ...label\n    }\n    createdAt\n  }\n  ... on UnlabeledEvent {\n    actor {\n      ...actor\n    }\n    label {\n      ...label\n    }\n    createdAt\n  }\n  ... on PullRequestCommit {\n    commit {\n      ...commit\n    }\n  }\n}\n\nfragment commitWithChecks on Commit {\n  oid\n  status {\n    state\n    contexts {\n      id\n      context\n      state\n      description\n    }\n  }\n  checkSuites(last: 20) {\n    nodes {\n      id\n      status\n      conclusion\n      checkRuns(last: 20) {\n        nodes {\n          id\n          status\n          conclusion\n        }\n      }\n    }\n  }\n  committedDate\n}\n\nfragment prCommit on PullRequestCommit {\n  commit {\n    ...commitWithChecks\n  }\n}\n\nfragment pr on PullRequest {\n  id\n  title\n  body\n  state\n  url\n  number\n  createdAt\n  updatedAt\n  headRefOid\n  baseRefOid\n  headRefName\n  baseRefName\n  isDraft\n  author {\n    ...actor\n  }\n  participants(first: 100) {\n    nodes {\n      ...actor\n    }\n  }\n  labels(first: 100) {\n    nodes {\n      ...label\n    }\n  }\n  commits(last: 1) {\n    nodes {\n      ...prCommit\n    }\n  }\n  timelineItems(first: 250, itemTypes: [ASSIGNED_EVENT, CLOSED_EVENT, ISSUE_COMMENT, RENAMED_TITLE_EVENT, MERGED_EVENT, PULL_REQUEST_REVIEW, PULL_REQUEST_REVIEW_THREAD, REOPENED_EVENT, REVIEW_DISMISSED_EVENT, REVIEW_REQUEST_REMOVED_EVENT, REVIEW_REQUESTED_EVENT, UNASSIGNED_EVENT, LABELED_EVENT, UNLABELED_EVENT, PULL_REQUEST_COMMIT, READY_FOR_REVIEW_EVENT, CONVERT_TO_DRAFT_EVENT]) {\n    pageInfo {\n      hasNextPage\n      endCursor\n    }\n    nodes {\n      __typename\n      ...timelineItems\n    }\n  }\n}\n\nquery($owner: String!, $name: String!, $number: Int!) {\n\trepository(owner: $owner, name: $name) {\n\t\tpullRequest(number: $number) { ...pr }\n\t}\n}","variables":{"name":"sourcegraph","number":10156,"owner":"sourcegraph"}}'
    form: {}
    headers:
      Accept:
      - application/vnd.github.antiope-preview+json
      Content-Type:
      - application/json; charset=utf-8
    url: https://api.github.com/graphql
    method: POST
  response:
    body: '{"data":{"repository":{"pullRequest":{"id":"MDExOlB1bGxSZXF1ZXN0NDA4MDAyMjc0","title":"campaigns: Add more webhook tests","body":"This change makes it easier to add webhook related tests for GitHub.\r\n\r\nTo add a tests, create a fixture in `testdata/fixtures/webhooks/github`\r\n\r\nEach fixture defines the incoming events and the expected state of the `changeset_events` table at the end.\r\n\r\nBitBucket tests will be added in another PR.\r\n\r\nPart of: https://github.com/sourcegraph/sourcegraph/issues/9104","state":"MERGED","url":"https://github.com/sourcegraph/sourcegraph/pull/10156","number":10156,"createdAt":"2020-04-23T15:33:47Z","updatedAt":"2020-04-29T12:51:59Z","headRefOid":"6a9b7f39cbb06b2f13864c57db75af5a60fcd3ac","baseRefOid":"e26e9747eeeb5cb609c3925cf9eddf312a58ae04","headRefName":"webhook-tests","baseRefName":"master","isDraft":false,"author":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"},"participants":{"nodes":[{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"},{"avatarUrl":"https://avatars3.githubusercontent.com/u/2946214?u=0cdcf6f1d7de3a06e649fd5f1c40763dcc031e98&v=4","login":"unknwon","url":"https://github.com/unknwon"},{"avatarUrl":"https://avatars1.githubusercontent.com/u/1185253?u=35f048c505007991433b46c9c0616ccbcfbd4bff&v=4","login":"mrnugget","url":"https://github.com/mrnugget"},{"avatarUrl":"https://avatars0.githubusercontent.com/u/19534377?v=4","login":"eseliger","url":"https://github.com/eseliger"}]},"labels":{"nodes":[]},"commits":{"nodes":[{"commit":{"oid":"6a9b7f39cbb06b2f13864c57db75af5a60fcd3ac","status":{"state":"SUCCESS","contexts":[{"id":"MDEzOlN0YXR1c0NvbnRleHQ5NTExMjU0NDMy","context":"buildkite/sourcegraph","state":"SUCCESS","description":"Build #62221 passed (5 minutes, 21 seconds)"},{"id":"MDEzOlN0YXR1c0NvbnRleHQ5NTExMjU2Nzg4","context":"codecov/patch","state":"SUCCESS","description":"Coverage not affected when comparing c302735...6a9b7f3"}]},"checkSuites":{"nodes":[{"id":"MDEwOkNoZWNrU3VpdGU2Mzg3ODYyMTU=","status":"QUEUED","conclusion":null,"checkRuns":{"nodes":[]}},{"id":"MDEwOkNoZWNrU3VpdGU2Mzg3ODYyMTc=","status":"QUEUED","conclusion":null,"checkRuns":{"nodes":[]}},{"id":"MDEwOkNoZWNrU3VpdGU2Mzg3ODYyMTg=","status":"QUEUED","conclusion":null,"checkRuns":{"nodes":[]}},{"id":"MDEwOkNoZWNrU3VpdGU2Mzg3ODYyNjE=","status":"COMPLETED","conclusion":"SUCCESS","checkRuns":{"nodes":[{"id":"MDg6Q2hlY2tSdW42Mjk1OTg3NTM=","status":"COMPLETED","conclusion":"SUCCESS"},{"id":"MDg6Q2hlY2tSdW42Mjk1OTg4OTY=","status":"COMPLETED","conclusion":"SUCCESS"},{"id":"MDg6Q2hlY2tSdW42Mjk1OTg5NjE=","status":"COMPLETED","conclusion":"SUCCESS"},{"id":"MDg6Q2hlY2tSdW42Mjk1OTkwNjg=","status":"COMPLETED","conclusion":"SUCCESS"},{"id":"MDg6Q2hlY2tSdW42Mjk1OTkxNTM=","status":"COMPLETED","conclusion":"SUCCESS"}]}}]},"committedDate":"2020-04-29T12:30:24Z"}}]},"timelineItems":{"pageInfo":{"hasNextPage":false,"endCursor":"Y3Vyc29yOnYyOpPPAAABccX-bbABqjMyODQ0NTcwMTU="},"nodes":[{"__typename":"PullRequestCommit","commit":{"oid":"246bac6349ad74f109a65c1e9c04f27c690467a9","message":"campaigns: Rename webhook event types and add Action field","messageHeadline":"campaigns: Rename webhook event types and add Action field","committedDate":"2020-04-23T09:44:01Z","pushedDate":null,"url":"https://github.com/sourcegraph/sourcegraph/commit/246bac6349ad74f109a65c1e9c04f27c690467a9","committer":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?v=4","email":"ryanslade@gmail.com","name":"Ryan Slade","user":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"}}}},{"__typename":"PullRequestCommit","commit":{"oid":"8c2d31232d6d15e6b9c290c8cc19e5532ca15cdc","message":"campaigns: Refactor webhook tests\n\nAll test data is now located in the fixtures/testdata directory where\nyou specify a list of web hook events and the expected content of the\nchangeset events after all webhook events have been processed.\n\nThis should make it easier to test how webhook events alter the DB.","messageHeadline":"campaigns: Refactor webhook tests","committedDate":"2020-04-23T14:33:30Z","pushedDate":null,"url":"https://github.com/sourcegraph/sourcegraph/commit/8c2d31232d6d15e6b9c290c8cc19e5532ca15cdc","committer":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?v=4","email":"ryanslade@gmail.com","name":"Ryan Slade","user":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"}}}},{"__typename":"PullRequestCommit","commit":{"oid":"6130514788a11d947d73bba242f96a0426c94dbc","message":"campaigns: Undo rename","messageHeadline":"campaigns: Undo rename","committedDate":"2020-04-23T14:37:16Z","pushedDate":null,"url":"https://github.com/sourcegraph/sourcegraph/commit/6130514788a11d947d73bba242f96a0426c94dbc","committer":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?v=4","email":"ryanslade@gmail.com","name":"Ryan Slade","user":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"}}}},{"__typename":"PullRequestCommit","commit":{"oid":"2c7c9eb2f9198450cb02aa02014fdbbcef89e09d","message":"campaigns: Rename test variables","messageHeadline":"campaigns: Rename test variables","committedDate":"2020-04-23T15:24:35Z","pushedDate":"2020-04-23T15:33:19Z","url":"https://github.com/sourcegraph/sourcegraph/commit/2c7c9eb2f9198450cb02aa02014fdbbcef89e09d","committer":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?v=4","email":"ryanslade@gmail.com","name":"Ryan Slade","user":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"}}}},{"__typename":"IssueComment","databaseId":618471205,"author":{"avatarUrl":"https://avatars2.githubusercontent.com/in/254?v=4","login":"codecov","url":"https://github.com/apps/codecov"},"authorAssociation":"NONE","body":"# [Codecov](https://codecov.io/gh/sourcegraph/sourcegraph/pull/10156?src=pr&el=h1) Report\n> Merging [#10156](https://codecov.io/gh/sourcegraph/sourcegraph/pull/10156?src=pr&el=desc) into [master](https://codecov.io/gh/sourcegraph/sourcegraph/commit/c302735e39a5246b042131452736e9262396fab4&el=desc) will **increase** coverage by `0.01%`.\n> The diff coverage is `n/a`.\n\n```diff\n@@            Coverage Diff             @@\n##           master   #10156      +/-   ##\n==========================================\n+ Coverage   42.77%   42.79%   +0.01%     \n==========================================\n  Files        1348     1348              \n  Lines       74137    74137              \n  Branches     6651     6651              \n==========================================\n+ Hits        31711    31724      +13     \n+ Misses      39570    39553      -17     \n- Partials     2856     2860       +4     \n```\n\n| Flag | Coverage Δ | |\n|---|---|---|\n| #unit | `42.79% <ø> (+0.01%)` | :arrow_up: |\n\n| [Impacted Files](https://codecov.io/gh/sourcegraph/sourcegraph/pull/10156?src=pr&el=tree) | Coverage Δ | |\n|---|---|---|\n| [enterprise/internal/campaigns/webhooks.go](https://codecov.io/gh/sourcegraph/sourcegraph/pull/10156/diff?src=pr&el=tree#diff-ZW50ZXJwcmlzZS9pbnRlcm5hbC9jYW1wYWlnbnMvd2ViaG9va3MuZ28=) | `26.50% <0.00%> (+0.17%)` | :arrow_up: |\n| [enterprise/internal/campaigns/state.go](https://codecov.io/gh/sourcegraph/sourcegraph/pull/10156/diff?src=pr&el=tree#diff-ZW50ZXJwcmlzZS9pbnRlcm5hbC9jYW1wYWlnbnMvc3RhdGUuZ28=) | `69.95% <0.00%> (+5.63%)` | :arrow_up: |\n","createdAt":"2020-04-23T15:38:40Z","editor":{"avatarUrl":"https://avatars2.githubusercontent.com/in/254?v=4","login":"codecov","url":"https://github.com/apps/codecov"},"url":"https://github.com/sourcegraph/sourcegraph/pull/10156#issuecomment-618471205","updatedAt":"2020-04-29T12:37:30Z","includesCreatedEdit":true,"publishedAt":"2020-04-23T15:38:40Z"},{"__typename":"PullRequestCommit","commit":{"oid":"c54f9cd0e723cd403068a4e51bd0ce5a722438a5","message":"campaigns: Separate db tests and introduce more fixture data","messageHeadline":"campaigns: Separate db tests and introduce more fixture data","committedDate":"2020-04-24T11:16:09Z","pushedDate":null,"url":"https://github.com/sourcegraph/sourcegraph/commit/c54f9cd0e723cd403068a4e51bd0ce5a722438a5","committer":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?v=4","email":"ryanslade@gmail.com","name":"Ryan Slade","user":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"}}}},{"__typename":"PullRequestCommit","commit":{"oid":"724a1f8ea41203b2b67cd800dfce15345f8c8829","message":"WIP","messageHeadline":"WIP","committedDate":"2020-04-24T12:27:36Z","pushedDate":null,"url":"https://github.com/sourcegraph/sourcegraph/commit/724a1f8ea41203b2b67cd800dfce15345f8c8829","committer":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?v=4","email":"ryanslade@gmail.com","name":"Ryan Slade","user":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"}}}},{"__typename":"PullRequestCommit","commit":{"oid":"09222259c305ac888a6fd28bc4726d2079462287","message":"campaigns: Tweak tests to run together","messageHeadline":"campaigns: Tweak tests to run together","committedDate":"2020-04-24T13:15:26Z","pushedDate":"2020-04-24T13:21:10Z","url":"https://github.com/sourcegraph/sourcegraph/commit/09222259c305ac888a6fd28bc4726d2079462287","committer":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?v=4","email":"ryanslade@gmail.com","name":"Ryan Slade","user":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"}}}},{"__typename":"PullRequestCommit","commit":{"oid":"176f76af7658b6fd20dcfda2cd3a1ad8c76995cc","message":"campaigns: Duplicate events in tests","messageHeadline":"campaigns: Duplicate events in tests","committedDate":"2020-04-24T13:26:04Z","pushedDate":null,"url":"https://github.com/sourcegraph/sourcegraph/commit/176f76af7658b6fd20dcfda2cd3a1ad8c76995cc","committer":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?v=4","email":"ryanslade@gmail.com","name":"Ryan Slade","user":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"}}}},{"__typename":"PullRequestCommit","commit":{"oid":"881f6fca877ed4344d6bf06d6e56e1e195c230d6","message":"campaigns: Remove hack","messageHeadline":"campaigns: Remove hack","committedDate":"2020-04-24T13:35:08Z","pushedDate":null,"url":"https://github.com/sourcegraph/sourcegraph/commit/881f6fca877ed4344d6bf06d6e56e1e195c230d6","committer":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?v=4","email":"ryanslade@gmail.com","name":"Ryan Slade","user":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"}}}},{"__typename":"PullRequestCommit","commit":{"oid":"71c499bb8ce834164119bd635802971ce88626ef","message":"campaigns: Add test for review added webhook","messageHeadline":"campaigns: Add test for review added webhook","committedDate":"2020-04-24T14:24:43Z","pushedDate":"2020-04-24T14:45:20Z","url":"https://github.com/sourcegraph/sourcegraph/commit/71c499bb8ce834164119bd635802971ce88626ef","committer":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?v=4","email":"ryanslade@gmail.com","name":"Ryan Slade","user":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"}}}},{"__typename":"ReadyForReviewEvent","actor":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"},"createdAt":"2020-04-24T14:48:47Z"},{"__typename":"ReviewRequestedEvent","actor":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"},"requestedReviewer":null,"requestedTeam":null,"createdAt":"2020-04-24T14:48:47Z"},{"__typename":"ReviewRequestedEvent","actor":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"},"requestedReviewer":{},"requestedTeam":{"name":"Cloud","url":"https://github.com/orgs/sourcegraph/teams/cloud","avatarUrl":"https://avatars0.githubusercontent.com/t/3116080?s=400&v=4"},"createdAt":"2020-04-24T14:48:47Z"},{"__typename":"PullRequestReview","databaseId":400027533,"author":{"avatarUrl":"https://avatars0.githubusercontent.com/u/19534377?v=4","login":"eseliger","url":"https://github.com/eseliger"},"authorAssociation":"MEMBER","body":"","state":"APPROVED","url":"https://github.com/sourcegraph/sourcegraph/pull/10156#pullrequestreview-400027533","createdAt":"2020-04-24T15:02:25Z","updatedAt":"2020-04-24T15:05:44Z","commit":{"oid":"71c499bb8ce834164119bd635802971ce88626ef","message":"campaigns: Add test for review added webhook","messageHeadline":"campaigns: Add test for review added webhook","committedDate":"2020-04-24T14:24:43Z","pushedDate":"2020-04-24T14:45:20Z","url":"https://github.com/sourcegraph/sourcegraph/commit/71c499bb8ce834164119bd635802971ce88626ef","committer":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?v=4","email":"ryanslade@gmail.com","name":"Ryan Slade","user":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"}}},"includesCreatedEdit":false},{"__typename":"PullRequestReview","databaseId":400049996,"author":{"avatarUrl":"https://avatars1.githubusercontent.com/u/1185253?u=35f048c505007991433b46c9c0616ccbcfbd4bff&v=4","login":"mrnugget","url":"https://github.com/mrnugget"},"authorAssociation":"MEMBER","body":"Sweet! I like the move to the fixtures. What I''m unsure about is how easy it is to use this in practice:\r\n\r\n1. Since you need to have a correct JSON dump of the desired changeset_events in the fixture it''s practically impossible to write a test case first, right? As someone who likes to write tests first, especially when trying to debug something, my desired workflow would be: (1) write down requests that I expect (2) write down what I expected to have in the DB (3) run tests to see what fails. (2) wouldn''t be easy to do, since you''d have to get the metadata and timestamps etc. right.\r\n2. When you add a new test it fails the first time, even if you run `-update`. \r\n\r\nI think (2) might be easy to fix by moving the updating further up (see comment) and (1) might be possible to fix by reducing which data we compare. I think the ergonomics would improve a lot of I could write down my \"wanted changeset events\" only by specifying their type, changeset_id and date.\r\n\r\nWhat do you think?","state":"COMMENTED","url":"https://github.com/sourcegraph/sourcegraph/pull/10156#pullrequestreview-400049996","createdAt":"2020-04-24T15:28:52Z","updatedAt":"2020-04-24T15:36:58Z","commit":{"oid":"71c499bb8ce834164119bd635802971ce88626ef","message":"campaigns: Add test for review added webhook","messageHeadline":"campaigns: Add test for review added webhook","committedDate":"2020-04-24T14:24:43Z","pushedDate":"2020-04-24T14:45:20Z","url":"https://github.com/sourcegraph/sourcegraph/commit/71c499bb8ce834164119bd635802971ce88626ef","committer":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?v=4","email":"ryanslade@gmail.com","name":"Ryan Slade","user":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"}}},"includesCreatedEdit":false},{"__typename":"IssueComment","databaseId":619093850,"author":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"},"authorAssociation":"MEMBER","body":"> Sweet! I like the move to the fixtures. What I''m unsure about is how easy it is to use this in practice:\r\n> \r\n> 1. Since you need to have a correct JSON dump of the desired changeset_events in the fixture it''s practically impossible to write a test case first, right? As someone who likes to write tests first, especially when trying to debug something, my desired workflow would be: (1) write down requests that I expect (2) write down what I expected to have in the DB (3) run tests to see what fails. (2) wouldn''t be easy to do, since you''d have to get the metadata and timestamps etc. right.\r\n> 2. When you add a new test it fails the first time, even if you run `-update`.\r\n> \r\n> I think (2) might be easy to fix by moving the updating further up (see comment) and (1) might be possible to fix by reducing which data we compare. I think the ergonomics would improve a lot of I could write down my \"wanted changeset events\" only by specifying their type, changeset_id and date.\r\n> \r\n> What do you think?\r\n\r\nMy workflow was a bit different:\r\n\r\n1. Paste the incoming webhook events\r\n2. Leave expected DB state blank\r\n3. Run, expecting it to fail and look at the diff\r\n4. Once happy that the diff is correct, run with -update (I agree that it would be ideal not to have to do that twice)\r\n\r\nThis means you don''t need to mess around with constructing the expected DB state and it''s pretty easy to inspect the state by looking at the diff.\r\n\r\n","createdAt":"2020-04-24T15:50:41Z","editor":null,"url":"https://github.com/sourcegraph/sourcegraph/pull/10156#issuecomment-619093850","updatedAt":"2020-04-24T15:50:41Z","includesCreatedEdit":false,"publishedAt":"2020-04-24T15:50:41Z"},{"__typename":"PullRequestReview","databaseId":400343163,"author":{"avatarUrl":"https://avatars3.githubusercontent.com/u/2946214?u=0cdcf6f1d7de3a06e649fd5f1c40763dcc031e98&v=4","login":"unknwon","url":"https://github.com/unknwon"},"authorAssociation":"MEMBER","body":"Approve for the idea.","state":"APPROVED","url":"https://github.com/sourcegraph/sourcegraph/pull/10156#pullrequestreview-400343163","createdAt":"2020-04-25T01:33:43Z","updatedAt":"2020-04-25T01:33:43Z","commit":{"oid":"71c499bb8ce834164119bd635802971ce88626ef","message":"campaigns: Add test for review added webhook","messageHeadline":"campaigns: Add test for review added webhook","committedDate":"2020-04-24T14:24:43Z","pushedDate":"2020-04-24T14:45:20Z","url":"https://github.com/sourcegraph/sourcegraph/commit/71c499bb8ce834164119bd635802971ce88626ef","committer":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?v=4","email":"ryanslade@gmail.com","name":"Ryan Slade","user":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"}}},"includesCreatedEdit":false},{"__typename":"IssueComment","databaseId":619299503,"author":{"avatarUrl":"https://avatars3.githubusercontent.com/u/2946214?u=0cdcf6f1d7de3a06e649fd5f1c40763dcc031e98&v=4","login":"unknwon","url":"https://github.com/unknwon"},"authorAssociation":"MEMBER","body":"> My workflow was a bit different:\r\n> \r\n> 1. Paste the incoming webhook events\r\n> 2. Leave expected DB state blank\r\n> 3. Run, expecting it to fail and look at the diff\r\n> 4. Once happy that the diff is correct, run with -update (I agree that it would be ideal not to have to do that twice)\r\n\r\nI think I have the similar workflow, except agree with @mrnugget that the `-update` check should come before compare, So I can update the first time regardless, then look at diff in my git index.","createdAt":"2020-04-25T01:36:02Z","editor":null,"url":"https://github.com/sourcegraph/sourcegraph/pull/10156#issuecomment-619299503","updatedAt":"2020-04-25T01:36:02Z","includesCreatedEdit":false,"publishedAt":"2020-04-25T01:36:02Z"},{"__typename":"PullRequestCommit","commit":{"oid":"21cf9a894f228c6967c817a908c6458e05679b9c","message":"campaigns: Rename webhook test data fields\n\nEvents -> Payloads","messageHeadline":"campaigns: Rename webhook test data fields","committedDate":"2020-04-28T10:56:38Z","pushedDate":null,"url":"https://github.com/sourcegraph/sourcegraph/commit/21cf9a894f228c6967c817a908c6458e05679b9c","committer":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?v=4","email":"ryanslade@gmail.com","name":"Ryan Slade","user":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"}}}},{"__typename":"PullRequestCommit","commit":{"oid":"6a9b7f39cbb06b2f13864c57db75af5a60fcd3ac","message":"campaigns: Update webhook tests before checking test result\n\nSo that when marked to update we only need to run once","messageHeadline":"campaigns: Update webhook tests before checking test result","committedDate":"2020-04-29T12:30:24Z","pushedDate":"2020-04-29T12:31:44Z","url":"https://github.com/sourcegraph/sourcegraph/commit/6a9b7f39cbb06b2f13864c57db75af5a60fcd3ac","committer":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?v=4","email":"ryanslade@gmail.com","name":"Ryan Slade","user":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"}}}},{"__typename":"MergedEvent","actor":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"},"mergeRefName":"master","url":"https://github.com/sourcegraph/sourcegraph/pull/10156#event-3284457002","commit":{"oid":"16c77e07c1957089e16033aeb956c65528313df9","message":"campaigns: Add more webhook tests (#10156)\n\n* campaigns: Rename webhook event types and add Action field\r\n\r\n* campaigns: Refactor webhook tests\r\n\r\nAll test data is now located in the fixtures/testdata directory where\r\nyou specify a list of web hook events and the expected content of the\r\nchangeset events after all webhook events have been processed.\r\n\r\nThis should make it easier to test how webhook events alter the DB.\r\n\r\n* campaigns: Undo rename\r\n\r\n* campaigns: Rename test variables\r\n\r\n* campaigns: Separate db tests and introduce more fixture data\r\n\r\n* WIP\r\n\r\n* campaigns: Tweak tests to run together\r\n\r\n* campaigns: Duplicate events in tests\r\n\r\n* campaigns: Remove hack\r\n\r\n* campaigns: Add test for review added webhook\r\n\r\n* campaigns: Rename webhook test data fields\r\n\r\nEvents -> Payloads\r\n\r\n* campaigns: Update webhook tests before checking test result\r\n\r\nSo that when marked to update we only need to run once","messageHeadline":"campaigns: Add more webhook tests (#10156)","committedDate":"2020-04-29T12:51:57Z","pushedDate":"2020-04-29T12:52:00Z","url":"https://github.com/sourcegraph/sourcegraph/commit/16c77e07c1957089e16033aeb956c65528313df9","committer":{"avatarUrl":"https://avatars3.githubusercontent.com/u/19864447?v=4","email":"noreply@github.com","name":"GitHub","user":null}},"createdAt":"2020-04-29T12:51:57Z"},{"__typename":"ClosedEvent","actor":{"avatarUrl":"https://avatars3.githubusercontent.com/u/25610?u=416aa7bd7c7a97c714ea0a503c90a0e7e21c5e56&v=4","login":"ryanslade","url":"https://github.com/ryanslade"},"createdAt":"2020-04-29T12:51:58Z","url":"https://github.com/sourcegraph/sourcegraph/pull/10156#event-3284457015"}]}}}}}'
    headers:
      Access-Control-Allow-Origin:
      - '*'
      Access-Control-Expose-Headers:
      - ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, Deprecation, Sunset
      Cache-Control:
      - no-cache
      Content-Security-Policy:
      - default-src 'none'
      Content-Type:
      - application/json; charset=utf-8
      Date:
      - Wed, 21 Oct 2020 13:49:11 GMT
      Referrer-Policy:
      - origin-when-cross-origin, strict-origin-when-cross-origin
      Server:
      - GitHub.com
      Status:
      - 200 OK
      Strict-Transport-Security:
      - max-age=31536000; includeSubdomains; preload
      Vary:
      - Accept-Encoding, Accept, X-Requested-With
      - Accept-Encoding
      X-Accepted-Oauth-Scopes:
      - repo
      X-Content-Type-Options:
      - nosniff
      X-Frame-Options:
      - deny
      X-Github-Media-Type:
      - github.v4; param=antiope-preview; format=json
      X-Github-Request-Id:
      - C71A:179B:1083BBB4:13269D6F:5F903C56
      X-Oauth-Scopes:
      - read:discussion, read:org, repo
      X-Ratelimit-Limit:
      - "5000"
      X-Ratelimit-Remaining:
      - "4950"
      X-Ratelimit-Reset:
      - "1603288510"
      X-Ratelimit-Used:
      - "50"
      X-Xss-Protection:
      - 1; mode=block
    status: 200 OK
    code: 200
    duration: ""

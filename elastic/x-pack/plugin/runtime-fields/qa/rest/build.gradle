apply plugin: 'elasticsearch.yaml-rest-test'

restResources {
  restTests {
    includeCore '*'
  }
}

testClusters.yamlRestTest {
  testDistribution = 'DEFAULT'
}

yamlRestTest {
  systemProperty 'tests.rest.suite',
    [
      'search',
      'search.aggregation',
      'search.highlight',
      'search.inner_hits',
      'search_shards',
      'suggest',
      'msearch',
      'field_caps',
    ].join(',')
  systemProperty 'tests.rest.blacklist',
    [
      /////// TO FIX ///////
      'search/330_fetch_fields/*', // The whole API is not yet supported
      'search.aggregation/20_terms/Global ordinals are not loaded with the map execution hint', // Broken. Gotta fix.
      'search.highlight/40_keyword_ignore/Plain Highligher should skip highlighting ignored keyword values', // Broken. Gotta fix.
      'search/115_multiple_field_collapsing/two levels fields collapsing', // Broken. Gotta fix.
      'search/140_pre_filter_search_shards/pre_filter_shard_size with shards that have no hit', // Broken. Gotta fix.
      'field_caps/30_filter/Field caps with index filter', // We don't support filtering field caps on runtime fields. What should we do?
      'search.aggregation/10_histogram/*', // runtime_script doesn't support sub-fields. Maybe it should?
      /////// TO FIX ///////

      /////// NOT SUPPORTED ///////
      'search.aggregation/280_rare_terms/*', // Requires an index and we won't have it
      'search.aggregation/20_terms/string profiler via global ordinals', // Runtime fields don't have global ords
      /////// NOT SUPPORTED ///////
    ].join(',')
}

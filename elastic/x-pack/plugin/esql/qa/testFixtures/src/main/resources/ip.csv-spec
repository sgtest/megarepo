simpleProject
from hosts | keep card, host, ip0, ip1;
ignoreOrder:true

card:keyword   |host:keyword   |ip0:ip                                                                           |ip1:ip
eth0           |alpha          |127.0.0.1                                                                        |127.0.0.1
eth1           |alpha          |::1                                                                              |::1
eth0           |beta           |127.0.0.1                                                                        |::1
eth1           |beta           |127.0.0.1                                                                        |127.0.0.2
eth1           |beta           |127.0.0.1                                                                        |128.0.0.1
lo0            |gamma          |fe80::cae2:65ff:fece:feb9                                                        |fe81::cae2:65ff:fece:feb9
eth0           |gamma          |fe80::cae2:65ff:fece:feb9                                                        |127.0.0.3
eth0           |epsilon        |[fe80::cae2:65ff:fece:feb9, fe80::cae2:65ff:fece:fec0, fe80::cae2:65ff:fece:fec1]|fe80::cae2:65ff:fece:fec1
eth1           |epsilon        |null                                                                             |[127.0.0.1, 127.0.0.2, 127.0.0.3]
eth2           |epsilon        |[fe81::cae2:65ff:fece:feb9, fe82::cae2:65ff:fece:fec0]                           |[fe81::cae2:65ff:fece:feb9, fe82::cae2:65ff:fece:fec0]
;

equals
from hosts | sort host, card | where ip0 == ip1 | keep card, host, ip0, ip1;

card:keyword   |host:keyword   |ip0:ip                   |ip1:ip
eth0           |alpha          |127.0.0.1                |127.0.0.1
eth1           |alpha          |::1                      |::1
;

# ignored due to unstable sort
equalityNoSort-Ignore
from hosts | where ip0 == ip1 | keep card, host, ip0, ip1

card:keyword   |host:keyword   |ip0:ip                                                |ip1:ip
eth0           |alpha          |127.0.0.1                                             |127.0.0.1
eth1           |alpha          |::1                                                   |::1
eth2           |epsilon        |[fe81::cae2:65ff:fece:feb9, fe82::cae2:65ff:fece:fec0]|[fe81::cae2:65ff:fece:feb9, fe82::cae2:65ff:fece:fec0]
;

greaterThanEquals
from hosts | sort host, card | where ip0 >= ip1 | keep card, host, ip0, ip1;

card:keyword   |host:keyword   |ip0:ip                   |ip1:ip
eth0           |alpha          |127.0.0.1                |127.0.0.1
eth1           |alpha          |::1                      |::1
eth0           |beta           |127.0.0.1                |::1
eth0           |gamma          |fe80::cae2:65ff:fece:feb9|127.0.0.3
;

# ignored due to unstable sort
greaterThanEqualsNoSort-Ignore
from hosts | where ip0 >= ip1 | keep card, host, ip0, ip1;

card:keyword   |host:keyword   |ip0:ip                                                |ip1:ip
eth0           |alpha          |127.0.0.1                                             |127.0.0.1
eth1           |alpha          |::1                                                   |::1
eth0           |beta           |127.0.0.1                                             |::1
eth0           |gamma          |fe80::cae2:65ff:fece:feb9                             |127.0.0.3
eth2           |epsilon        |[fe81::cae2:65ff:fece:feb9, fe82::cae2:65ff:fece:fec0]|[fe81::cae2:65ff:fece:feb9, fe82::cae2:65ff:fece:fec0]
;

lessThen
from hosts | sort host, card | where ip0 < ip1 | keep card, host, ip0, ip1;

card:keyword   |host:keyword   |ip0:ip                   |ip1:ip
eth1           |beta           |127.0.0.1                |127.0.0.2
eth1           |beta           |127.0.0.1                |128.0.0.1
lo0            |gamma          |fe80::cae2:65ff:fece:feb9|fe81::cae2:65ff:fece:feb9
;

notEquals
from hosts | sort host, card, ip1 | where ip0 != ip1 | keep card, host, ip0, ip1;

card:keyword   |host:keyword   |ip0:ip                   |ip1:ip
eth0           |beta           |127.0.0.1                |::1
eth1           |beta           |127.0.0.1                |127.0.0.2
eth1           |beta           |127.0.0.1                |128.0.0.1
eth0           |gamma          |fe80::cae2:65ff:fece:feb9|127.0.0.3
lo0            |gamma          |fe80::cae2:65ff:fece:feb9|fe81::cae2:65ff:fece:feb9
;

aggAndSort
from hosts | stats c=count(ip0) by ip0 | sort ip0 | rename ip0 as ip;

c:long         |ip:ip
1              |::1
4              |127.0.0.1
5              |fe80::cae2:65ff:fece:feb9
3              |fe80::cae2:65ff:fece:fec0
3              |fe80::cae2:65ff:fece:fec1
2              |fe81::cae2:65ff:fece:feb9
2              |fe82::cae2:65ff:fece:fec0
0              |null
;

doubleSort
from hosts | sort ip0 asc nulls first, ip1 desc| keep card, host, ip0, ip1;

  card:keyword | host:keyword  |                                      ip0:ip                                     |                       ip1:ip                          
eth1           |epsilon        |null                                                                             |[127.0.0.1, 127.0.0.2, 127.0.0.3]                     
eth1           |alpha          |::1                                                                              |::1                                                   
eth1           |beta           |127.0.0.1                                                                        |128.0.0.1                                             
eth1           |beta           |127.0.0.1                                                                        |127.0.0.2                                             
eth0           |alpha          |127.0.0.1                                                                        |127.0.0.1                                             
eth0           |beta           |127.0.0.1                                                                        |::1                                                   
lo0            |gamma          |fe80::cae2:65ff:fece:feb9                                                        |fe81::cae2:65ff:fece:feb9                             
eth0           |epsilon        |[fe80::cae2:65ff:fece:feb9, fe80::cae2:65ff:fece:fec0, fe80::cae2:65ff:fece:fec1]|fe80::cae2:65ff:fece:fec1                             
eth0           |gamma          |fe80::cae2:65ff:fece:feb9                                                        |127.0.0.3                                             
eth2           |epsilon        |[fe81::cae2:65ff:fece:feb9, fe82::cae2:65ff:fece:fec0]                           |[fe81::cae2:65ff:fece:feb9, fe82::cae2:65ff:fece:fec0]
;

isNull
from hosts | where ip0 is null | keep ip0, ip1;

ip0:ip         |ip1:ip
null           |[127.0.0.1, 127.0.0.2, 127.0.0.3]
;

conditional
from hosts | eval eq=case(ip0==ip1, ip0, ip1) | keep eq, ip0, ip1;
ignoreOrder:true

eq:ip                                                 |ip0:ip                                                                           |ip1:ip
127.0.0.1                                             |127.0.0.1                                                                        |127.0.0.1
::1                                                   |::1                                                                              |::1
::1                                                   |127.0.0.1                                                                        |::1
127.0.0.2                                             |127.0.0.1                                                                        |127.0.0.2
128.0.0.1                                             |127.0.0.1                                                                        |128.0.0.1
fe81::cae2:65ff:fece:feb9                             |fe80::cae2:65ff:fece:feb9                                                        |fe81::cae2:65ff:fece:feb9
127.0.0.3                                             |fe80::cae2:65ff:fece:feb9                                                        |127.0.0.3
fe80::cae2:65ff:fece:fec1                             |[fe80::cae2:65ff:fece:feb9, fe80::cae2:65ff:fece:fec0, fe80::cae2:65ff:fece:fec1]|fe80::cae2:65ff:fece:fec1
[127.0.0.1, 127.0.0.2, 127.0.0.3]                     |null                                                                             |[127.0.0.1, 127.0.0.2, 127.0.0.3]
[fe81::cae2:65ff:fece:feb9, fe82::cae2:65ff:fece:fec0]|[fe81::cae2:65ff:fece:feb9, fe82::cae2:65ff:fece:fec0]                           |[fe81::cae2:65ff:fece:feb9, fe82::cae2:65ff:fece:fec0]
;

in
from hosts | eval eq=case(ip0==ip1, ip0, ip1) | where eq in (ip0, ip1) | keep card, host, ip0, ip1, eq;
ignoreOrder:true

card:keyword   |host:keyword   |ip0:ip                                                                           |ip1:ip                   |eq:ip
eth0           |alpha          |127.0.0.1                                                                        |127.0.0.1                |127.0.0.1
eth1           |alpha          |::1                                                                              |::1                      |::1
eth0           |beta           |127.0.0.1                                                                        |::1                      |::1
eth1           |beta           |127.0.0.1                                                                        |127.0.0.2                |127.0.0.2
eth1           |beta           |127.0.0.1                                                                        |128.0.0.1                |128.0.0.1
lo0            |gamma          |fe80::cae2:65ff:fece:feb9                                                        |fe81::cae2:65ff:fece:feb9|fe81::cae2:65ff:fece:feb9
eth0           |gamma          |fe80::cae2:65ff:fece:feb9                                                        |127.0.0.3                |127.0.0.3
eth0           |epsilon        |[fe80::cae2:65ff:fece:feb9, fe80::cae2:65ff:fece:fec0, fe80::cae2:65ff:fece:fec1]|fe80::cae2:65ff:fece:fec1|fe80::cae2:65ff:fece:fec1
;

cidrMatchSimple
from hosts | where cidr_match(ip1, "127.0.0.2/32") | keep card, host, ip0, ip1;

card:keyword   |host:keyword   |ip0:ip         |ip1:ip
eth1           |beta           |127.0.0.1      |127.0.0.2
;

cidrMatchNullField
from hosts | where cidr_match(ip0, "127.0.0.2/32") is null | keep card, host, ip0, ip1;
ignoreOrder:true

card:keyword   |host:keyword   |ip0:ip                                                                           |ip1:ip
eth0           |epsilon        |[fe80::cae2:65ff:fece:feb9, fe80::cae2:65ff:fece:fec0, fe80::cae2:65ff:fece:fec1]|fe80::cae2:65ff:fece:fec1
eth1           |epsilon        |null                                                                             |[127.0.0.1, 127.0.0.2, 127.0.0.3]
eth2           |epsilon        |[fe81::cae2:65ff:fece:feb9, fe82::cae2:65ff:fece:fec0]                           |[fe81::cae2:65ff:fece:feb9, fe82::cae2:65ff:fece:fec0]
;

cdirMatchMultipleArgs
from hosts | where cidr_match(ip1, "127.0.0.2/32", "127.0.0.3/32") | keep card, host, ip0, ip1;
ignoreOrder:true

card:keyword   |host:keyword   |ip0:ip                   |ip1:ip
eth1           |beta           |127.0.0.1                |127.0.0.2
eth0           |gamma          |fe80::cae2:65ff:fece:feb9|127.0.0.3
;

cidrMatchFunctionArg
from hosts | where cidr_match(ip1, concat("127.0.0.2", "/32"), "127.0.0.3/32") | keep card, host, ip0, ip1;
ignoreOrder:true

card:keyword   |host:keyword   |ip0:ip                   |ip1:ip
eth1           |beta           |127.0.0.1                |127.0.0.2
eth0           |gamma          |fe80::cae2:65ff:fece:feb9|127.0.0.3
;

cidrMatchFieldArg
from hosts | eval cidr="127.0.0.2" | where cidr_match(ip1, cidr, "127.0.0.3/32") | keep card, host, ip0, ip1;
ignoreOrder:true

card:keyword   |host:keyword   |ip0:ip                   |ip1:ip
eth1           |beta           |127.0.0.1                |127.0.0.2
eth0           |gamma          |fe80::cae2:65ff:fece:feb9|127.0.0.3
;

convertFromIP
from hosts | keep ip0 | eval ip0ip = to_ip(ip0) | sort ip0ip desc | limit 2;

ip0:ip                                                |ip0ip:ip
null                                                  |null
[fe81::cae2:65ff:fece:feb9, fe82::cae2:65ff:fece:fec0]|[fe81::cae2:65ff:fece:feb9, fe82::cae2:65ff:fece:fec0]
;

convertFromString
// tag::to_ip[]
ROW str1 = "1.1.1.1", str2 = "foo"
| EVAL ip1 = TO_IP(str1), ip2 = TO_IP(str2)
| WHERE CIDR_MATCH(ip1, "1.0.0.0/8")
// end::to_ip[]
;
warning:Line 2:33: evaluation of [TO_IP(str2)] failed, treating result as null. Only first 20 failures recorded.
warning:Line 2:33: java.lang.IllegalArgumentException: 'foo' is not an IP string literal.

// tag::to_ip-result[]
str1:keyword |str2:keyword |ip1:ip  |ip2:ip
1.1.1.1      |foo          |1.1.1.1 |null
// end::to_ip-result[]
;

pushDownIP
from hosts | where ip1 == to_ip("::1") | keep card, host, ip0, ip1;
ignoreOrder:true

card:keyword   |host:keyword   |ip0:ip     |ip1:ip
eth1           |alpha          |::1        |::1
eth0           |beta           |127.0.0.1  |::1
;

pushDownIPWithIn
from hosts | where ip1 in (to_ip("::1"), to_ip("127.0.0.1")) | keep card, host, ip0, ip1;
ignoreOrder:true

card:keyword   |host:keyword   |ip0:ip      |ip1:ip
eth0           |alpha          |127.0.0.1   |127.0.0.1
eth1           |alpha          |::1         |::1
eth0           |beta           |127.0.0.1   |::1
;

pushDownIPWithComparision
from hosts | where ip1 > to_ip("127.0.0.1") | keep card, ip1;
ignoreOrder:true

card:keyword   |ip1:ip
eth1           |127.0.0.2
eth1           |128.0.0.1
lo0            |fe81::cae2:65ff:fece:feb9
eth0           |127.0.0.3
eth0           |fe80::cae2:65ff:fece:fec1
;
